/*! For license information please see file-s3.js.LICENSE.txt */
(self.webpackChunkapp=self.webpackChunkapp||[]).push([[106,3111,501,6240,5636,8992,1774,7763],{5158:function(e){e.exports=function(e){if("number"!=typeof e||isNaN(e))throw new TypeError("Expected a number, got "+typeof e);const t=e<0,i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];if(t&&(e=-e),e<1)return(t?"-":"")+e+" B";const r=Math.min(Math.floor(Math.log(e)/Math.log(1024)),i.length-1);e=Number(e/Math.pow(1024,r));const s=i[r];return e>=10||e%1==0?`${(t?"-":"")+e.toFixed(0)} ${s}`:`${(t?"-":"")+e.toFixed(1)} ${s}`}},7763:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return L}});var r=i(6400),s=i(396),n=i(6037),o=i(1653),a=i(7581),l=i(8215),u=i(6594),h={strings:{dropHereOr:"Drop here or %{browse}",browse:"browse"}},p="dragFileInput";function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function c(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function f(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?c(Object(i),!0).forEach((function(t){P(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function m(){m=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,r=Object.defineProperty||function(e,t,i){e[t]=i.value},s="function"==typeof Symbol?Symbol:{},n=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",a=s.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,i){return e[t]=i}}function u(e,t,i,s){var n=t&&t.prototype instanceof c?t:c,o=Object.create(n.prototype),a=new U(s||[]);return r(o,"_invoke",{value:S(e,i,a)}),o}function h(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p={};function c(){}function f(){}function g(){}var y={};l(y,n,(function(){return this}));var v=Object.getPrototypeOf,w=v&&v(v(j([])));w&&w!==t&&i.call(w,n)&&(y=w);var b=g.prototype=c.prototype=Object.create(y);function O(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function P(e,t){function s(r,n,o,a){var l=h(e[r],e,n);if("throw"!==l.type){var u=l.arg,p=u.value;return p&&"object"==d(p)&&i.call(p,"__await")?t.resolve(p.__await).then((function(e){s("next",e,o,a)}),(function(e){s("throw",e,o,a)})):t.resolve(p).then((function(e){u.value=e,o(u)}),(function(e){return s("throw",e,o,a)}))}a(l.arg)}var n;r(this,"_invoke",{value:function(e,i){function r(){return new t((function(t,r){s(e,i,t,r)}))}return n=n?n.then(r,r):r()}})}function S(e,t,i){var r="suspendedStart";return function(s,n){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===s)throw n;return x()}for(i.method=s,i.arg=n;;){var o=i.delegate;if(o){var a=k(o,i);if(a){if(a===p)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var l=h(e,t,i);if("normal"===l.type){if(r=i.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r="completed",i.method="throw",i.arg=l.arg)}}}function k(e,t){var i=t.method,r=e.iterator[i];if(void 0===r)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),p;var s=h(r,e.iterator,t.arg);if("throw"===s.type)return t.method="throw",t.arg=s.arg,t.delegate=null,p;var n=s.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function U(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function j(e){if(e){var t=e[n];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return s.next=s}}return{next:x}}function x(){return{value:void 0,done:!0}}return f.prototype=g,r(b,"constructor",{value:g,configurable:!0}),r(g,"constructor",{value:f,configurable:!0}),f.displayName=l(g,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,a,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},O(P.prototype),l(P.prototype,o,(function(){return this})),e.AsyncIterator=P,e.async=function(t,i,r,s,n){void 0===n&&(n=Promise);var o=new P(u(t,i,r,s),n);return e.isGeneratorFunction(i)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},O(b),l(b,a,"Generator"),l(b,n,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=j,U.prototype={constructor:U,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(i,r){return o.type="throw",o.arg=e,t.next=i,r&&(t.method="next",t.arg=void 0),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var n=this.tryEntries[s],o=n.completion;if("root"===n.tryLoc)return r("end");if(n.tryLoc<=this.prev){var a=i.call(n,"catchLoc"),l=i.call(n,"finallyLoc");if(a&&l){if(this.prev<n.catchLoc)return r(n.catchLoc,!0);if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else if(a){if(this.prev<n.catchLoc)return r(n.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return r(n.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r];if(s.tryLoc<=this.prev&&i.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var n=s;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),T(i),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var s=r.arg;T(i)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:j(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),p}},e}function g(e,t,i,r,s,n,o){try{var a=e[n](o),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(r,s)}function y(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,S(r.key),r)}}function v(e,t){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},v(e,t)}function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,r=O(e);if(t){var s=O(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return function(e,t){if(t&&("object"===d(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return b(e)}(this,i)}}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e){return O=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},O(e)}function P(e,t,i){return(t=S(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function S(e){var t=function(e,t){if("object"!==d(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!==d(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===d(t)?t:String(t)}var k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(o,e);var t,i,s,n=w(o);function o(e,t){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),P(b(i=n.call(this,e,t)),"handleDrop",function(){var e,t=(e=m().mark((function e(t){var r,s,n,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),t.stopPropagation(),clearTimeout(i.removeDragOverClassTimeout),i.setPluginState({isDraggingOver:!1}),n=function(e){i.uppy.log(e,"error")},e.next=7,(0,u.Z)(t.dataTransfer,{logDropError:n});case 7:(o=e.sent).length>0&&(i.uppy.log("[DragDrop] Files dropped"),i.addFiles(o)),null===(r=(s=i.opts).onDrop)||void 0===r||r.call(s,t);case 10:case"end":return e.stop()}}),e)})),function(){var t=this,i=arguments;return new Promise((function(r,s){var n=e.apply(t,i);function o(e){g(n,r,s,o,a,"next",e)}function a(e){g(n,r,s,o,a,"throw",e)}o(void 0)}))});return function(e){return t.apply(this,arguments)}}()),i.type="acquirer",i.id=i.opts.id||"DragDrop",i.title="Drag & Drop",i.defaultLocale=h;return i.opts=f(f({},{target:null,inputName:"files[]",width:"100%",height:"100%",note:null}),t),i.i18nInit(),i.isDragDropSupported=(0,l.Z)(),i.removeDragOverClassTimeout=null,i.onInputChange=i.onInputChange.bind(b(i)),i.handleDragOver=i.handleDragOver.bind(b(i)),i.handleDragLeave=i.handleDragLeave.bind(b(i)),i.handleDrop=i.handleDrop.bind(b(i)),i.addFiles=i.addFiles.bind(b(i)),i.render=i.render.bind(b(i)),i}return t=o,i=[{key:"addFiles",value:function(e){var t=this,i=e.map((function(e){return{source:t.id,name:e.name,type:e.type,data:e,meta:{relativePath:e.relativePath||null}}}));try{this.uppy.addFiles(i)}catch(e){this.uppy.log(e)}}},{key:"onInputChange",value:function(e){var t=(0,a.Z)(e.target.files);t.length>0&&(this.uppy.log("[DragDrop] Files selected through input"),this.addFiles(t)),e.target.value=null}},{key:"handleDragOver",value:function(e){var t,i;e.preventDefault(),e.stopPropagation();var r=e.dataTransfer.types.some((function(e){return"Files"===e})),s=this.uppy.getState().allowNewUpload;if(!r||!s)return e.dataTransfer.dropEffect="none",void clearTimeout(this.removeDragOverClassTimeout);e.dataTransfer.dropEffect="copy",clearTimeout(this.removeDragOverClassTimeout),this.setPluginState({isDraggingOver:!0}),null===(t=(i=this.opts).onDragOver)||void 0===t||t.call(i,e)}},{key:"handleDragLeave",value:function(e){var t,i,r=this;e.preventDefault(),e.stopPropagation(),clearTimeout(this.removeDragOverClassTimeout),this.removeDragOverClassTimeout=setTimeout((function(){r.setPluginState({isDraggingOver:!1})}),50),null===(t=(i=this.opts).onDragLeave)||void 0===t||t.call(i,e)}},{key:"renderHiddenFileInput",value:function(){var e=this,t=this.uppy.opts.restrictions;return(0,r.h)("input",{className:"wcpauppy-DragDrop-input",type:"file",hidden:!0,ref:function(t){e.fileInputRef=t},name:this.opts.inputName,multiple:1!==t.maxNumberOfFiles,accept:t.allowedFileTypes,onChange:this.onInputChange})}},{key:"renderLabel",value:function(){return(0,r.h)("div",{className:"wcpauppy-DragDrop-label"},this.i18nArray("dropHereOr",{browse:(0,r.h)("span",{className:"wcpauppy-DragDrop-browse"},this.i18n("browse"))}))}},{key:"renderNote",value:function(){return(0,r.h)("span",{className:"wcpauppy-DragDrop-note"},this.opts.note)}},{key:"render",value:function(){var e=this,t="wcpauppy-u-reset\n      wcpauppy-DragDrop-container\n      ".concat(this.isDragDropSupported?"wcpauppy-DragDrop--isDragDropSupported":"","\n      ").concat(this.getPluginState().isDraggingOver?"wcpauppy-DragDrop--isDraggingOver":"","\n    "),i={width:this.opts.width,height:this.opts.height};return(0,r.h)("div",{className:p},(0,r.h)("button",{type:"button",className:t,style:i,onClick:function(){return e.fileInputRef.click()},onDragOver:this.handleDragOver,onDragLeave:this.handleDragLeave,onDrop:this.handleDrop},this.renderHiddenFileInput(),(0,r.h)("div",{className:"wcpauppy-DragDrop-inner"},(0,r.h)("div",{className:"wcpauppy-DragDrop-icon"},o.renderArrowSvg()),(0,r.h)("p",null,this.opts.placeholder),(0,r.h)("span",{dangerouslySetInnerHTML:{__html:window.wcpa_front.strings.file_droppable_desc_text.replace("{action}","<i>".concat(window.wcpa_front.strings.file_droppable_action_text,"</i>"))}}))))}},{key:"install",value:function(){var e=this.opts.target;this.setPluginState({isDraggingOver:!1}),e&&this.mount(e,this)}},{key:"uninstall",value:function(){this.unmount()}}],s=[{key:"renderArrowSvg",value:function(){return(0,r.h)("svg",{width:"50",height:"38",viewBox:"0 0 50 38",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,r.h)("path",{d:"M0.618408 36.4785C0.402719 36.1777 0.275391 35.8089 0.275391 35.4105V31.5264V6.69029C0.275391 5.80942 0.989416 5.09484 1.87083 5.09484H3.07551C4.28952 5.09484 5.27357 4.11079 5.27357 2.89679C5.27357 1.68278 6.25762 0.69873 7.47162 0.69873H19.9739C20.7939 0.69873 21.5458 1.15481 21.9239 1.88255L22.9799 3.91212C23.3585 4.63932 24.1099 5.09594 24.9298 5.09594H39.4046C40.2855 5.09594 41.0001 5.80997 41.0001 6.69138V15.8261L0.618408 36.4785Z",fill:"#A6CFFF"}),(0,r.h)("path",{d:"M9.29776 17.1251C9.6523 16.3343 10.4388 15.825 11.3054 15.825H47.9473C49.1954 15.825 50.0285 17.1114 49.5181 18.2502L41.7083 35.6673C41.278 36.6272 40.3241 37.2452 39.272 37.2452H5.99546H2.1114C1.49617 37.2452 0.952279 36.9428 0.619141 36.4785L0.620787 36.4774L5.07837 26.5353L9.29776 17.1251Z",fill:"#488DF4"}))}}],i&&y(t.prototype,i),s&&y(t,s),Object.defineProperty(t,"prototype",{writable:!1}),o}(n.di);P(k,"VERSION","3.0.1");var E=i(9529),T=i(7049),U=i(7894),j=i(8697);function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function F(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,s,n,o,a=[],l=!0,u=!1;try{if(n=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;l=!1}else for(;!(l=(r=n.call(i)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){u=!0,s=e}finally{try{if(!l&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(u)throw s}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return A(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function C(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function _(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?C(Object(i),!0).forEach((function(t){R(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):C(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function R(e,t,i){return(t=function(e){var t=function(e,t){if("object"!==x(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!==x(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===x(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var $={};var I=function(e){var t=e.file.preview,i="";if(t)i=t;else{i="".concat(window.wcpa_front.assets_url,"images/front/").concat("default-image.svg")}return(0,r.h)("div",{class:"wcpa_thumb"},(0,r.h)("img",{src:i}))},L=function(e){var t=e.field,i=e.design,a=e.handleChange,l=e.fieldData,u=e.product,h=e.handleToolTip,p=e._labelPosition,d=e._descPosition,c=e.isDisabled,f=e.enableQuantity,m=e.onQuantityChange,g=e.formsCount,y=e.method,v=t.required,w=t.placeholder,b=t.name,O=t.multiple_upload,P=t.uploadSize,S=t.min_file_count,x=t.minUploadSize,A=t.allowedFileTypes,C=t.elementId,R=t.max_file_count,L=t.upload_type,M=t.quantity_label,N=t.min_quantity,D=t.max_quantity,z=u.product_id,q=N||1,B=(0,U.Tj)(C,g),H=(0,s.sO)(),V=(0,s.sO)(),X=(0,s.sO)([]),K=(0,s.sO)([]),W=(0,s.sO)(0),G=F((0,s.eJ)((new Date).getMilliseconds()),2),Z=G[0],Y=G[1],J=F((0,s.eJ)(""),2),Q=J[0],ee=J[1],te=F((0,s.eJ)(!1),2),ie=te[0],re=te[1],se=F((0,s.eJ)(w),2),ne=se[0],oe=se[1],ae=F((0,s.eJ)(!1),2),le=ae[0],ue=ae[1],he=1;O&&(he=t.max_file_count?t.max_file_count:10);var pe,de,ce=""!==A.trim()?A.split(","):void 0;void 0===H.current&&(H.current=(pe="uppy_".concat(z.parent,"_").concat(C),de={maxNumberOfFiles:he,allowedFileTypes:ce,maxFileSize:!!P&&1024*P*1024,minFileSize:!!x&&1024*x*1024},$[pe]||($[pe]=new n.ZP({id:pe,debug:!0,autoProceed:!0,locale:{strings:{youCanOnlyUploadX:{0:"max_file_count",1:"max_file_count"},youHaveToAtLeastSelectX:{0:"min_file_count",1:"min_file_count"},exceedsSize:"uploadSize",inferiorSize:"minUploadSize",youCanOnlyUploadFileTypes:"allowedFileTypes",noDuplicates:"noDuplicates",dropHereOr:window.wcpa_front.strings.file_droppable_desc_text,browse:window.wcpa_front.strings.file_droppable_action_text}},restrictions:_({maxNumberOfFiles:1},de)})),$[pe])),(0,s.d4)((function(){var e={},i=[],r=K.current.map((function(e){return e.uploadStatus&&!0===e.uploadStatus.status&&i.push(e.uploadStatus.file),{name:e.name,extension:e.extension,size:e.size,type:e.type,uploadStatus:e.uploadStatus||!1}}));0==r.length?oe(w):1==r.length?oe(r[0].name):oe(window.wcpa_front.strings.file_placeholder.replace("{count}",r.length)),ee(JSON.stringify(i)),r.length&&!ie&&re(!0);var s=H.current.getState().info;v&&ie&&0==r.length?e.required={show:!0,message:(0,U.N3)("requiredError",t),isBlocking:!0,newValue:!1}:O&&r.length>=1&&r.length<parseInt(S)?e.min_file_count={show:!0,message:(0,U.N3)("minFileCountError",t).replace("%s",S),isBlocking:!0,newValue:!1}:s.some((function(i){return"Upload error"==i.details?(e.uploadError={show:!0,message:(0,U.N3)("uploadError",t).replace("%s",r[0].name),isBlocking:!1,newValue:!1},!0):(delete e.uploadError,"max_file_count"==i.message?(e.max_file_count={show:!0,message:(0,U.N3)("maxFileCountError",t).replace("%s",O?void 0===R?O?10:1:R:1),isBlocking:!1,newValue:!1},!0):(delete e.max_file_count,"uploadSize"==i.message?(e.uploadSize={show:!0,message:(0,U.N3)("maxFileSizeError",t).replace("%s",P+"MB"),isBlocking:!1,newValue:!1},!0):(delete e.uploadSize,"minUploadSize"==i.message?(e.minUploadSize={show:!0,message:(0,U.N3)("minFileSizeError",t).replace("%s",x+"MB"),isBlocking:!1,newValue:!1},!0):(delete e.minUploadSize,"allowedFileTypes"==i.message?(e.allowedFileTypes={show:!0,message:(0,U.N3)("fileExtensionError",t),isBlocking:!1,newValue:!1},!0):(delete e.allowedFileTypes,"noDuplicates"==i.message?(e.allowedFileTypes={show:!0,message:(0,U.N3)("noDuplicates",t),isBlocking:!1,newValue:!1},!0):(delete e.noDuplicates,void(e.other={show:!0,message:i.message,isBlocking:!1,newValue:!1})))))))})),a(C,r,e)}),[Z]);var fe=function(e){H.current.removeFile(e.target.id)};(0,s.d4)((function(){if("droppable"==L&&H.current.use(k,{target:X.current,width:"100%",height:"100%",note:null,placeholder:w||window.wcpa_front.strings.file_droppable_text}),"tus"==y)H.current.use(e.Tus,{endpoint:"".concat(window.wcpa_front.root,"tus_upload/").concat(z.parent,"/").concat(b,"/"),resume:!0,uploadDataDuringCreation:!1,parallelUploads:1,allowedMetaFields:["name","size","type"],headers:null!==window.wcpa_front.api_nonce?{"X-WP-Nonce":window.wcpa_front.api_nonce}:void 0});else if("s3"==y)H.current.use(e.AwsS3,{getUploadParameters:function(e){return fetch("".concat(window.wcpa_front.root,"s3-sign/").concat(z.parent,"/").concat(b,"/"),{method:"post",headers:{accept:"application/json","content-type":"application/json"},body:JSON.stringify({filename:e.name,contentType:e.type,size:e.size})}).then((function(e){return e.json()})).then((function(t){return{method:t.method,url:t.url,fields:t.fields,headers:{"Content-Type":e.type}}}))}});else{H.current.getFiles().forEach((function(e){H.current.removeFile(e.id)})),H.current.use(o.Z,{endpoint:"".concat(window.wcpa_front.root,"upload/").concat(z.parent,"/").concat(b,"/"),formData:!0,bundle:!1,fieldName:"wcpa_file",headers:null!==window.wcpa_front.api_nonce?{"X-WP-Nonce":window.wcpa_front.api_nonce}:void 0})}if(V.current){var i,r=null===(i=V.current.parentElement)||void 0===i?void 0:i.offsetWidth;r>0&&ue(r)}return H.current.use(T.Z,{thumbnailWidth:75}),H.current.on("file-added",(function(e){e.meta=_(_({},e.meta),{},{size:e.size}),K.current.push(e),Y((new Date).getMilliseconds())})),H.current.on("file-removed",(function(e,t){var i=K.current.findIndex((function(t){return t.id===e.id}));-1!==i&&K.current.splice(i,1),0==K.current.length&&V.current&&(V.current.value=""),Y((new Date).getMilliseconds())})),H.current.on("info-visible",(function(){Y((new Date).getMilliseconds())})),H.current.on("thumbnail:generated",(function(e,t){var i=K.current.filter((function(t){return t.id===e.id}));i&&(i[0].preview=t),Y((new Date).getMilliseconds())})),H.current.on("progress",(function(e){W.current=Math.min(85,e),Y((new Date).getMilliseconds())})),H.current.on("complete",(function(e){W.current=100,Y((new Date).getMilliseconds())})),H.current.on("upload-progress",(function(e,t){var i=K.current.filter((function(t){return t.id===e.id}));i&&(i[0].progress.percentage=Math.min(85,Math.round(100*t.bytesUploaded/t.bytesTotal))),Y((new Date).getMilliseconds())})),H.current.on("upload-error",(function(e,t,i){var r=K.current.filter((function(t){return t.id===e.id}));r&&(r[0].uploadStatus=i.body),Y((new Date).getMilliseconds())})),H.current.on("upload-success",(function(e,t){var i=K.current.filter((function(t){return t.id===e.id}));i&&(i[0].uploadStatus="tus"==y||"s3"==y?{status:!0,file:{file:t.uploadURL,file_name:i[0].name,type:i[0].type}}:t.body,i[0].progress.percentage=100),Y((new Date).getMilliseconds())})),(void 0!==me||0==me&&t.preSetValue)&&(0,U.kJ)(t.preSetValue)&&t.preSetValue.forEach((function(e){fetch(e.url).then((function(e){return e.blob()})).then((function(t){H.current.addFile({name:e.name,type:e.type,data:t})}))})),function(){var e;null===(e=H.current)||void 0===e||e.close({reason:"unmount"}),H.current=void 0}}),[H]);var me=l.value,ge=l.quantity,ye=!1;void 0!==me&&((0,U.kJ)(me)?me.length>0:""!=me)&&(ye=!0);var ve=(0,r.h)("div",{className:"wcpa_field"},"droppable"==L&&(0,r.h)("div",{ref:X},(0,r.h)("div",{style:{width:W.current+"%"}})),"ajax"==L&&(0,r.h)("label",{className:"wcpa_file_style"},(0,r.h)("input",{ref:V,type:"file",multiple:O,accept:A,onChange:function(e){Array.from(e.target.files).forEach((function(e){try{H.current.addFile({source:"file input",name:e.name,type:e.type,data:e})}catch(e){e.isRestriction}}))},disabled:c,placeholder:w,value:window.wcpa_front.strings.file_button_text,id:B}),(0,r.h)("div",{className:"awpca_custom_file"},(0,r.h)("p",null,ne||" "),"  ",(0,r.h)("span",{className:"wcpa_choose_button"},window.wcpa_front.strings.file_button_text))),(0,r.h)("input",{type:"hidden",name:"".concat((0,U.uM)(b)),value:Q}));return(0,r.h)(r.HY,null,(0,r.h)(E.Z,{handleToolTip:h,_labelPosition:p,_descPosition:d,field:t,dField:l,targetId:B},(0,r.h)("div",{style:le?{maxWidth:le+"px"}:{}},f?(0,r.h)("div",{className:"wcpa_quantity_wrap"},ve,M?(0,r.h)("div",{className:"wcpa_label_wrap"},(0,r.h)("label",null," ",M),(0,r.h)(j.Z,{name:"".concat((0,U.uM)(b,"_quantity")),disabled:c||!ye,defaultValue:ge,min:q,max:D,onChange:function(e){m(t,e.target.value)},design:i})):(0,r.h)(j.Z,{name:"".concat((0,U.uM)(b,"_quantity")),disabled:c||!ye,defaultValue:ge,min:q,max:D,onChange:function(e){m(t,e.target.value)},design:i})):ve,(0,r.h)("ul",{className:"wcpa_file_list"},K.current.map((function(e){return(0,r.h)("li",{key:e.id},(0,r.h)("div",{className:"wcpa_file_details"},(0,r.h)(I,{file:e}),(0,r.h)("p",null,(0,r.h)("span",null,null==e?void 0:e.name),(t=(null==e?void 0:e.size)||0,i=1024,s=Math.floor(Math.log(t)/Math.log(i)),+(t/i/i).toFixed(2)+["bytes","kb","mb","gb","tb","pb","eb","zb","yb"][s]))),(0,r.h)("div",{className:"wcpa_progressbar_area ".concat(0==e.progress.percentage?"wcpa_progress_wait":"")},e.uploadStatus&&0==e.uploadStatus.status?"":(0,r.h)("div",{className:"wcpa_progressbar"},(0,r.h)("span",{style:{width:e.progress.percentage+"%"},className:e.uploadStatus&&1==e.uploadStatus.status&&"wcpa_success"})),(0,r.h)("p",{className:"wcpa_status"},e.uploadStatus&&(0,r.h)(r.HY,null,1==e.uploadStatus.status&&(0,r.h)("div",{className:"awpca_complete"},window.wcpa_front.strings.file_upload_completed),0==e.uploadStatus.status&&(0,r.h)("div",{className:"awpca_failed"},window.wcpa_front.strings.file_upload_failed))||e.progress.percentage+"%")),(0,r.h)("span",{id:e.id,className:"wcpa_remove_file",onClick:fe}));var t,i,s}))))))}},5923:function(e,t,i){"use strict";i.r(t);var r=i(6400),s=i(3462),n=i(7763);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},o.apply(this,arguments)}t.default=function(e){return(0,r.h)(n.default,o({},e,{method:"s3",AwsS3:s.Z}))}},3096:function(e,t,i){var r="Expected a function",s=NaN,n="[object Symbol]",o=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,u=/^0o[0-7]+$/i,h=parseInt,p="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,d="object"==typeof self&&self&&self.Object===Object&&self,c=p||d||Function("return this")(),f=Object.prototype.toString,m=Math.max,g=Math.min,y=function(){return c.Date.now()};function v(e,t,i){var s,n,o,a,l,u,h=0,p=!1,d=!1,c=!0;if("function"!=typeof e)throw new TypeError(r);function f(t){var i=s,r=n;return s=n=void 0,h=t,a=e.apply(r,i)}function v(e){var i=e-u;return void 0===u||i>=t||i<0||d&&e-h>=o}function O(){var e=y();if(v(e))return P(e);l=setTimeout(O,function(e){var i=t-(e-u);return d?g(i,o-(e-h)):i}(e))}function P(e){return l=void 0,c&&s?f(e):(s=n=void 0,a)}function S(){var e=y(),i=v(e);if(s=arguments,n=this,u=e,i){if(void 0===l)return function(e){return h=e,l=setTimeout(O,t),p?f(e):a}(u);if(d)return l=setTimeout(O,t),f(u)}return void 0===l&&(l=setTimeout(O,t)),a}return t=b(t)||0,w(i)&&(p=!!i.leading,o=(d="maxWait"in i)?m(b(i.maxWait)||0,t):o,c="trailing"in i?!!i.trailing:c),S.cancel=function(){void 0!==l&&clearTimeout(l),h=0,s=u=n=l=void 0},S.flush=function(){return void 0===l?a:P(y())},S}function w(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function b(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&f.call(e)==n}(e))return s;if(w(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=w(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(o,"");var i=l.test(e);return i||u.test(e)?h(e.slice(2),i?2:8):a.test(e)?s:+e}e.exports=function(e,t,i){var s=!0,n=!0;if("function"!=typeof e)throw new TypeError(r);return w(i)&&(s="leading"in i?!!i.leading:s,n="trailing"in i?!!i.trailing:n),v(e,t,{leading:s,maxWait:t,trailing:n})}},2705:function(e,t,i){var r=i(5639).Symbol;e.exports=r},4239:function(e,t,i){var r=i(2705),s=i(9607),n=i(2333),o=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?s(e):n(e)}},7561:function(e,t,i){var r=i(7990),s=/^\s+/;e.exports=function(e){return e?e.slice(0,r(e)+1).replace(s,""):e}},1957:function(e,t,i){var r="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g;e.exports=r},9607:function(e,t,i){var r=i(2705),s=Object.prototype,n=s.hasOwnProperty,o=s.toString,a=r?r.toStringTag:void 0;e.exports=function(e){var t=n.call(e,a),i=e[a];try{e[a]=void 0;var r=!0}catch(e){}var s=o.call(e);return r&&(t?e[a]=i:delete e[a]),s}},2333:function(e){var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},5639:function(e,t,i){var r=i(1957),s="object"==typeof self&&self&&self.Object===Object&&self,n=r||s||Function("return this")();e.exports=n},7990:function(e){var t=/\s/;e.exports=function(e){for(var i=e.length;i--&&t.test(e.charAt(i)););return i}},3279:function(e,t,i){var r=i(3218),s=i(7771),n=i(4841),o=Math.max,a=Math.min;e.exports=function(e,t,i){var l,u,h,p,d,c,f=0,m=!1,g=!1,y=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function v(t){var i=l,r=u;return l=u=void 0,f=t,p=e.apply(r,i)}function w(e){var i=e-c;return void 0===c||i>=t||i<0||g&&e-f>=h}function b(){var e=s();if(w(e))return O(e);d=setTimeout(b,function(e){var i=t-(e-c);return g?a(i,h-(e-f)):i}(e))}function O(e){return d=void 0,y&&l?v(e):(l=u=void 0,p)}function P(){var e=s(),i=w(e);if(l=arguments,u=this,c=e,i){if(void 0===d)return function(e){return f=e,d=setTimeout(b,t),m?v(e):p}(c);if(g)return clearTimeout(d),d=setTimeout(b,t),v(c)}return void 0===d&&(d=setTimeout(b,t)),p}return t=n(t)||0,r(i)&&(m=!!i.leading,h=(g="maxWait"in i)?o(n(i.maxWait)||0,t):h,y="trailing"in i?!!i.trailing:y),P.cancel=function(){void 0!==d&&clearTimeout(d),f=0,l=c=u=d=void 0},P.flush=function(){return void 0===d?p:O(s())},P}},3218:function(e){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},7005:function(e){e.exports=function(e){return null!=e&&"object"==typeof e}},3448:function(e,t,i){var r=i(4239),s=i(7005);e.exports=function(e){return"symbol"==typeof e||s(e)&&"[object Symbol]"==r(e)}},7771:function(e,t,i){var r=i(5639);e.exports=function(){return r.Date.now()}},3493:function(e,t,i){var r=i(3279),s=i(3218);e.exports=function(e,t,i){var n=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return s(i)&&(n="leading"in i?!!i.leading:n,o="trailing"in i?!!i.trailing:o),r(e,t,{leading:n,maxWait:t,trailing:o})}},4841:function(e,t,i){var r=i(7561),s=i(3218),n=i(3448),o=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,l=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(n(e))return NaN;if(s(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=s(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=r(e);var i=a.test(e);return i||l.test(e)?u(e.slice(2),i?2:8):o.test(e)?NaN:+e}},4193:function(e,t,i){var r=i(1196),s=/[\/\+\.]/;e.exports=function(e,t){function i(t){var i=r(t,e,s);return i&&i.length>=2}return t?i(t.split(";")[0]):i}},4800:function(e){e.exports=function(){var e={},t=e._fns={};return e.emit=function(e,i,r,s,n,o,a){var l=function(e){var i=t[e]?t[e]:[],r=e.indexOf(":"),s=-1===r?[e]:[e.substring(0,r),e.substring(r+1)],n=Object.keys(t),o=0,a=n.length;for(;o<a;o++){var l=n[o];if("*"===l&&(i=i.concat(t[l])),2===s.length&&s[0]===l){i=i.concat(t[l]);break}}return i}(e);l.length&&function(e,t,i){var r=0,s=t.length;for(;r<s&&t[r];r++)t[r].event=e,t[r].apply(t[r],i)}(e,l,[i,r,s,n,o,a])},e.on=function(e,i){t[e]||(t[e]=[]),t[e].push(i)},e.once=function(t,i){this.on(t,(function r(){i.apply(this,arguments),e.off(t,r)}))},e.off=function(e,t){var i=[];if(e&&t)for(var r=this._fns[e],s=0,n=r?r.length:0;s<n;s++)r[s]!==t&&i.push(r[s]);i.length?this._fns[e]=i:delete this._fns[e]},e}},1196:function(e){"use strict";function t(e,t){this.text=e=e||"",this.hasWild=~e.indexOf("*"),this.separator=t,this.parts=e.split(t)}t.prototype.match=function(e){var t,i,r=!0,s=this.parts,n=s.length;if("string"==typeof e||e instanceof String)if(this.hasWild||this.text==e){for(i=(e||"").split(this.separator),t=0;r&&t<n;t++)"*"!==s[t]&&(r=t<i.length&&s[t]===i[t]);r=r&&i}else r=!1;else if("function"==typeof e.splice)for(r=[],t=e.length;t--;)this.match(e[t])&&(r[r.length]=e[t]);else if("object"==typeof e)for(var o in r={},e)this.match(o)&&(r[o]=e[o]);return r},e.exports=function(e,i,r){var s=new t(e,r||/[\/\.]/);return void 0!==i?s.match(i):s}},3462:function(e,t,i){"use strict";i.d(t,{Z:function(){return ki}});var r=i(4060),s=i(9537);function n(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var o=0;function a(e){return"__private_"+o+++"_"+e}var l=a("emitter"),u=a("events");class h{constructor(e){Object.defineProperty(this,l,{writable:!0,value:void 0}),Object.defineProperty(this,u,{writable:!0,value:[]}),n(this,l)[l]=e}on(e,t){return n(this,u)[u].push([e,t]),n(this,l)[l].on(e,t)}remove(){for(const[e,t]of n(this,u)[u].splice(0))n(this,l)[l].off(e,t)}}var p=i(3493);var d=p((function(e,t,i){const{progress:r,bytesUploaded:s,bytesTotal:n}=t;r&&(e.uppy.log(`Upload progress: ${r}`),e.uppy.emit("upload-progress",i,{uploader:e,bytesUploaded:s,bytesTotal:n}))}),300,{leading:!0,trailing:!0});function c(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var f=0;function m(e){return"__private_"+f+++"_"+e}function g(e){if(null!=e){var t;const i=()=>this.abort(e.reason);e.addEventListener("abort",i,{once:!0});const r=()=>{e.removeEventListener("abort",i)};null==(t=this.then)||t.call(this,r,r)}return this}var y=m("activeRequests"),v=m("queuedHandlers"),w=m("paused"),b=m("pauseTimer"),O=m("downLimit"),P=m("upperLimit"),S=m("rateLimitingTimer"),k=m("call"),E=m("queueNext"),T=m("next"),U=m("queue"),j=m("dequeue"),x=m("resume"),F=m("increaseLimit");class A{constructor(e){Object.defineProperty(this,j,{value:I}),Object.defineProperty(this,U,{value:$}),Object.defineProperty(this,T,{value:R}),Object.defineProperty(this,E,{value:_}),Object.defineProperty(this,k,{value:C}),Object.defineProperty(this,y,{writable:!0,value:0}),Object.defineProperty(this,v,{writable:!0,value:[]}),Object.defineProperty(this,w,{writable:!0,value:!1}),Object.defineProperty(this,b,{writable:!0,value:void 0}),Object.defineProperty(this,O,{writable:!0,value:1}),Object.defineProperty(this,P,{writable:!0,value:void 0}),Object.defineProperty(this,S,{writable:!0,value:void 0}),Object.defineProperty(this,x,{writable:!0,value:()=>this.resume()}),Object.defineProperty(this,F,{writable:!0,value:()=>{if(c(this,w)[w])c(this,S)[S]=setTimeout(c(this,F)[F],0);else{c(this,O)[O]=this.limit,this.limit=Math.ceil((c(this,P)[P]+c(this,O)[O])/2);for(let e=c(this,O)[O];e<=this.limit;e++)c(this,E)[E]();c(this,P)[P]-c(this,O)[O]>3?c(this,S)[S]=setTimeout(c(this,F)[F],2e3):c(this,O)[O]=Math.floor(c(this,O)[O]/2)}}}),this.limit="number"!=typeof e||0===e?1/0:e}run(e,t){return!c(this,w)[w]&&c(this,y)[y]<this.limit?c(this,k)[k](e):c(this,U)[U](e,t)}wrapSyncFunction(e,t){var i=this;return function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];const o=i.run((()=>(e(...s),queueMicrotask((()=>o.done())),()=>{})),t);return{abortOn:g,abort(){o.abort()}}}}wrapPromiseFunction(e,t){var i=this;return function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];let o;const a=new Promise(((r,n)=>{o=i.run((()=>{let t,i;try{i=Promise.resolve(e(...s))}catch(e){i=Promise.reject(e)}return i.then((e=>{t?n(t):(o.done(),r(e))}),(e=>{t?n(t):(o.done(),n(e))})),e=>{t=function(e){return new Error("Cancelled",{cause:e})}(e)}}),t)}));return a.abort=e=>{o.abort(e)},a.abortOn=g,a}}resume(){c(this,w)[w]=!1,clearTimeout(c(this,b)[b]);for(let e=0;e<this.limit;e++)c(this,E)[E]()}pause(e){void 0===e&&(e=null),c(this,w)[w]=!0,clearTimeout(c(this,b)[b]),null!=e&&(c(this,b)[b]=setTimeout(c(this,x)[x],e))}rateLimit(e){clearTimeout(c(this,S)[S]),this.pause(e),this.limit>1&&Number.isFinite(this.limit)&&(c(this,P)[P]=this.limit-1,this.limit=c(this,O)[O],c(this,S)[S]=setTimeout(c(this,F)[F],e))}get isPaused(){return c(this,w)[w]}}function C(e){c(this,y)[y]+=1;let t,i=!1;try{t=e()}catch(e){throw c(this,y)[y]-=1,e}return{abort:e=>{i||(i=!0,c(this,y)[y]-=1,t(e),c(this,E)[E]())},done:()=>{i||(i=!0,c(this,y)[y]-=1,c(this,E)[E]())}}}function _(){queueMicrotask((()=>c(this,T)[T]()))}function R(){if(c(this,w)[w]||c(this,y)[y]>=this.limit)return;if(0===c(this,v)[v].length)return;const e=c(this,v)[v].shift(),t=c(this,k)[k](e.fn);e.abort=t.abort,e.done=t.done}function $(e,t){void 0===t&&(t={});const i={fn:e,priority:t.priority||0,abort:()=>{c(this,j)[j](i)},done:()=>{throw new Error("Cannot mark a queued request as done: this indicates a bug")}},r=c(this,v)[v].findIndex((e=>i.priority>e.priority));return-1===r?c(this,v)[v].push(i):c(this,v)[v].splice(r,0,i),i}function I(e){const t=c(this,v)[v].indexOf(e);-1!==t&&c(this,v)[v].splice(t,1)}Symbol("__queue");const{AbortController:L}=globalThis,{AbortSignal:M}=globalThis,N=function(e,t){void 0===e&&(e="Aborted");const i=new DOMException(e,"AbortError");var r,s;return null!=t&&(r=t,s="cause",Object.prototype.hasOwnProperty.call(r,s))&&Object.defineProperty(i,"cause",{__proto__:null,configurable:!0,writable:!0,value:t.cause}),i};function D(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var z=0;function q(e){return"__private_"+z+++"_"+e}const B={getChunkSize(e){return Math.ceil(e.size/1e4)},onProgress(){},onPartComplete(){},onSuccess(){},onError(e){throw e}};const H=Symbol("pausing upload, not an actual error");var V=q("abortController"),X=q("chunks"),K=q("chunkState"),W=q("data"),G=q("file"),Z=q("uploadHasStarted"),Y=q("onError"),J=q("onSuccess"),Q=q("shouldUseMultipart"),ee=q("isRestoring"),te=q("onReject"),ie=q("maxMultipartParts"),re=q("minPartSize"),se=q("initChunks"),ne=q("createUpload"),oe=q("resumeUpload"),ae=q("onPartProgress"),le=q("onPartComplete"),ue=q("abortUpload");function he(){const e=D(this,W)[W].size,t="function"==typeof D(this,Q)[Q]?D(this,Q)[Q](D(this,G)[G]):Boolean(D(this,Q)[Q]);if(t&&e>D(this,re)[re]){let i=Math.max(this.options.getChunkSize(D(this,W)[W]),D(this,re)[re]),r=Math.floor(e/i);r>D(this,ie)[ie]&&(r=D(this,ie)[ie],i=e/D(this,ie)[ie]),D(this,X)[X]=Array(r);for(let r=0,s=0;r<e;r+=i,s++){const n=Math.min(e,r+i),o=()=>{const e=r;return D(this,W)[W].slice(e,n)};if(D(this,X)[X][s]={getData:o,onProgress:D(this,ae)[ae](s),onComplete:D(this,le)[le](s),shouldUseMultipart:t},D(this,ee)[ee]){const t=r+i>e?e-r:i;D(this,X)[X][s].setAsUploaded=()=>{D(this,K)[K][s].uploaded=t}}}}else D(this,X)[X]=[{getData:()=>D(this,W)[W],onProgress:D(this,ae)[ae](0),onComplete:D(this,le)[le](0),shouldUseMultipart:t}];D(this,K)[K]=D(this,X)[X].map((()=>({uploaded:0})))}function pe(){this.options.companionComm.uploadFile(D(this,G)[G],D(this,X)[X],D(this,V)[V].signal).then(D(this,J)[J],D(this,te)[te]),D(this,Z)[Z]=!0}function de(){this.options.companionComm.resumeUploadFile(D(this,G)[G],D(this,X)[X],D(this,V)[V].signal).then(D(this,J)[J],D(this,te)[te])}function ce(){D(this,V)[V].abort(),this.options.companionComm.abortFileUpload(D(this,G)[G]).catch((e=>this.options.log(e)))}var fe=class{constructor(e,t){var i;Object.defineProperty(this,ue,{value:ce}),Object.defineProperty(this,oe,{value:de}),Object.defineProperty(this,ne,{value:pe}),Object.defineProperty(this,se,{value:he}),Object.defineProperty(this,V,{writable:!0,value:new L}),Object.defineProperty(this,X,{writable:!0,value:void 0}),Object.defineProperty(this,K,{writable:!0,value:void 0}),Object.defineProperty(this,W,{writable:!0,value:void 0}),Object.defineProperty(this,G,{writable:!0,value:void 0}),Object.defineProperty(this,Z,{writable:!0,value:!1}),Object.defineProperty(this,Y,{writable:!0,value:void 0}),Object.defineProperty(this,J,{writable:!0,value:void 0}),Object.defineProperty(this,Q,{writable:!0,value:void 0}),Object.defineProperty(this,ee,{writable:!0,value:void 0}),Object.defineProperty(this,te,{writable:!0,value:e=>(null==e?void 0:e.cause)===H?null:D(this,Y)[Y](e)}),Object.defineProperty(this,ie,{writable:!0,value:1e4}),Object.defineProperty(this,re,{writable:!0,value:5242880}),Object.defineProperty(this,ae,{writable:!0,value:e=>t=>{if(!t.lengthComputable)return;D(this,K)[K][e].uploaded=function(e){if("string"==typeof e)return parseInt(e,10);if("number"==typeof e)return e;throw new TypeError("Expected a number")}(t.loaded);const i=D(this,K)[K].reduce(((e,t)=>e+t.uploaded),0);this.options.onProgress(i,D(this,W)[W].size)}}),Object.defineProperty(this,le,{writable:!0,value:e=>t=>{D(this,X)[X][e]=null,D(this,K)[K][e].etag=t,D(this,K)[K][e].done=!0;const i={PartNumber:e+1,ETag:t};this.options.onPartComplete(i)}}),this.options={...B,...t},null!=(i=this.options).getChunkSize||(i.getChunkSize=B.getChunkSize),D(this,W)[W]=e,D(this,G)[G]=t.file,D(this,J)[J]=this.options.onSuccess,D(this,Y)[Y]=this.options.onError,D(this,Q)[Q]=this.options.shouldUseMultipart,D(this,ee)[ee]=t.uploadId&&t.key,D(this,se)[se]()}start(){D(this,Z)[Z]?(D(this,V)[V].signal.aborted||D(this,V)[V].abort(H),D(this,V)[V]=new L,D(this,oe)[oe]()):D(this,ee)[ee]?(this.options.companionComm.restoreUploadFile(D(this,G)[G],{uploadId:this.options.uploadId,key:this.options.key}),D(this,oe)[oe]()):D(this,ne)[ne]()}pause(){D(this,V)[V].abort(H),D(this,V)[V]=new L}abort(e){var t;void 0===e&&(e=void 0),null!=(t=e)&&t.really?D(this,ue)[ue]():this.pause()}get chunkState(){return D(this,K)[K]}};const{subtle:me}=globalThis.crypto,ge=new TextEncoder,ye={name:"HMAC",hash:"SHA-256"};function ve(e){const t=new Uint8Array(e);let i="";for(let e=0;e<t.length;e++)i+=t[e].toString(16).padStart(2,"0");return i}async function we(e,t){return me.sign(ye,await async function(e){return me.importKey("raw","string"==typeof e?ge.encode(e):e,ye,!1,["sign"])}(e),ge.encode(t))}async function be(e){let{accountKey:t,accountSecret:i,sessionToken:r,bucketName:s,Key:n,Region:o,expires:a,uploadId:l,partNumber:u}=e;const h="s3",p=`${s}.${h}.${o}.amazonaws.com`,d=`/${encodeURI(n)}`,c="UNSIGNED-PAYLOAD",f=(new Date).toISOString().replace(/[-:]|\.\d+/g,""),m=f.slice(0,8),g=`${m}/${o}/${h}/aws4_request`,y=new URL(`https://${p}${d}`);y.searchParams.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),y.searchParams.set("X-Amz-Content-Sha256",c),y.searchParams.set("X-Amz-Credential",`${t}/${g}`),y.searchParams.set("X-Amz-Date",f),y.searchParams.set("X-Amz-Expires",a),y.searchParams.set("X-Amz-Security-Token",r),y.searchParams.set("X-Amz-SignedHeaders","host"),u&&y.searchParams.set("partNumber",u),l&&y.searchParams.set("uploadId",l),y.searchParams.set("x-id",u&&l?"UploadPart":"PutObject");const v=function(e){let{method:t="PUT",CanonicalUri:i="/",CanonicalQueryString:r="",SignedHeaders:s,HashedPayload:n}=e;const o=Object.keys(s).map((e=>e.toLowerCase())).sort();return[t,i,r,...o.map((e=>`${e}:${s[e]}`)),"",o.join(";"),n].join("\n")}({CanonicalUri:d,CanonicalQueryString:y.search.slice(1),SignedHeaders:{host:p},HashedPayload:c}),w=["AWS4-HMAC-SHA256",f,g,ve(await async function(e){return me.digest(ye.hash,ge.encode(e))}(v))].join("\n"),b=await we(`AWS4${i}`,m),O=await we(b,o),P=await we(O,h),S=await we(P,"aws4_request"),k=ve(await we(S,w));return y.searchParams.set("X-Amz-Signature",k),y}let Oe;function Pe(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Se=0;function ke(e){return"__private_"+Se+++"_"+e}function Ee(e){if(e&&e.error){const t=new Error(e.message);throw Object.assign(t,e.error),t}return e}function Te(e){const t=e.Expiration;if(t){const e=Math.floor((new Date(t)-Date.now())/1e3);if(e>9)return e}}function Ue(e){let{meta:t,allowedMetaFields:i,querify:r=!1}=e;const s=null!=i?i:Object.keys(t);return t?Object.fromEntries(s.filter((e=>null!=t[e])).map((e=>[r?`metadata[${e}]`:e,String(t[e])]))):{}}function je(e){if(null!=e&&e.aborted)throw N("The operation was aborted",{cause:e.reason})}var xe=ke("abortMultipartUpload"),Fe=ke("cache"),Ae=ke("createMultipartUpload"),Ce=ke("fetchSignature"),_e=ke("getUploadParameters"),Re=ke("listParts"),$e=ke("previousRetryDelay"),Ie=ke("requests"),Le=ke("retryDelayIterator"),Me=ke("sendCompletionRequest"),Ne=ke("setS3MultipartState"),De=ke("uploadPartBytes"),ze=ke("shouldRetry"),qe=ke("nonMultipartUpload");class Be{constructor(e,t,i){Object.defineProperty(this,qe,{value:Ve}),Object.defineProperty(this,ze,{value:He}),Object.defineProperty(this,xe,{writable:!0,value:void 0}),Object.defineProperty(this,Fe,{writable:!0,value:new WeakMap}),Object.defineProperty(this,Ae,{writable:!0,value:void 0}),Object.defineProperty(this,Ce,{writable:!0,value:void 0}),Object.defineProperty(this,_e,{writable:!0,value:void 0}),Object.defineProperty(this,Re,{writable:!0,value:void 0}),Object.defineProperty(this,$e,{writable:!0,value:void 0}),Object.defineProperty(this,Ie,{writable:!0,value:void 0}),Object.defineProperty(this,Le,{writable:!0,value:void 0}),Object.defineProperty(this,Me,{writable:!0,value:void 0}),Object.defineProperty(this,Ne,{writable:!0,value:void 0}),Object.defineProperty(this,De,{writable:!0,value:void 0}),Pe(this,Ie)[Ie]=e,Pe(this,Ne)[Ne]=i,this.setOptions(t)}setOptions(e){const t=Pe(this,Ie)[Ie];var i;("abortMultipartUpload"in e&&(Pe(this,xe)[xe]=t.wrapPromiseFunction(e.abortMultipartUpload,{priority:1})),"createMultipartUpload"in e&&(Pe(this,Ae)[Ae]=t.wrapPromiseFunction(e.createMultipartUpload,{priority:-1})),"signPart"in e&&(Pe(this,Ce)[Ce]=t.wrapPromiseFunction(e.signPart)),"listParts"in e&&(Pe(this,Re)[Re]=t.wrapPromiseFunction(e.listParts)),"completeMultipartUpload"in e&&(Pe(this,Me)[Me]=t.wrapPromiseFunction(e.completeMultipartUpload,{priority:1})),"retryDelays"in e)&&(Pe(this,Le)[Le]=null==(i=e.retryDelays)?void 0:i.values());"uploadPartBytes"in e&&(Pe(this,De)[De]=t.wrapPromiseFunction(e.uploadPartBytes,{priority:1/0})),"getUploadParameters"in e&&(Pe(this,_e)[_e]=t.wrapPromiseFunction(e.getUploadParameters))}async getUploadId(e,t){let i;for(;null!=(i=Pe(this,Fe)[Fe].get(e.data));)try{return await i}catch{}const r=Pe(this,Ae)[Ae](e,t),s=()=>{r.abort(t.reason),Pe(this,Fe)[Fe].delete(e.data)};return t.addEventListener("abort",s,{once:!0}),Pe(this,Fe)[Fe].set(e.data,r),r.then((async i=>{t.removeEventListener("abort",s),Pe(this,Ne)[Ne](e,i),Pe(this,Fe)[Fe].set(e.data,i)}),(()=>{t.removeEventListener("abort",s),Pe(this,Fe)[Fe].delete(e.data)})),r}async abortFileUpload(e){const t=Pe(this,Fe)[Fe].get(e.data);if(null==t)return;let i;Pe(this,Fe)[Fe].delete(e.data),Pe(this,Ne)[Ne](e,Object.create(null));try{i=await t}catch{return}await Pe(this,xe)[xe](e,i)}async uploadFile(e,t,i){if(je(i),1===t.length&&!t[0].shouldUseMultipart)return Pe(this,qe)[qe](e,t[0],i);const{uploadId:r,key:s}=await this.getUploadId(e,i);je(i);try{const n=await Promise.all(t.map(((t,r)=>this.uploadChunk(e,r+1,t,i))));return je(i),await Pe(this,Me)[Me](e,{key:s,uploadId:r,parts:n,signal:i}).abortOn(i)}catch(t){throw(null==t?void 0:t.cause)!==H&&"AbortError"!==(null==t?void 0:t.name)&&this.abortFileUpload(e),t}}restoreUploadFile(e,t){Pe(this,Fe)[Fe].set(e.data,t)}async resumeUploadFile(e,t,i){if(je(i),1===t.length&&!t[0].shouldUseMultipart)return Pe(this,qe)[qe](e,t[0],i);const{uploadId:r,key:s}=await this.getUploadId(e,i);je(i);const n=await Pe(this,Re)[Re](e,{uploadId:r,key:s,signal:i}).abortOn(i);je(i);const o=await Promise.all(t.map(((t,r)=>{const s=r+1,o=n.find((e=>{let{PartNumber:t}=e;return t===s}));return null==o?this.uploadChunk(e,s,t,i):(null==t.setAsUploaded||t.setAsUploaded(),{PartNumber:s,ETag:o.ETag})})));return je(i),Pe(this,Me)[Me](e,{key:s,uploadId:r,parts:o,signal:i}).abortOn(i)}async uploadChunk(e,t,i,r){je(r);const{uploadId:s,key:n}=await this.getUploadId(e,r);for(je(r);;){const o=i.getData(),{onProgress:a,onComplete:l}=i,u=await Pe(this,Ce)[Ce](e,{uploadId:s,key:n,partNumber:t,body:o,signal:r}).abortOn(r);je(r);try{return{PartNumber:t,...await Pe(this,De)[De]({signature:u,body:o,size:o.size,onProgress:a,onComplete:l,signal:r}).abortOn(r)}}catch(e){if(!await Pe(this,ze)[ze](e))throw e}}}}async function He(e){var t;const i=Pe(this,Ie)[Ie],r=null==e||null==(t=e.source)?void 0:t.status;if(null==r)return!1;if(403===r&&"Request has expired"===e.message){if(!i.isPaused){if(1===i.limit||null==Pe(this,$e)[$e]){var s;const e=null==(s=Pe(this,Le)[Le])?void 0:s.next();if(null==e||e.done)return!1;Pe(this,$e)[$e]=e.value}i.rateLimit(0),await new Promise((e=>setTimeout(e,Pe(this,$e)[$e])))}}else if(429===r){if(!i.isPaused){var n;const e=null==(n=Pe(this,Le)[Le])?void 0:n.next();if(null==e||e.done)return!1;i.rateLimit(e.value)}}else{if(r>400&&r<500&&409!==r)return!1;if("undefined"!=typeof navigator&&!1===navigator.onLine)i.isPaused||(i.pause(),window.addEventListener("online",(()=>{i.resume()}),{once:!0}));else{var o;const e=null==(o=Pe(this,Le)[Le])?void 0:o.next();if(null==e||e.done)return!1;await new Promise((t=>setTimeout(t,e.value)))}}return!0}async function Ve(e,t,i){const{method:r="post",url:s,fields:n,headers:o}=await Pe(this,_e)[_e](e,{signal:i}).abortOn(i);let a;const l=t.getData();if("post"===r){const e=new FormData;Object.entries(n).forEach((t=>{let[i,r]=t;return e.set(i,r)})),e.set("file",l),a=e}else a=l;const{onProgress:u,onComplete:h}=t;return Pe(this,De)[De]({signature:{url:s,headers:o,method:r},body:a,size:l.size,onProgress:u,onComplete:h,signal:i}).abortOn(i)}var Xe=ke("companionCommunicationQueue"),Ke=ke("client"),We=ke("cachedTemporaryCredentials"),Ge=ke("getTemporarySecurityCredentials"),Ze=ke("setS3MultipartState"),Ye=ke("uploadFile"),Je=ke("requestSocketToken"),Qe=ke("upload"),et=ke("setCompanionHeaders"),tt=ke("setResumableUploadsCapability"),it=ke("resetResumableCapability");Oe=Symbol.for("uppy test: getClient");class rt extends r.Z{constructor(e,t){var i;super(e,t),Object.defineProperty(this,Ye,{value:nt}),Object.defineProperty(this,Ge,{value:st}),Object.defineProperty(this,Xe,{writable:!0,value:void 0}),Object.defineProperty(this,Ke,{writable:!0,value:void 0}),Object.defineProperty(this,We,{writable:!0,value:void 0}),Object.defineProperty(this,Ze,{writable:!0,value:(e,t)=>{let{key:i,uploadId:r}=t;const s=this.uppy.getFile(e.id);this.uppy.setFileState(e.id,{s3Multipart:{...s.s3Multipart,key:i,uploadId:r}})}}),Object.defineProperty(this,Je,{writable:!0,value:async(e,t)=>{const i=new(e.remote.providerOptions.provider?s.zt:s.C$)(this.uppy,e.remote.providerOptions),r={...this.opts};if(e.tus&&Object.assign(r,e.tus),null==e.remote.url)throw new Error("Cannot connect to an undefined URL");return(await i.post(e.remote.url,{...e.remote.body,protocol:"s3-multipart",size:e.data.size,metadata:e.meta},t)).token}}),Object.defineProperty(this,Qe,{writable:!0,value:async e=>{if(0===e.length)return;const t=function(e){return e.filter((e=>!(e=>"error"in e&&e.error)(e)))}(this.uppy.getFilesByIds(e)),i=function(e){return e.filter((e=>!e.progress.uploadStarted||!e.isRestored))}(t);this.uppy.emit("upload-start",i);const r=t.map((e=>{if(e.isRemote){Pe(this,tt)[tt](!1);const t=new AbortController,i=i=>{i.id===e.id&&t.abort()};this.uppy.on("file-removed",i),this.resetUploaderReferences(e.id);const r=this.uploadRemoteFile(e,{signal:t.signal});return this.requests.wrapSyncFunction((()=>{this.uppy.off("file-removed",i)}),{priority:-1})(),r}return Pe(this,Ye)[Ye](e)})),s=await Promise.all(r);return Pe(this,tt)[tt](!0),s}}),Object.defineProperty(this,et,{writable:!0,value:()=>{Pe(this,Ke)[Ke].setCompanionHeaders(this.opts.companionHeaders)}}),Object.defineProperty(this,tt,{writable:!0,value:e=>{const{capabilities:t}=this.uppy.getState();this.uppy.setState({capabilities:{...t,resumableUploads:e}})}}),Object.defineProperty(this,it,{writable:!0,value:()=>{Pe(this,tt)[tt](!0)}}),this.type="uploader",this.id=this.opts.id||"AwsS3Multipart",this.title="AWS S3 Multipart",Pe(this,Ke)[Ke]=new s.C$(e,t);const r={allowedMetaFields:null,limit:6,shouldUseMultipart:e=>0!==e.size,retryDelays:[0,1e3,3e3,5e3],createMultipartUpload:this.createMultipartUpload.bind(this),listParts:this.listParts.bind(this),abortMultipartUpload:this.abortMultipartUpload.bind(this),completeMultipartUpload:this.completeMultipartUpload.bind(this),getTemporarySecurityCredentials:!1,signPart:null!=t&&t.getTemporarySecurityCredentials?this.createSignedURL.bind(this):this.signPart.bind(this),uploadPartBytes:rt.uploadPartBytes,getUploadParameters:null!=t&&t.getTemporarySecurityCredentials?this.createSignedURL.bind(this):this.getUploadParameters.bind(this),companionHeaders:{}};this.opts={...r,...t},null!=(null==t?void 0:t.prepareUploadParts)&&null==t.signPart&&(this.opts.signPart=async(e,i)=>{let{uploadId:r,key:s,partNumber:n,body:o,signal:a}=i;const{presignedUrls:l,headers:u}=await t.prepareUploadParts(e,{uploadId:r,key:s,parts:[{number:n,chunk:o}],signal:a});return{url:null==l?void 0:l[n],headers:null==u?void 0:u[n]}}),this.requests=null!=(i=this.opts.rateLimitedQueue)?i:new A(this.opts.limit),Pe(this,Xe)[Xe]=new Be(this.requests,this.opts,Pe(this,Ze)[Ze]),this.uploaders=Object.create(null),this.uploaderEvents=Object.create(null),this.uploaderSockets=Object.create(null),this.setQueueRequestSocketToken(this.requests.wrapPromiseFunction(Pe(this,Je)[Je],{priority:-1}))}[Oe](){return Pe(this,Ke)[Ke]}setOptions(e){return Pe(this,Xe)[Xe].setOptions(e),super.setOptions(e)}resetUploaderReferences(e,t){void 0===t&&(t={}),this.uploaders[e]&&(this.uploaders[e].abort({really:t.abort||!1}),this.uploaders[e]=null),this.uploaderEvents[e]&&(this.uploaderEvents[e].remove(),this.uploaderEvents[e]=null),this.uploaderSockets[e]&&(this.uploaderSockets[e].close(),this.uploaderSockets[e]=null)}assertHost(e){if(!this.opts.companionUrl)throw new Error(`Expected a \`companionUrl\` option containing a Companion address, or if you are not using Companion, a custom \`${e}\` implementation.`)}createMultipartUpload(e,t){this.assertHost("createMultipartUpload"),je(t);const i=Ue({meta:e.meta,allowedMetaFields:this.opts.allowedMetaFields});return Pe(this,Ke)[Ke].post("s3/multipart",{filename:e.name,type:e.type,metadata:i},{signal:t}).then(Ee)}listParts(e,t,i){let{key:r,uploadId:s}=t;this.assertHost("listParts"),je(i);const n=encodeURIComponent(r);return Pe(this,Ke)[Ke].get(`s3/multipart/${s}?key=${n}`,{signal:i}).then(Ee)}completeMultipartUpload(e,t,i){let{key:r,uploadId:s,parts:n}=t;this.assertHost("completeMultipartUpload"),je(i);const o=encodeURIComponent(r),a=encodeURIComponent(s);return Pe(this,Ke)[Ke].post(`s3/multipart/${a}/complete?key=${o}`,{parts:n},{signal:i}).then(Ee)}async createSignedURL(e,t){const i=await Pe(this,Ge)[Ge](t),r=Te(i.credentials)||604800,{uploadId:s,key:n,partNumber:o,signal:a}=t;return{method:"PUT",expires:r,fields:{},url:`${await be({accountKey:i.credentials.AccessKeyId,accountSecret:i.credentials.SecretAccessKey,sessionToken:i.credentials.SessionToken,expires:r,bucketName:i.bucket,Region:i.region,Key:null!=n?n:`${crypto.randomUUID()}-${e.name}`,uploadId:s,partNumber:o,signal:a})}`,headers:{"Content-Type":e.type}}}signPart(e,t){let{uploadId:i,key:r,partNumber:s,signal:n}=t;if(this.assertHost("signPart"),je(n),null==i||null==r||null==s)throw new Error("Cannot sign without a key, an uploadId, and a partNumber");const o=encodeURIComponent(r);return Pe(this,Ke)[Ke].get(`s3/multipart/${i}/${s}?key=${o}`,{signal:n}).then(Ee)}abortMultipartUpload(e,t,i){let{key:r,uploadId:s}=t;this.assertHost("abortMultipartUpload");const n=encodeURIComponent(r),o=encodeURIComponent(s);return Pe(this,Ke)[Ke].delete(`s3/multipart/${o}?key=${n}`,void 0,{signal:i}).then(Ee)}getUploadParameters(e,t){const{meta:i}=e,{type:r,name:s}=i,n=Ue({meta:i,allowedMetaFields:this.opts.allowedMetaFields,querify:!0}),o=new URLSearchParams({filename:s,type:r,...n});return Pe(this,Ke)[Ke].get(`s3/params?${o}`,t)}static async uploadPartBytes(e){let{signature:{url:t,expires:i,headers:r,method:s="PUT"},body:n,size:o=n.size,onProgress:a,onComplete:l,signal:u}=e;if(je(u),null==t)throw new Error("Cannot upload to an undefined URL");return new Promise(((e,h)=>{const p=new XMLHttpRequest;function d(){p.abort()}function c(){u.removeEventListener("abort",d)}p.open(s,t,!0),r&&Object.keys(r).forEach((e=>{p.setRequestHeader(e,r[e])})),p.responseType="text","number"==typeof i&&(p.timeout=1e3*i),u.addEventListener("abort",d),p.upload.addEventListener("progress",(e=>{a(e)})),p.addEventListener("abort",(()=>{c(),h(N())})),p.addEventListener("timeout",(()=>{c();const e=new Error("Request has expired");e.source={status:403},h(e)})),p.addEventListener("load",(t=>{if(c(),403===t.target.status&&t.target.responseText.includes("<Message>Request has expired</Message>")){const e=new Error("Request has expired");return e.source=t.target,void h(e)}if(t.target.status<200||t.target.status>=300){const e=new Error("Non 2xx");return e.source=t.target,void h(e)}null==a||a({loaded:o,lengthComputable:!0});const i=t.target.getResponseHeader("ETag");null!==i?(null==l||l(i),e({ETag:i})):h(new Error("AwsS3/Multipart: Could not read the ETag header. This likely means CORS is not configured correctly on the S3 Bucket. See https://uppy.io/docs/aws-s3-multipart#S3-Bucket-Configuration for instructions."))})),p.addEventListener("error",(e=>{c();const t=new Error("Unknown error");t.source=e.target,h(t)})),p.send(n)}))}async connectToServerSocket(e){var t=this;return new Promise(((i,r)=>{let n;const o=e.serverToken,a=function(e){const t=/^(?:https?:\/\/|\/\/)?(?:[^@\n]+@)?(?:www\.)?([^\n]+)/i.exec(e)[1];return`${/^http:\/\//i.test(e)?"ws":"wss"}://${t}`}(e.remote.companionUrl),l=new s.sk({target:`${a}/api/${o}`,autoOpen:!1});this.uploaderSockets[e.id]=l,this.uploaderEvents[e.id]=new h(this.uppy),this.onFileRemove(e.id,(()=>{l.send("cancel",{}),n.abort(),this.resetUploaderReferences(e.id,{abort:!0}),i(`upload ${e.id} was removed`)})),this.onFilePause(e.id,(e=>{e?(l.send("pause",{}),n.abort()):(n.abort(),n=this.requests.run((()=>(l.open(),l.send("resume",{}),()=>{}))))})),this.onPauseAll(e.id,(()=>{l.send("pause",{}),n.abort()})),this.onCancelAll(e.id,(function(r){let{reason:s}=void 0===r?{}:r;"user"===s&&(l.send("cancel",{}),n.abort(),t.resetUploaderReferences(e.id)),i(`upload ${e.id} was canceled`)})),this.onResumeAll(e.id,(()=>{n.abort(),e.error&&l.send("pause",{}),n=this.requests.run((()=>(l.open(),l.send("resume",{}),()=>{})))})),this.onRetry(e.id,(()=>{l.isOpen&&(l.send("pause",{}),l.send("resume",{}))})),this.onRetryAll(e.id,(()=>{l.isOpen&&(l.send("pause",{}),l.send("resume",{}))})),l.on("progress",(t=>d(this,t,e))),l.on("error",(t=>{this.uppy.emit("upload-error",e,new Error(t.error)),this.resetUploaderReferences(e.id),l.close(),n.done(),r(new Error(t.error))})),l.on("success",(t=>{const r={uploadURL:t.url};this.uppy.emit("upload-success",e,r),this.resetUploaderReferences(e.id),l.close(),n.done(),i()})),n=this.requests.run((()=>(e.isPaused?l.send("pause",{}):l.open(),()=>{})))}))}onFileRemove(e,t){this.uploaderEvents[e].on("file-removed",(i=>{e===i.id&&t(i.id)}))}onFilePause(e,t){this.uploaderEvents[e].on("upload-pause",((i,r)=>{e===i&&t(r)}))}onRetry(e,t){this.uploaderEvents[e].on("upload-retry",(i=>{e===i&&t()}))}onRetryAll(e,t){this.uploaderEvents[e].on("retry-all",(()=>{this.uppy.getFile(e)&&t()}))}onPauseAll(e,t){this.uploaderEvents[e].on("pause-all",(()=>{this.uppy.getFile(e)&&t()}))}onCancelAll(e,t){var i=this;this.uploaderEvents[e].on("cancel-all",(function(){i.uppy.getFile(e)&&t(...arguments)}))}onResumeAll(e,t){this.uploaderEvents[e].on("resume-all",(()=>{this.uppy.getFile(e)&&t()}))}install(){Pe(this,tt)[tt](!0),this.uppy.addPreProcessor(Pe(this,et)[et]),this.uppy.addUploader(Pe(this,Qe)[Qe]),this.uppy.on("cancel-all",Pe(this,it)[it])}uninstall(){this.uppy.removePreProcessor(Pe(this,et)[et]),this.uppy.removeUploader(Pe(this,Qe)[Qe]),this.uppy.off("cancel-all",Pe(this,it)[it])}}async function st(e){return je(null==e?void 0:e.signal),null==Pe(this,We)[We]&&(!0===this.opts.getTemporarySecurityCredentials?(this.assertHost("getTemporarySecurityCredentials"),Pe(this,We)[We]=Pe(this,Ke)[Ke].get("s3/sts",null,e).then(Ee)):Pe(this,We)[We]=this.opts.getTemporarySecurityCredentials(e),Pe(this,We)[We]=await Pe(this,We)[We],setTimeout((()=>{Pe(this,We)[We]=null}),500*(Te(Pe(this,We)[We].credentials)||0))),Pe(this,We)[We]}function nt(e){var t=this;return new Promise(((i,r)=>{const s=()=>this.uppy.getFile(e.id)||e,n=new fe(e.data,{companionComm:Pe(this,Xe)[Xe],log:function(){return t.uppy.log(...arguments)},getChunkSize:this.opts.getChunkSize?this.opts.getChunkSize.bind(this):null,onProgress:(t,i)=>{this.uppy.emit("upload-progress",e,{uploader:this,bytesUploaded:t,bytesTotal:i})},onError:t=>{this.uppy.log(t),this.uppy.emit("upload-error",e,t),this.resetUploaderReferences(e.id),r(t)},onSuccess:t=>{const r={body:{...t},uploadURL:t.location};this.resetUploaderReferences(e.id),this.uppy.emit("upload-success",s(),r),t.location&&this.uppy.log(`Download ${e.name} from ${t.location}`),i()},onPartComplete:e=>{this.uppy.emit("s3-multipart:part-uploaded",s(),e)},file:e,shouldUseMultipart:this.opts.shouldUseMultipart,...e.s3Multipart});this.uploaders[e.id]=n,this.uploaderEvents[e.id]=new h(this.uppy),this.onFileRemove(e.id,(t=>{n.abort(),this.resetUploaderReferences(e.id,{abort:!0}),i(`upload ${t.id} was removed`)})),this.onCancelAll(e.id,(function(r){let{reason:s}=void 0===r?{}:r;"user"===s&&(n.abort(),t.resetUploaderReferences(e.id,{abort:!0})),i(`upload ${e.id} was canceled`)})),this.onFilePause(e.id,(e=>{e?n.pause():n.start()})),this.onPauseAll(e.id,(()=>{n.pause()})),this.onResumeAll(e.id,(()=>{n.start()})),n.start()}))}function ot(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}rt.VERSION="3.5.0";var at=0;function lt(e){return"__private_"+at+++"_"+e}function ut(e){if(null!=e){var t;const i=()=>this.abort(e.reason);e.addEventListener("abort",i,{once:!0});const r=()=>{e.removeEventListener("abort",i)};null==(t=this.then)||t.call(this,r,r)}return this}var ht=lt("activeRequests"),pt=lt("queuedHandlers"),dt=lt("paused"),ct=lt("pauseTimer"),ft=lt("downLimit"),mt=lt("upperLimit"),gt=lt("rateLimitingTimer"),yt=lt("call"),vt=lt("queueNext"),wt=lt("next"),bt=lt("queue"),Ot=lt("dequeue"),Pt=lt("resume"),St=lt("increaseLimit");class kt{constructor(e){Object.defineProperty(this,Ot,{value:xt}),Object.defineProperty(this,bt,{value:jt}),Object.defineProperty(this,wt,{value:Ut}),Object.defineProperty(this,vt,{value:Tt}),Object.defineProperty(this,yt,{value:Et}),Object.defineProperty(this,ht,{writable:!0,value:0}),Object.defineProperty(this,pt,{writable:!0,value:[]}),Object.defineProperty(this,dt,{writable:!0,value:!1}),Object.defineProperty(this,ct,{writable:!0,value:void 0}),Object.defineProperty(this,ft,{writable:!0,value:1}),Object.defineProperty(this,mt,{writable:!0,value:void 0}),Object.defineProperty(this,gt,{writable:!0,value:void 0}),Object.defineProperty(this,Pt,{writable:!0,value:()=>this.resume()}),Object.defineProperty(this,St,{writable:!0,value:()=>{if(ot(this,dt)[dt])ot(this,gt)[gt]=setTimeout(ot(this,St)[St],0);else{ot(this,ft)[ft]=this.limit,this.limit=Math.ceil((ot(this,mt)[mt]+ot(this,ft)[ft])/2);for(let e=ot(this,ft)[ft];e<=this.limit;e++)ot(this,vt)[vt]();ot(this,mt)[mt]-ot(this,ft)[ft]>3?ot(this,gt)[gt]=setTimeout(ot(this,St)[St],2e3):ot(this,ft)[ft]=Math.floor(ot(this,ft)[ft]/2)}}}),this.limit="number"!=typeof e||0===e?1/0:e}run(e,t){return!ot(this,dt)[dt]&&ot(this,ht)[ht]<this.limit?ot(this,yt)[yt](e):ot(this,bt)[bt](e,t)}wrapSyncFunction(e,t){var i=this;return function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];const o=i.run((()=>(e(...s),queueMicrotask((()=>o.done())),()=>{})),t);return{abortOn:ut,abort(){o.abort()}}}}wrapPromiseFunction(e,t){var i=this;return function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];let o;const a=new Promise(((r,n)=>{o=i.run((()=>{let t,i;try{i=Promise.resolve(e(...s))}catch(e){i=Promise.reject(e)}return i.then((e=>{t?n(t):(o.done(),r(e))}),(e=>{t?n(t):(o.done(),n(e))})),e=>{t=function(e){return new Error("Cancelled",{cause:e})}(e)}}),t)}));return a.abort=e=>{o.abort(e)},a.abortOn=ut,a}}resume(){ot(this,dt)[dt]=!1,clearTimeout(ot(this,ct)[ct]);for(let e=0;e<this.limit;e++)ot(this,vt)[vt]()}pause(e){void 0===e&&(e=null),ot(this,dt)[dt]=!0,clearTimeout(ot(this,ct)[ct]),null!=e&&(ot(this,ct)[ct]=setTimeout(ot(this,Pt)[Pt],e))}rateLimit(e){clearTimeout(ot(this,gt)[gt]),this.pause(e),this.limit>1&&Number.isFinite(this.limit)&&(ot(this,mt)[mt]=this.limit-1,this.limit=ot(this,ft)[ft],ot(this,gt)[gt]=setTimeout(ot(this,St)[St],e))}get isPaused(){return ot(this,dt)[dt]}}function Et(e){ot(this,ht)[ht]+=1;let t,i=!1;try{t=e()}catch(e){throw ot(this,ht)[ht]-=1,e}return{abort:e=>{i||(i=!0,ot(this,ht)[ht]-=1,t(e),ot(this,vt)[vt]())},done:()=>{i||(i=!0,ot(this,ht)[ht]-=1,ot(this,vt)[vt]())}}}function Tt(){queueMicrotask((()=>ot(this,wt)[wt]()))}function Ut(){if(ot(this,dt)[dt]||ot(this,ht)[ht]>=this.limit)return;if(0===ot(this,pt)[pt].length)return;const e=ot(this,pt)[pt].shift(),t=ot(this,yt)[yt](e.fn);e.abort=t.abort,e.done=t.done}function jt(e,t){void 0===t&&(t={});const i={fn:e,priority:t.priority||0,abort:()=>{ot(this,Ot)[Ot](i)},done:()=>{throw new Error("Cannot mark a queued request as done: this indicates a bug")}},r=ot(this,pt)[pt].findIndex((e=>i.priority>e.priority));return-1===r?ot(this,pt)[pt].push(i):ot(this,pt)[pt].splice(r,0,i),i}function xt(e){const t=ot(this,pt)[pt].indexOf(e);-1!==t&&ot(this,pt)[pt].splice(t,1)}const Ft=Symbol("__queue");var At=i(9022);var Ct=p((function(e,t,i){const{progress:r,bytesUploaded:s,bytesTotal:n}=t;r&&(e.uppy.log(`Upload progress: ${r}`),e.uppy.emit("upload-progress",i,{uploader:e,bytesUploaded:s,bytesTotal:n}))}),300,{leading:!0,trailing:!0});function _t(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Rt=0;function $t(e){return"__private_"+Rt+++"_"+e}var It=$t("emitter"),Lt=$t("events");class Mt{constructor(e){Object.defineProperty(this,It,{writable:!0,value:void 0}),Object.defineProperty(this,Lt,{writable:!0,value:[]}),_t(this,It)[It]=e}on(e,t){return _t(this,Lt)[Lt].push([e,t]),_t(this,It)[It].on(e,t)}remove(){for(const[e,t]of _t(this,Lt)[Lt].splice(0))_t(this,It)[It].off(e,t)}}function Nt(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Dt=0;function zt(e){return"__private_"+Dt+++"_"+e}var qt=zt("aliveTimer"),Bt=zt("isDone"),Ht=zt("onTimedOut"),Vt=zt("timeout");var Xt=class{constructor(e,t){Object.defineProperty(this,qt,{writable:!0,value:void 0}),Object.defineProperty(this,Bt,{writable:!0,value:!1}),Object.defineProperty(this,Ht,{writable:!0,value:void 0}),Object.defineProperty(this,Vt,{writable:!0,value:void 0}),Nt(this,Vt)[Vt]=e,Nt(this,Ht)[Ht]=t}progress(){Nt(this,Bt)[Bt]||Nt(this,Vt)[Vt]>0&&(clearTimeout(Nt(this,qt)[qt]),Nt(this,qt)[qt]=setTimeout(Nt(this,Ht)[Ht],Nt(this,Vt)[Vt]))}done(){Nt(this,Bt)[Bt]||(clearTimeout(Nt(this,qt)[qt]),Nt(this,qt)[qt]=null,Nt(this,Bt)[Bt]=!0)}};class Kt extends Error{constructor(e,t){var i,r;void 0===t&&(t={}),super(e),this.cause=t.cause,this.cause&&(i=this.cause,r="isNetworkError",Object.prototype.hasOwnProperty.call(i,r))&&(this.isNetworkError=this.cause.isNetworkError)}}var Wt=Kt;class Gt extends Error{constructor(e,t){void 0===t&&(t=null),super("This looks like a network error, the endpoint might be blocked by an internet provider or a firewall."),this.cause=e,this.isNetworkError=!0,this.request=t}}var Zt=Gt;var Yt=function(e){return!!e&&(0!==e.readyState&&4!==e.readyState||0===e.status)};function Jt(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Qt=0;function ei(e){return"__private_"+Qt+++"_"+e}function ti(e,t){if(Yt(e))return new Zt(t,e);const i=new Wt("Upload error",{cause:t});return i.request=e,i}function ii(e,t){const i=new FormData;!function(e,t,i){(Array.isArray(i.allowedMetaFields)?i.allowedMetaFields:Object.keys(t)).forEach((i=>{e.append(i,t[i])}))}(i,e.meta,t);const r=function(e){return e.data.slice(0,e.data.size,e.meta.type)}(e);return e.name?i.append(t.fieldName,r,e.meta.name):i.append(t.fieldName,r),i}var ri=ei("addEventHandlerForFile"),si=ei("addEventHandlerIfFileStillExists");class ni{constructor(e,t){Object.defineProperty(this,si,{value:ai}),Object.defineProperty(this,ri,{value:oi}),this.uppy=e,this.opts={validateStatus(e){return e>=200&&e<300},...t},this.requests=t[Ft],this.uploaderEvents=Object.create(null),this.i18n=t.i18n}getOptions(e){var t;const{uppy:i}=this,r=i.getState().xhrUpload;return{...this.opts,...r||{},...e.xhrUpload||{},headers:{...this.opts.headers,...null==r?void 0:r.headers,...null==(t=e.xhrUpload)?void 0:t.headers}}}uploadLocalFile(e){const t=this.getOptions(e);return new Promise(((i,r)=>{const s=t.formData?ii(e,t):(e=>e.data)(e),n=new XMLHttpRequest;this.uploaderEvents[e.id]=new Mt(this.uppy);const o=new Xt(t.timeout,(()=>{n.abort(),l.done();const i=new Error(this.i18n("timedOut",{seconds:Math.ceil(t.timeout/1e3)}));this.uppy.emit("upload-error",e,i),r(i)})),a=(0,At.x)();n.upload.addEventListener("loadstart",(()=>{this.uppy.log(`[AwsS3/XHRUpload] ${a} started`)})),n.upload.addEventListener("progress",(t=>{this.uppy.log(`[AwsS3/XHRUpload] ${a} progress: ${t.loaded} / ${t.total}`),o.progress(),t.lengthComputable&&this.uppy.emit("upload-progress",e,{uploader:this,bytesUploaded:t.loaded,bytesTotal:t.total})})),n.addEventListener("load",(s=>{if(this.uppy.log(`[AwsS3/XHRUpload] ${a} finished`),o.done(),l.done(),this.uploaderEvents[e.id]&&(this.uploaderEvents[e.id].remove(),this.uploaderEvents[e.id]=null),t.validateStatus(s.target.status,n.responseText,n)){const r=t.getResponseData(n.responseText,n),o=r[t.responseUrlFieldName],a={status:s.target.status,body:r,uploadURL:o};return this.uppy.emit("upload-success",e,a),o&&this.uppy.log(`Download ${e.name} from ${o}`),i(e)}const u=t.getResponseData(n.responseText,n),h=ti(n,t.getResponseError(n.responseText,n)),p={status:s.target.status,body:u};return this.uppy.emit("upload-error",e,h,p),r(h)})),n.addEventListener("error",(()=>{this.uppy.log(`[AwsS3/XHRUpload] ${a} errored`),o.done(),l.done(),this.uploaderEvents[e.id]&&(this.uploaderEvents[e.id].remove(),this.uploaderEvents[e.id]=null);const i=ti(n,t.getResponseError(n.responseText,n));return this.uppy.emit("upload-error",e,i),r(i)})),n.open(t.method.toUpperCase(),t.endpoint,!0),n.withCredentials=Boolean(t.withCredentials),""!==t.responseType&&(n.responseType=t.responseType),Object.keys(t.headers).forEach((e=>{n.setRequestHeader(e,t.headers[e])}));const l=this.requests.run((()=>(n.send(s),()=>{o.done(),n.abort()})),{priority:1});Jt(this,ri)[ri]("file-removed",e.id,(()=>{l.abort(),r(new Error("File removed"))})),Jt(this,si)[si]("cancel-all",e.id,(function(e){let{reason:t}=void 0===e?{}:e;"user"===t&&l.abort(),r(new Error("Upload cancelled"))}))}))}async connectToServerSocket(e){return new Promise(((t,i)=>{const r=this.getOptions(e),n=e.serverToken,o=function(e){const t=/^(?:https?:\/\/|\/\/)?(?:[^@\n]+@)?(?:www\.)?([^\n]+)/i.exec(e)[1];return`${/^http:\/\//i.test(e)?"ws":"wss"}://${t}`}(e.remote.companionUrl);let a;const l=()=>{null==a&&(a=new s.sk({target:`${o}/api/${n}`}),a.on("progress",(t=>Ct(this,t,e))),a.on("success",(i=>{const s=r.getResponseData(i.response.responseText,i.response),n=s[r.responseUrlFieldName],o={status:i.response.status,body:s,uploadURL:n,bytesUploaded:i.bytesUploaded};return this.uppy.emit("upload-success",e,o),u.done(),a.close(),this.uploaderEvents[e.id]&&(this.uploaderEvents[e.id].remove(),this.uploaderEvents[e.id]=null),t()})),a.on("error",(t=>{const s=t.response,n=s?r.getResponseError(s.responseText,s):new Wt(t.error.message,{cause:t.error});this.uppy.emit("upload-error",e,n),u.done(),this.uploaderEvents[e.id]&&(this.uploaderEvents[e.id].remove(),this.uploaderEvents[e.id]=null),i(n)})))};this.uploaderEvents[e.id]=new Mt(this.uppy);let u=this.requests.run((()=>{var t;e.isPaused?null==(t=a)||t.send("pause",{}):l();return()=>a.close()}));Jt(this,ri)[ri]("file-removed",e.id,(()=>{var i;null==(i=a)||i.send("cancel",{}),u.abort(),t(`upload ${e.id} was removed`)})),Jt(this,si)[si]("cancel-all",e.id,(function(i){let{reason:r}=void 0===i?{}:i;var s;"user"===r&&(null==(s=a)||s.send("cancel",{}),u.abort());t(`upload ${e.id} was canceled`)}));const h=()=>{null==a?u.abort():(a.send("pause",{}),u.done()),u=this.requests.run((()=>(e.isPaused||(null==a?l():a.send("resume",{})),()=>a.close())))};Jt(this,ri)[ri]("upload-retry",e.id,h),Jt(this,si)[si]("retry-all",e.id,h)})).catch((t=>(this.uppy.emit("upload-error",e,t),Promise.reject(t))))}}function oi(e,t,i){this.uploaderEvents[t].on(e,(e=>{var r;const s=null!=(r=null==e?void 0:e.id)?r:e;t===s&&i()}))}function ai(e,t,i){var r=this;this.uploaderEvents[t].on(e,(function(){r.uppy.getFile(t)&&i(...arguments)}))}var li=function(e,t){const i=t.headers?t.headers["content-type"]:t.getResponseHeader("Content-Type");if("string"==typeof i){const t=(r=i,r.replace(/;.*$/,"")).toLowerCase();if("application/xml"===t||"text/xml"===t)return!0;if("text/html"===t&&/^<\?xml /.test(e))return!0}var r;return!1},ui={strings:{timedOut:"Upload stalled for %{seconds} seconds, aborting."}};let hi;function pi(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var di=0;function ci(e){return"__private_"+di+++"_"+e}function fi(e,t){const i=e.indexOf(`<${t}>`),r=e.indexOf(`</${t}>`,i);return-1!==i&&-1!==r?e.slice(i+t.length+2,r):""}function mi(e){if(e&&e.error){const t=new Error(e.message);throw Object.assign(t,e.error),t}return e}function gi(e,t){if(!li(e,t))return;const i=fi(e,"Message");return new Error(i)}let yi=!1;var vi=ci("client"),wi=ci("requests"),bi=ci("uploader"),Oi=ci("handleUpload"),Pi=ci("setCompanionHeaders"),Si=ci("requestSocketToken");hi=Symbol.for("uppy test: getClient");class ki extends r.Z{constructor(e,t){if(null!=(null==t?void 0:t.shouldUseMultipart))return new rt(e,t);super(e,t),Object.defineProperty(this,vi,{writable:!0,value:void 0}),Object.defineProperty(this,wi,{writable:!0,value:void 0}),Object.defineProperty(this,bi,{writable:!0,value:void 0}),Object.defineProperty(this,Oi,{writable:!0,value:async e=>{const t=Object.create(null);function i(e){var i;const{id:r}=e;null==(i=t[r])||i.abort()}this.uppy.on("file-removed",i);const r=function(e){return e.filter((e=>!(e=>"error"in e&&e.error)(e)))}(this.uppy.getFilesByIds(e)),s=function(e){return e.filter((e=>!e.progress.uploadStarted||!e.isRestored))}(r);this.uppy.emit("upload-start",s);const n=pi(this,wi)[wi].wrapPromiseFunction((e=>this.opts.getUploadParameters(e))),o=e.length;return Promise.allSettled(e.map(((e,i)=>(t[e]=n(this.uppy.getFile(e)),t[e].then((r=>{delete t[e];const s=this.uppy.getFile(e);!function(e,t){if(null==t||"string"!=typeof t.url||"object"!=typeof t.fields&&null!=t.fields)throw new TypeError(`AwsS3: got incorrect result from 'getUploadParameters()' for file '${e.name}', expected an object '{ url, method, fields, headers }' but got '${JSON.stringify(t)}' instead.\nSee https://uppy.io/docs/aws-s3/#getUploadParameters-file for more on the expected format.`);if(null!=t.method&&!/^p(u|os)t$/i.test(t.method))throw new TypeError(`AwsS3: got incorrect method from 'getUploadParameters()' for file '${e.name}', expected  'put' or 'post' but got '${t.method}' instead.\nSee https://uppy.io/docs/aws-s3/#getUploadParameters-file for more on the expected format.`)}(s,r);const{method:n="post",url:a,fields:l,headers:u}=r,h={method:n,formData:"post"===n.toLowerCase(),endpoint:a,allowedMetaFields:l?Object.keys(l):[]};return u&&(h.headers=u),this.uppy.setFileState(s.id,{meta:{...s.meta,...l},xhrUpload:h}),this.uploadFile(s.id,i,o)})).catch((i=>{delete t[e];const r=this.uppy.getFile(e);return this.uppy.emit("upload-error",r,i),Promise.reject(i)})))))).finally((()=>{this.uppy.off("file-removed",i)}))}}),Object.defineProperty(this,Pi,{writable:!0,value:()=>(pi(this,vi)[vi].setCompanionHeaders(this.opts.companionHeaders),Promise.resolve())}),Object.defineProperty(this,Si,{writable:!0,value:async e=>{const t=pi(this,bi)[bi].getOptions(e),i=new(e.remote.providerOptions.provider?s.zt:s.C$)(this.uppy,e.remote.providerOptions),r=Array.isArray(t.allowedMetaFields)?t.allowedMetaFields:Object.keys(e.meta);e.tus&&Object.assign(t,e.tus);return(await i.post(e.remote.url,{...e.remote.body,protocol:"multipart",endpoint:t.endpoint,size:e.data.size,fieldname:t.fieldName,metadata:Object.fromEntries(r.map((t=>[t,e.meta[t]]))),httpMethod:t.method,useFormData:t.formData,headers:t.headers})).token}}),this.type="uploader",this.id=this.opts.id||"AwsS3",this.title="AWS S3",this.defaultLocale=ui;const i={timeout:3e4,limit:0,allowedMetaFields:[],getUploadParameters:this.getUploadParameters.bind(this),shouldUseMultipart:!1,companionHeaders:{}};if(this.opts={...i,...t},void 0===(null==t?void 0:t.allowedMetaFields)&&"metaFields"in this.opts)throw new Error("The `metaFields` option has been renamed to `allowedMetaFields`.");this.i18nInit(),pi(this,vi)[vi]=new s.C$(e,t),pi(this,wi)[wi]=new kt(this.opts.limit),this.setQueueRequestSocketToken(pi(this,wi)[wi].wrapPromiseFunction(pi(this,Si)[Si],{priority:-1}))}[hi](){return pi(this,vi)[vi]}get client(){return pi(this,vi)[vi]}set client(e){pi(this,vi)[vi]=e}getUploadParameters(e){if(!this.opts.companionUrl)throw new Error("Expected a `companionUrl` option containing a Companion address.");const t=e.meta.name,{type:i}=e.meta,r=Object.fromEntries(this.opts.allowedMetaFields.filter((t=>null!=e.meta[t])).map((t=>[`metadata[${t}]`,e.meta[t].toString()]))),s=new URLSearchParams({filename:t,type:i,...r});return pi(this,vi)[vi].get(`s3/params?${s}`).then(mi)}connectToServerSocket(e){return pi(this,bi)[bi].connectToServerSocket(e)}uploadFile(e,t,i){const r=this.uppy.getFile(e);if(this.uppy.log(`uploading ${t} of ${i}`),r.error)throw new Error(r.error);if(r.isRemote){const e=new AbortController,t=t=>{t.id===r.id&&e.abort()};this.uppy.on("file-removed",t);const i=this.uploadRemoteFile(r,{signal:e.signal});return pi(this,wi)[wi].wrapSyncFunction((()=>{this.uppy.off("file-removed",t)}),{priority:-1})(),i}return pi(this,bi)[bi].uploadLocalFile(r,t,i)}install(){const{uppy:e}=this;e.addPreProcessor(pi(this,Pi)[Pi]),e.addUploader(pi(this,Oi)[Oi]);const t={fieldName:"file",responseUrlFieldName:"location",timeout:this.opts.timeout,[Ft]:pi(this,wi)[wi],responseType:"text",getResponseData:this.opts.getResponseData||function(t,i){const r=this;return li(t,i)?{location:(s=i.responseURL,n=fi(t,"Location"),s||n.startsWith("https://")||n.startsWith("http://")||(n=`https://${n}`),new URL(n,s||void 0).toString()),bucket:fi(t,"Bucket"),key:fi(t,"Key"),etag:fi(t,"ETag")}:"POST"===r.method.toUpperCase()?(yi||(e.log("[AwsS3] No response data found, make sure to set the success_action_status AWS SDK option to 201. See https://uppy.io/docs/aws-s3/#POST-Uploads","warning"),yi=!0),{location:null}):i.responseURL?{location:i.responseURL.replace(/\?.*$/,"")}:{location:null};var s,n},getResponseError:gi};t.i18n=this.i18n,pi(this,bi)[bi]=new ni(e,t)}uninstall(){this.uppy.removePreProcessor(pi(this,Pi)[Pi]),this.uppy.removeUploader(pi(this,Oi)[Oi])}}ki.VERSION="3.2.1"},9537:function(e,t,i){"use strict";i.d(t,{zt:function(){return j},C$:function(){return y},sk:function(){return q}});var r={};i.r(r),i.d(r,{getItem:function(){return b},removeItem:function(){return O},setItem:function(){return w}});class s extends Error{constructor(e,t){void 0===t&&(t=null),super("This looks like a network error, the endpoint might be blocked by an internet provider or a firewall."),this.cause=e,this.isNetworkError=!0,this.request=t}}var n=s;class o extends Error{constructor(e,t){var i,r;void 0===t&&(t={}),super(e),this.cause=t.cause,this.cause&&(i=this.cause,r="isNetworkError",Object.prototype.hasOwnProperty.call(i,r))&&(this.isNetworkError=this.cause.isNetworkError)}}var a=o;class l extends Error{constructor(){super("Authorization required"),this.name="AuthError",this.isAuthError=!0}}var u=l;let h;function p(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var d=0;function c(e){return"__private_"+d+++"_"+e}const f=new Map;var m=c("companionHeaders"),g=c("getUrl");h=Symbol.for("uppy test: getCompanionHeaders");class y{constructor(e,t){Object.defineProperty(this,g,{value:v}),Object.defineProperty(this,m,{writable:!0,value:void 0}),this.uppy=e,this.opts=t,this.onReceiveResponse=this.onReceiveResponse.bind(this),p(this,m)[m]=null==t?void 0:t.companionHeaders}setCompanionHeaders(e){p(this,m)[m]=e}[h](){return p(this,m)[m]}get hostname(){const{companion:e}=this.uppy.getState(),t=this.opts.companionUrl;return(e&&e[t]?e[t]:t).replace(/\/$/,"")}async headers(){return{...{Accept:"application/json","Content-Type":"application/json","Uppy-Versions":`@uppy/companion-client=${y.VERSION}`},...p(this,m)[m]}}onReceiveResponse(e){let{headers:t}=e;const i=this.uppy.getState().companion||{},r=this.opts.companionUrl;t.has("i-am")&&t.get("i-am")!==i[r]&&this.uppy.setState({companion:{...i,[r]:t.get("i-am")}})}async preflight(e){const t=f.get(this.hostname);if(null!=t)return t;const i=["accept","content-type","uppy-auth-token"],r=(async()=>{try{const t=(await fetch(p(this,g)[g](e),{method:"OPTIONS"})).headers.get("access-control-allow-headers");if(null==t||"*"===t)return f.set(this.hostname,i),i;this.uppy.log(`[CompanionClient] adding allowed preflight headers to companion cache: ${this.hostname} ${t}`);const r=t.split(",").map((e=>e.trim().toLowerCase()));return f.set(this.hostname,r),r}catch(e){return this.uppy.log(`[CompanionClient] unable to make preflight request ${e}`,"warning"),f.delete(this.hostname),i}})();return f.set(this.hostname,r),r}async preflightAndHeaders(e){const[t,i]=await Promise.all([this.preflight(e),this.headers()]);return Object.fromEntries(Object.entries(i).filter((e=>{let[i]=e;return!!t.includes(i.toLowerCase())||(this.uppy.log(`[CompanionClient] excluding disallowed header ${i}`),!1)})))}async request(e){let{path:t,method:i="GET",data:r,skipPostResponse:s,signal:o}=e;try{const e=await this.preflightAndHeaders(t),a=await function(){return fetch(...arguments).catch((e=>{throw"AbortError"===e.name?e:new n(e)}))}(p(this,g)[g](t),{method:i,signal:o,headers:e,credentials:this.opts.companionCookiesRule||"same-origin",body:r?JSON.stringify(r):null});return s||this.onReceiveResponse(a),async function(e){if(401===e.status)throw new u;const t=e.json();if(e.ok)return t;let i=`Failed request with status: ${e.status}. ${e.statusText}`;try{const e=await t;i=e.message?`${i} message: ${e.message}`:i,i=e.requestId?`${i} request-Id: ${e.requestId}`:i}catch{}throw new Error(i)}(a)}catch(e){if(null!=e&&e.isAuthError)throw e;throw new a(`Could not ${i} ${p(this,g)[g](t)}`,{cause:e})}}async get(e,t){return void 0===t&&(t=void 0),"boolean"==typeof t&&(t={skipPostResponse:t}),this.request({...t,path:e})}async post(e,t,i){return void 0===i&&(i=void 0),"boolean"==typeof i&&(i={skipPostResponse:i}),this.request({...i,path:e,method:"POST",data:t})}async delete(e,t,i){return void 0===t&&(t=void 0),"boolean"==typeof i&&(i={skipPostResponse:i}),this.request({...i,path:e,method:"DELETE",data:t})}}function v(e){return/^(https?:|)\/\//.test(e)?e:`${this.hostname}/${e}`}function w(e,t){return new Promise((i=>{localStorage.setItem(e,t),i()}))}function b(e){return Promise.resolve(localStorage.getItem(e))}function O(e){return new Promise((t=>{localStorage.removeItem(e),t()}))}function P(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}y.VERSION="3.2.1";var S=0;function k(e){return"__private_"+S+++"_"+e}var E=k("refreshingTokenPromise"),T=k("getAuthToken"),U=k("removeAuthToken");class j extends y{constructor(e,t){super(e,t),Object.defineProperty(this,U,{value:F}),Object.defineProperty(this,T,{value:x}),Object.defineProperty(this,E,{writable:!0,value:void 0}),this.provider=t.provider,this.id=this.provider,this.name=this.opts.name||(e=>e.split("-").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" "))(this.id),this.pluginId=this.opts.pluginId,this.tokenKey=`companion-${this.pluginId}-auth-token`,this.companionKeysParams=this.opts.companionKeysParams,this.preAuthToken=null}async headers(){const[e,t]=await Promise.all([super.headers(),P(this,T)[T]()]),i={};return t&&(i["uppy-auth-token"]=t),this.companionKeysParams&&(i["uppy-credentials-params"]=btoa(JSON.stringify({params:this.companionKeysParams}))),{...e,...i}}onReceiveResponse(e){super.onReceiveResponse(e);const t=this.uppy.getPlugin(this.pluginId),i=t.getPluginState().authenticated?401!==e.status:e.status<400;return t.setPluginState({authenticated:i}),e}async setAuthToken(e){return this.uppy.getPlugin(this.pluginId).storage.setItem(this.tokenKey,e)}async ensurePreAuth(){if(this.companionKeysParams&&!this.preAuthToken&&(await this.fetchPreAuthToken(),!this.preAuthToken))throw new Error("Could not load authentication data required for third-party login. Please try again later.")}authUrl(e){void 0===e&&(e={});const t=new URLSearchParams(e);return this.preAuthToken&&t.set("uppyPreAuthToken",this.preAuthToken),`${this.hostname}/${this.id}/connect?${t}`}refreshTokenUrl(){return`${this.hostname}/${this.id}/refresh-token`}fileUrl(e){return`${this.hostname}/${this.id}/get/${e}`}async request(){await P(this,E)[E];try{return await super.request(...arguments)}catch(e){if(!e.isAuthError)throw e;return await P(this,E)[E],P(this,E)[E]=(async()=>{try{const e=await super.request({path:this.refreshTokenUrl(),method:"POST"});await this.setAuthToken(e.uppyAuthToken)}finally{P(this,E)[E]=void 0}})(),await P(this,E)[E],super.request(...arguments)}}async fetchPreAuthToken(){if(this.companionKeysParams)try{const e=await this.post(`${this.id}/preauth/`,{params:this.companionKeysParams});this.preAuthToken=e.token}catch(e){this.uppy.log(`[CompanionClient] unable to fetch preAuthToken ${e}`,"warning")}}list(e,t){return this.get(`${this.id}/list/${e||""}`,t)}async logout(){const e=await this.get(`${this.id}/logout`);return await P(this,U)[U](),e}static initPlugin(e,t,i){if(e.type="acquirer",e.files=[],i&&(e.opts={...i,...t}),t.serverUrl||t.serverPattern)throw new Error("`serverUrl` and `serverPattern` have been renamed to `companionUrl` and `companionAllowedHosts` respectively in the 0.30.5 release. Please consult the docs (for example, https://uppy.io/docs/instagram/ for the Instagram plugin) and use the updated options.`");if(t.companionAllowedHosts){const i=t.companionAllowedHosts;if(!("string"==typeof i||Array.isArray(i)||i instanceof RegExp))throw new TypeError(`${e.id}: the option "companionAllowedHosts" must be one of string, Array, RegExp`);e.opts.companionAllowedHosts=i}else/^(?!https?:\/\/).*$/i.test(t.companionUrl)?e.opts.companionAllowedHosts=`https://${t.companionUrl.replace(/^\/\//,"")}`:e.opts.companionAllowedHosts=new URL(t.companionUrl).origin;e.storage=e.opts.storage||r}}async function x(){return this.uppy.getPlugin(this.pluginId).storage.getItem(this.tokenKey)}async function F(){return this.uppy.getPlugin(this.pluginId).storage.removeItem(this.tokenKey)}var A=i(4800);let C,_;function R(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var $=0;function I(e){return"__private_"+$+++"_"+e}var L=I("queued"),M=I("emitter"),N=I("isOpen"),D=I("socket"),z=I("handleMessage");C=Symbol.for("uppy test: getSocket"),_=Symbol.for("uppy test: getQueued");class q{constructor(e){Object.defineProperty(this,L,{writable:!0,value:[]}),Object.defineProperty(this,M,{writable:!0,value:A()}),Object.defineProperty(this,N,{writable:!0,value:!1}),Object.defineProperty(this,D,{writable:!0,value:void 0}),Object.defineProperty(this,z,{writable:!0,value:e=>{try{const t=JSON.parse(e.data);this.emit(t.action,t.payload)}catch(e){}}}),this.opts=e,e&&!1===e.autoOpen||this.open()}get isOpen(){return R(this,N)[N]}[C](){return R(this,D)[D]}[_](){return R(this,L)[L]}open(){null==R(this,D)[D]&&(R(this,D)[D]=new WebSocket(this.opts.target),R(this,D)[D].onopen=()=>{for(R(this,N)[N]=!0;R(this,L)[L].length>0&&R(this,N)[N];){const e=R(this,L)[L].shift();this.send(e.action,e.payload)}},R(this,D)[D].onclose=()=>{R(this,N)[N]=!1,R(this,D)[D]=null},R(this,D)[D].onmessage=R(this,z)[z])}close(){var e;null==(e=R(this,D)[D])||e.close()}send(e,t){R(this,N)[N]?R(this,D)[D].send(JSON.stringify({action:e,payload:t})):R(this,L)[L].push({action:e,payload:t})}on(e,t){R(this,M)[M].on(e,t)}emit(e,t){R(this,M)[M].emit(e,t)}once(e,t){R(this,M)[M].once(e,t)}}},8596:function(e,t,i){"use strict";i.d(t,{Z:function(){return s}});var r=i(4136);class s{constructor(e,t){void 0===t&&(t={}),this.uppy=e,this.opts=t}getPluginState(){const{plugins:e}=this.uppy.getState();return e[this.id]||{}}setPluginState(e){const{plugins:t}=this.uppy.getState();this.uppy.setState({plugins:{...t,[this.id]:{...t[this.id],...e}}})}setOptions(e){this.opts={...this.opts,...e},this.setPluginState(),this.i18nInit()}i18nInit(){const e=new r.Z([this.defaultLocale,this.uppy.locale,this.opts.locale]);this.i18n=e.translate.bind(e),this.i18nArray=e.translateArray.bind(e),this.setPluginState()}addTarget(){throw new Error("Extend the addTarget method to add your plugin to another plugin's target")}install(){}uninstall(){}render(){throw new Error("Extend the render method to add your plugin to a DOM element")}update(){}afterUpdate(){}}},4060:function(e,t,i){"use strict";i.d(t,{Z:function(){return l}});var r=i(8596);function s(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var n=0;function o(e){return"__private_"+n+++"_"+e}var a=o("queueRequestSocketToken");class l extends r.Z{constructor(){super(...arguments),Object.defineProperty(this,a,{writable:!0,value:void 0})}setQueueRequestSocketToken(e){s(this,a)[a]=e}async uploadRemoteFile(e,t){void 0===t&&(t={});try{if(e.serverToken)return await this.connectToServerSocket(e);const i=await s(this,a)[a](e).abortOn(t.signal);if(!this.uppy.getState().files[e.id])return;return this.uppy.setFileState(e.id,{serverToken:i}),await this.connectToServerSocket(this.uppy.getFile(e.id))}catch(t){var i;if("AbortError"===(null==t||null==(i=t.cause)?void 0:i.name))return;throw this.uppy.setFileState(e.id,{serverToken:void 0}),this.uppy.emit("upload-error",e,t),t}}}},6037:function(e,t,i){"use strict";i.d(t,{di:function(){return Se},ZP:function(){return ce}});var r=i(4136),s=i(4800),n=i(9022),o=i(3493);function a(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var l=0;function u(e){return"__private_"+l+++"_"+e}var h=u("callbacks"),p=u("publish");class d{constructor(){Object.defineProperty(this,p,{value:c}),Object.defineProperty(this,h,{writable:!0,value:new Set}),this.state={}}getState(){return this.state}setState(e){const t={...this.state},i={...this.state,...e};this.state=i,a(this,p)[p](t,i,e)}subscribe(e){return a(this,h)[h].add(e),()=>{a(this,h)[h].delete(e)}}}function c(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];a(this,h)[h].forEach((e=>{e(...t)}))}d.VERSION="3.0.3";var f=d;function m(e){const t=e.lastIndexOf(".");return-1===t||t===e.length-1?{name:e,extension:void 0}:{name:e.slice(0,t),extension:e.slice(t+1)}}var g={md:"text/markdown",markdown:"text/markdown",mp4:"video/mp4",mp3:"audio/mp3",svg:"image/svg+xml",jpg:"image/jpeg",png:"image/png",webp:"image/webp",gif:"image/gif",heic:"image/heic",heif:"image/heif",yaml:"text/yaml",yml:"text/yaml",csv:"text/csv",tsv:"text/tab-separated-values",tab:"text/tab-separated-values",avi:"video/x-msvideo",mks:"video/x-matroska",mkv:"video/x-matroska",mov:"video/quicktime",dicom:"application/dicom",doc:"application/msword",docm:"application/vnd.ms-word.document.macroenabled.12",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dot:"application/msword",dotm:"application/vnd.ms-word.template.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",xla:"application/vnd.ms-excel",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlc:"application/vnd.ms-excel",xlf:"application/x-xliff+xml",xlm:"application/vnd.ms-excel",xls:"application/vnd.ms-excel",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlt:"application/vnd.ms-excel",xltm:"application/vnd.ms-excel.template.macroenabled.12",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlw:"application/vnd.ms-excel",txt:"text/plain",text:"text/plain",conf:"text/plain",log:"text/plain",pdf:"application/pdf",zip:"application/zip","7z":"application/x-7z-compressed",rar:"application/x-rar-compressed",tar:"application/x-tar",gz:"application/gzip",dmg:"application/x-apple-diskimage"};function y(e){var t;if(e.type)return e.type;const i=e.name?null==(t=m(e.name).extension)?void 0:t.toLowerCase():null;return i&&i in g?g[i]:"application/octet-stream"}function v(e){let t="";return e.replace(/[^A-Z0-9]/gi,(e=>(t+=`-${function(e){return e.charCodeAt(0).toString(32)}(e)}`,"/")))+t}function w(e){if(function(e){return!(!e.isRemote||!e.remote)&&new Set(["box","dropbox","drive","facebook","unsplash"]).has(e.remote.provider)}(e))return e.id;const t=y(e);return function(e){let t="uppy";return"string"==typeof e.name&&(t+=`-${v(e.name.toLowerCase())}`),void 0!==e.type&&(t+=`-${e.type}`),e.meta&&"string"==typeof e.meta.relativePath&&(t+=`-${v(e.meta.relativePath.toLowerCase())}`),void 0!==e.data.size&&(t+=`-${e.data.size}`),void 0!==e.data.lastModified&&(t+=`-${e.data.lastModified}`),t}({...e,type:t})}function b(e){if(null==e&&"undefined"!=typeof navigator&&(e=navigator.userAgent),!e)return!0;const t=/Edge\/(\d+\.\d+)/.exec(e);if(!t)return!0;const i=t[1];let[r,s]=i.split(".");return r=parseInt(r,10),s=parseInt(s,10),r<15||15===r&&s<15063||(r>18||18===r&&s>=18218)}const O={debug:()=>{},warn:()=>{},error:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i]}},P={debug:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i]},warn:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i]},error:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i]}};var S=i(5158),k=i(4193);const E={maxFileSize:null,minFileSize:null,maxTotalFileSize:null,maxNumberOfFiles:null,minNumberOfFiles:null,allowedFileTypes:null,requiredMetaFields:[]};class T extends Error{constructor(e,t){let{isUserFacing:i=!0,file:r}=void 0===t?{}:t;super(e),this.isRestriction=!0,this.isUserFacing=i,null!=r&&(this.file=r)}}class U{constructor(e,t){this.i18n=t,this.getOpts=()=>{const t=e();if(null!=t.restrictions.allowedFileTypes&&!Array.isArray(t.restrictions.allowedFileTypes))throw new TypeError("`restrictions.allowedFileTypes` must be an array");return t}}validateAggregateRestrictions(e,t){const{maxTotalFileSize:i,maxNumberOfFiles:r}=this.getOpts().restrictions;if(r){if(e.filter((e=>!e.isGhost)).length+t.length>r)throw new T(`${this.i18n("youCanOnlyUploadX",{smart_count:r})}`)}if(i){let r=e.reduce(((e,t)=>e+t.size),0);for(const e of t)if(null!=e.size&&(r+=e.size,r>i))throw new T(this.i18n("exceedsSize",{size:S(i),file:e.name}))}}validateSingleFile(e){const{maxFileSize:t,minFileSize:i,allowedFileTypes:r}=this.getOpts().restrictions;if(r){if(!r.some((t=>t.includes("/")?!!e.type&&k(e.type.replace(/;.*?$/,""),t):!("."!==t[0]||!e.extension)&&e.extension.toLowerCase()===t.slice(1).toLowerCase()))){const t=r.join(", ");throw new T(this.i18n("youCanOnlyUploadFileTypes",{types:t}),{file:e})}}if(t&&null!=e.size&&e.size>t)throw new T(this.i18n("exceedsSize",{size:S(t),file:e.name}),{file:e});if(i&&null!=e.size&&e.size<i)throw new T(this.i18n("inferiorSize",{size:S(i)}),{file:e})}validate(e,t){t.forEach((e=>{this.validateSingleFile(e)})),this.validateAggregateRestrictions(e,t)}validateMinNumberOfFiles(e){const{minNumberOfFiles:t}=this.getOpts().restrictions;if(Object.keys(e).length<t)throw new T(this.i18n("youHaveToAtLeastSelectX",{smart_count:t}))}getMissingRequiredMetaFields(e){const t=new T(this.i18n("missingRequiredMetaFieldOnFile",{fileName:e.name})),{requiredMetaFields:i}=this.getOpts().restrictions,r=[];for(const t of i)Object.hasOwn(e.meta,t)&&""!==e.meta[t]||r.push(t);return{missingFields:r,error:t}}}var j={strings:{addBulkFilesFailed:{0:"Failed to add %{smart_count} file due to an internal error",1:"Failed to add %{smart_count} files due to internal errors"},youCanOnlyUploadX:{0:"You can only upload %{smart_count} file",1:"You can only upload %{smart_count} files"},youHaveToAtLeastSelectX:{0:"You have to select at least %{smart_count} file",1:"You have to select at least %{smart_count} files"},exceedsSize:"%{file} exceeds maximum allowed size of %{size}",missingRequiredMetaField:"Missing required meta fields",missingRequiredMetaFieldOnFile:"Missing required meta fields in %{fileName}",inferiorSize:"This file is smaller than the allowed size of %{size}",youCanOnlyUploadFileTypes:"You can only upload: %{types}",noMoreFilesAllowed:"Cannot add more files",noDuplicates:"Cannot add the duplicate file '%{fileName}', it already exists",companionError:"Connection with Companion failed",authAborted:"Authentication aborted",companionUnauthorizeHint:"To unauthorize to your %{provider} account, please go to %{url}",failedToUpload:"Failed to upload %{file}",noInternetConnection:"No Internet connection",connectedToInternet:"Connected to the Internet",noFilesFound:"You have no files or folders here",noSearchResults:"Unfortunately, there are no results for this search",selectX:{0:"Select %{smart_count}",1:"Select %{smart_count}"},allFilesFromFolderNamed:"All files from folder %{name}",openFolderNamed:"Open folder %{name}",cancel:"Cancel",logOut:"Log out",filter:"Filter",resetFilter:"Reset filter",loading:"Loading...",loadedXFiles:"Loaded %{numFiles} files",authenticateWithTitle:"Please authenticate with %{pluginName} to select files",authenticateWith:"Connect to %{pluginName}",signInWithGoogle:"Sign in with Google",searchImages:"Search for images",enterTextToSearch:"Enter text to search for images",search:"Search",resetSearch:"Reset search",emptyFolderAdded:"No files were added from empty folder",addedNumFiles:"Added %{numFiles} file(s)",folderAlreadyAdded:'The folder "%{folder}" was already added',folderAdded:{0:"Added %{smart_count} file from %{folder}",1:"Added %{smart_count} files from %{folder}"},additionalRestrictionsFailed:"%{count} additional restrictions were not fulfilled"}};let x,F;function A(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var C=0;function _(e){return"__private_"+C+++"_"+e}var R=_("plugins"),$=_("restricter"),I=_("storeUnsubscribe"),L=_("emitter"),M=_("preProcessors"),N=_("uploaders"),D=_("postProcessors"),z=_("informAndEmit"),q=_("checkRequiredMetaFieldsOnFile"),B=_("checkRequiredMetaFields"),H=_("assertNewUploadAllowed"),V=_("transformFile"),X=_("startIfAutoProceed"),K=_("checkAndUpdateFileState"),W=_("addListeners"),G=_("updateOnlineStatus"),Z=_("createUpload"),Y=_("getUpload"),J=_("removeUpload"),Q=_("runUpload");x=Symbol.for("uppy test: getPlugins"),F=Symbol.for("uppy test: createUpload");class ee{constructor(e){Object.defineProperty(this,Q,{value:de}),Object.defineProperty(this,J,{value:pe}),Object.defineProperty(this,Y,{value:he}),Object.defineProperty(this,Z,{value:ue}),Object.defineProperty(this,W,{value:le}),Object.defineProperty(this,K,{value:ae}),Object.defineProperty(this,X,{value:oe}),Object.defineProperty(this,V,{value:ne}),Object.defineProperty(this,H,{value:se}),Object.defineProperty(this,B,{value:re}),Object.defineProperty(this,q,{value:ie}),Object.defineProperty(this,z,{value:te}),Object.defineProperty(this,R,{writable:!0,value:Object.create(null)}),Object.defineProperty(this,$,{writable:!0,value:void 0}),Object.defineProperty(this,I,{writable:!0,value:void 0}),Object.defineProperty(this,L,{writable:!0,value:s()}),Object.defineProperty(this,M,{writable:!0,value:new Set}),Object.defineProperty(this,N,{writable:!0,value:new Set}),Object.defineProperty(this,D,{writable:!0,value:new Set}),this.calculateProgress=o(((e,t)=>{const i=this.getFile(null==e?void 0:e.id);if(null==e||!i)return void this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`);if(100===i.progress.percentage)return void this.log(`Not setting progress for a file that has been already uploaded: ${e.id}`);const r=Number.isFinite(t.bytesTotal)&&t.bytesTotal>0;this.setFileState(e.id,{progress:{...i.progress,bytesUploaded:t.bytesUploaded,bytesTotal:t.bytesTotal,percentage:r?Math.round(t.bytesUploaded/t.bytesTotal*100):0}}),this.calculateTotalProgress()}),500,{leading:!0,trailing:!0}),Object.defineProperty(this,G,{writable:!0,value:this.updateOnlineStatus.bind(this)}),this.defaultLocale=j;const t={id:"uppy",autoProceed:!1,allowMultipleUploadBatches:!0,debug:!1,restrictions:E,meta:{},onBeforeFileAdded:e=>e,onBeforeUpload:e=>e,store:new f,logger:O,infoTimeout:5e3};this.opts={...t,...e,restrictions:{...t.restrictions,...e&&e.restrictions}},e&&e.logger&&e.debug?this.log("You are using a custom `logger`, but also set `debug: true`, which uses built-in logger to output logs to console. Ignoring `debug: true` and using your custom `logger`.","warning"):e&&e.debug&&(this.opts.logger=P),this.log(`Using Core v${this.constructor.VERSION}`),this.i18nInit(),this.store=this.opts.store,this.setState({plugins:{},files:{},currentUploads:{},allowNewUpload:!0,capabilities:{uploadProgress:b(),individualCancellation:!0,resumableUploads:!1},totalProgress:0,meta:{...this.opts.meta},info:[],recoveredState:null}),A(this,$)[$]=new U((()=>this.opts),this.i18n),A(this,I)[I]=this.store.subscribe(((e,t,i)=>{this.emit("state-update",e,t,i),this.updateAll(t)})),this.opts.debug&&"undefined"!=typeof window&&(window[this.opts.id]=this),A(this,W)[W]()}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];A(this,L)[L].emit(e,...i)}on(e,t){return A(this,L)[L].on(e,t),this}once(e,t){return A(this,L)[L].once(e,t),this}off(e,t){return A(this,L)[L].off(e,t),this}updateAll(e){this.iteratePlugins((t=>{t.update(e)}))}setState(e){this.store.setState(e)}getState(){return this.store.getState()}patchFilesState(e){const t=this.getState().files;this.setState({files:{...t,...Object.fromEntries(Object.entries(e).map((e=>{let[i,r]=e;return[i,{...t[i],...r}]})))}})}setFileState(e,t){if(!this.getState().files[e])throw new Error(`Cant set state for ${e} (the file could have been removed)`);this.patchFilesState({[e]:t})}i18nInit(){const e=new r.Z([this.defaultLocale,this.opts.locale]);this.i18n=e.translate.bind(e),this.i18nArray=e.translateArray.bind(e),this.locale=e.locale}setOptions(e){this.opts={...this.opts,...e,restrictions:{...this.opts.restrictions,...e&&e.restrictions}},e.meta&&this.setMeta(e.meta),this.i18nInit(),e.locale&&this.iteratePlugins((t=>{t.setOptions(e)})),this.setState()}resetProgress(){const e={percentage:0,bytesUploaded:0,uploadComplete:!1,uploadStarted:null},t={...this.getState().files},i={};Object.keys(t).forEach((r=>{i[r]={...t[r],progress:{...t[r].progress,...e}}})),this.setState({files:i,totalProgress:0,allowNewUpload:!0,error:null,recoveredState:null}),this.emit("reset-progress")}addPreProcessor(e){A(this,M)[M].add(e)}removePreProcessor(e){return A(this,M)[M].delete(e)}addPostProcessor(e){A(this,D)[D].add(e)}removePostProcessor(e){return A(this,D)[D].delete(e)}addUploader(e){A(this,N)[N].add(e)}removeUploader(e){return A(this,N)[N].delete(e)}setMeta(e){const t={...this.getState().meta,...e},i={...this.getState().files};Object.keys(i).forEach((t=>{i[t]={...i[t],meta:{...i[t].meta,...e}}})),this.log("Adding metadata:"),this.log(e),this.setState({meta:t,files:i})}setFileMeta(e,t){const i={...this.getState().files};if(!i[e])return void this.log("Was trying to set metadata for a file that has been removed: ",e);const r={...i[e].meta,...t};i[e]={...i[e],meta:r},this.setState({files:i})}getFile(e){return this.getState().files[e]}getFiles(){const{files:e}=this.getState();return Object.values(e)}getFilesByIds(e){return e.map((e=>this.getFile(e)))}getObjectOfFilesPerState(){const{files:e,totalProgress:t,error:i}=this.getState(),r=Object.values(e),s=r.filter((e=>{let{progress:t}=e;return!t.uploadComplete&&t.uploadStarted})),n=r.filter((e=>!e.progress.uploadStarted)),o=r.filter((e=>e.progress.uploadStarted||e.progress.preprocess||e.progress.postprocess)),a=r.filter((e=>e.progress.uploadStarted)),l=r.filter((e=>e.isPaused)),u=r.filter((e=>e.progress.uploadComplete)),h=r.filter((e=>e.error)),p=s.filter((e=>!e.isPaused)),d=r.filter((e=>e.progress.preprocess||e.progress.postprocess));return{newFiles:n,startedFiles:o,uploadStartedFiles:a,pausedFiles:l,completeFiles:u,erroredFiles:h,inProgressFiles:s,inProgressNotPausedFiles:p,processingFiles:d,isUploadStarted:a.length>0,isAllComplete:100===t&&u.length===r.length&&0===d.length,isAllErrored:!!i&&h.length===r.length,isAllPaused:0!==s.length&&l.length===s.length,isUploadInProgress:s.length>0,isSomeGhost:r.some((e=>e.isGhost))}}validateRestrictions(e,t){void 0===t&&(t=this.getFiles());try{A(this,$)[$].validate(t,[e])}catch(e){return e}return null}checkIfFileAlreadyExists(e){const{files:t}=this.getState();return!(!t[e]||t[e].isGhost)}addFile(e){A(this,H)[H](e);const{nextFilesState:t,validFilesToAdd:i,errors:r}=A(this,K)[K]([e]),s=r.filter((e=>e.isRestriction));if(A(this,z)[z](s),r.length>0)throw r[0];this.setState({files:t});const[n]=i;return this.emit("file-added",n),this.emit("files-added",i),this.log(`Added file: ${n.name}, ${n.id}, mime type: ${n.type}`),A(this,X)[X](),n.id}addFiles(e){A(this,H)[H]();const{nextFilesState:t,validFilesToAdd:i,errors:r}=A(this,K)[K](e),s=r.filter((e=>e.isRestriction));A(this,z)[z](s);const n=r.filter((e=>!e.isRestriction));if(n.length>0){let e="Multiple errors occurred while adding files:\n";if(n.forEach((t=>{e+=`\n * ${t.message}`})),this.info({message:this.i18n("addBulkFilesFailed",{smart_count:n.length}),details:e},"error",this.opts.infoTimeout),"function"==typeof AggregateError)throw new AggregateError(n,e);{const t=new Error(e);throw t.errors=n,t}}this.setState({files:t}),i.forEach((e=>{this.emit("file-added",e)})),this.emit("files-added",i),i.length>5?this.log(`Added batch of ${i.length} files`):Object.values(i).forEach((e=>{this.log(`Added file: ${e.name}\n id: ${e.id}\n type: ${e.type}`)})),i.length>0&&A(this,X)[X]()}removeFiles(e,t){const{files:i,currentUploads:r}=this.getState(),s={...i},n={...r},o=Object.create(null);function a(e){return void 0===o[e]}e.forEach((e=>{i[e]&&(o[e]=i[e],delete s[e])})),Object.keys(n).forEach((e=>{const t=r[e].fileIDs.filter(a);if(0===t.length)return void delete n[e];const{capabilities:i}=this.getState();if(t.length!==r[e].fileIDs.length&&!i.individualCancellation)throw new Error("individualCancellation is disabled");n[e]={...r[e],fileIDs:t}}));const l={currentUploads:n,files:s};0===Object.keys(s).length&&(l.allowNewUpload=!0,l.error=null,l.recoveredState=null),this.setState(l),this.calculateTotalProgress();const u=Object.keys(o);u.forEach((e=>{this.emit("file-removed",o[e],t)})),u.length>5?this.log(`Removed ${u.length} files`):this.log(`Removed files: ${u.join(", ")}`)}removeFile(e,t){void 0===t&&(t=null),this.removeFiles([e],t)}pauseResume(e){if(!this.getState().capabilities.resumableUploads||this.getFile(e).uploadComplete)return;const t=!(this.getFile(e).isPaused||!1);return this.setFileState(e,{isPaused:t}),this.emit("upload-pause",e,t),t}pauseAll(){const e={...this.getState().files};Object.keys(e).filter((t=>!e[t].progress.uploadComplete&&e[t].progress.uploadStarted)).forEach((t=>{const i={...e[t],isPaused:!0};e[t]=i})),this.setState({files:e}),this.emit("pause-all")}resumeAll(){const e={...this.getState().files};Object.keys(e).filter((t=>!e[t].progress.uploadComplete&&e[t].progress.uploadStarted)).forEach((t=>{const i={...e[t],isPaused:!1,error:null};e[t]=i})),this.setState({files:e}),this.emit("resume-all")}retryAll(){const e={...this.getState().files},t=Object.keys(e).filter((t=>e[t].error));if(t.forEach((t=>{const i={...e[t],isPaused:!1,error:null};e[t]=i})),this.setState({files:e,error:null}),this.emit("retry-all",t),0===t.length)return Promise.resolve({successful:[],failed:[]});const i=A(this,Z)[Z](t,{forceAllowNewUpload:!0});return A(this,Q)[Q](i)}cancelAll(e){let{reason:t="user"}=void 0===e?{}:e;if(this.emit("cancel-all",{reason:t}),"user"===t){const{files:e}=this.getState(),t=Object.keys(e);t.length&&this.removeFiles(t,"cancel-all"),this.setState({totalProgress:0,error:null,recoveredState:null})}}retryUpload(e){this.setFileState(e,{error:null,isPaused:!1}),this.emit("upload-retry",e);const t=A(this,Z)[Z]([e],{forceAllowNewUpload:!0});return A(this,Q)[Q](t)}logout(){this.iteratePlugins((e=>{e.provider&&e.provider.logout&&e.provider.logout()}))}calculateTotalProgress(){const e=this.getFiles().filter((e=>e.progress.uploadStarted||e.progress.preprocess||e.progress.postprocess));if(0===e.length)return this.emit("progress",0),void this.setState({totalProgress:0});const t=e.filter((e=>null!=e.progress.bytesTotal)),i=e.filter((e=>null==e.progress.bytesTotal));if(0===t.length){const t=100*e.length,r=i.reduce(((e,t)=>e+t.progress.percentage),0),s=Math.round(r/t*100);return void this.setState({totalProgress:s})}let r=t.reduce(((e,t)=>e+t.progress.bytesTotal),0);const s=r/t.length;r+=s*i.length;let n=0;t.forEach((e=>{n+=e.progress.bytesUploaded})),i.forEach((e=>{n+=s*(e.progress.percentage||0)/100}));let o=0===r?0:Math.round(n/r*100);o>100&&(o=100),this.setState({totalProgress:o}),this.emit("progress",o)}updateOnlineStatus(){void 0===window.navigator.onLine||window.navigator.onLine?(this.emit("is-online"),this.wasOffline&&(this.emit("back-online"),this.info(this.i18n("connectedToInternet"),"success",3e3),this.wasOffline=!1)):(this.emit("is-offline"),this.info(this.i18n("noInternetConnection"),"error",0),this.wasOffline=!0)}getID(){return this.opts.id}use(e,t){if("function"!=typeof e){throw new TypeError(`Expected a plugin class, but got ${null===e?"null":typeof e}. Please verify that the plugin was imported and spelled correctly.`)}const i=new e(this,t),r=i.id;if(!r)throw new Error("Your plugin must have an id");if(!i.type)throw new Error("Your plugin must have a type");const s=this.getPlugin(r);if(s){const e=`Already found a plugin named '${s.id}'. Tried to use: '${r}'.\nUppy plugins must have unique \`id\` options. See https://uppy.io/docs/plugins/#id.`;throw new Error(e)}return e.VERSION&&this.log(`Using ${r} v${e.VERSION}`),i.type in A(this,R)[R]?A(this,R)[R][i.type].push(i):A(this,R)[R][i.type]=[i],i.install(),this}getPlugin(e){for(const t of Object.values(A(this,R)[R])){const i=t.find((t=>t.id===e));if(null!=i)return i}}[x](e){return A(this,R)[R][e]}iteratePlugins(e){Object.values(A(this,R)[R]).flat(1).forEach(e)}removePlugin(e){this.log(`Removing plugin ${e.id}`),this.emit("plugin-remove",e),e.uninstall&&e.uninstall();const t=A(this,R)[R][e.type],i=t.findIndex((t=>t.id===e.id));-1!==i&&t.splice(i,1);const r={plugins:{...this.getState().plugins,[e.id]:void 0}};this.setState(r)}close(e){let{reason:t}=void 0===e?{}:e;this.log(`Closing Uppy instance ${this.opts.id}: removing all files and uninstalling plugins`),this.cancelAll({reason:t}),A(this,I)[I](),this.iteratePlugins((e=>{this.removePlugin(e)})),"undefined"!=typeof window&&window.removeEventListener&&(window.removeEventListener("online",A(this,G)[G]),window.removeEventListener("offline",A(this,G)[G]))}hideInfo(){const{info:e}=this.getState();this.setState({info:e.slice(1)}),this.emit("info-hidden")}info(e,t,i){void 0===t&&(t="info"),void 0===i&&(i=3e3);const r="object"==typeof e;this.setState({info:[...this.getState().info,{type:t,message:r?e.message:e,details:r?e.details:null}]}),setTimeout((()=>this.hideInfo()),i),this.emit("info-visible")}log(e,t){const{logger:i}=this.opts;switch(t){case"error":i.error(e);break;case"warning":i.warn(e);break;default:i.debug(e)}}restore(e){return this.log(`Core: attempting to restore upload "${e}"`),this.getState().currentUploads[e]?A(this,Q)[Q](e):(A(this,J)[J](e),Promise.reject(new Error("Nonexistent upload")))}[F](){return A(this,Z)[Z](...arguments)}addResultData(e,t){if(!A(this,Y)[Y](e))return void this.log(`Not setting result for an upload that has been removed: ${e}`);const{currentUploads:i}=this.getState(),r={...i[e],result:{...i[e].result,...t}};this.setState({currentUploads:{...i,[e]:r}})}upload(){var e;null!=(e=A(this,R)[R].uploader)&&e.length||this.log("No uploader type plugins are used","warning");let{files:t}=this.getState();const i=this.opts.onBeforeUpload(t);return!1===i?Promise.reject(new Error("Not starting the upload because onBeforeUpload returned false")):(i&&"object"==typeof i&&(t=i,this.setState({files:t})),Promise.resolve().then((()=>A(this,$)[$].validateMinNumberOfFiles(t))).catch((e=>{throw A(this,z)[z]([e]),e})).then((()=>{if(!A(this,B)[B](t))throw new T(this.i18n("missingRequiredMetaField"))})).catch((e=>{throw e})).then((()=>{const{currentUploads:e}=this.getState(),i=Object.values(e).flatMap((e=>e.fileIDs)),r=[];Object.keys(t).forEach((e=>{const t=this.getFile(e);t.progress.uploadStarted||-1!==i.indexOf(e)||r.push(t.id)}));const s=A(this,Z)[Z](r);return A(this,Q)[Q](s)})).catch((e=>{throw this.emit("error",e),this.log(e,"error"),e})))}}function te(e){for(const t of e){const{file:e,isRestriction:i}=t;i?this.emit("restriction-failed",e,t):this.emit("error",t),this.log(t,"warning")}const t=e.filter((e=>e.isUserFacing)),i=t.slice(0,4),r=t.slice(4);i.forEach((e=>{let{message:t,details:i=""}=e;this.info({message:t,details:i},"error",this.opts.infoTimeout)})),r.length>0&&this.info({message:this.i18n("additionalRestrictionsFailed",{count:r.length})})}function ie(e){const{missingFields:t,error:i}=A(this,$)[$].getMissingRequiredMetaFields(e);return!(t.length>0)||(this.setFileState(e.id,{missingRequiredMetaFields:t}),this.log(i.message),this.emit("restriction-failed",e,i),!1)}function re(e){let t=!0;for(const i of Object.values(e))A(this,q)[q](i)||(t=!1);return t}function se(e){const{allowNewUpload:t}=this.getState();if(!1===t){const t=new T(this.i18n("noMoreFilesAllowed"),{file:e});throw A(this,z)[z]([t]),t}}function ne(e){const t=e instanceof File?{name:e.name,type:e.type,size:e.size,data:e}:e,i=y(t),r=function(e,t){return t.name?t.name:"image"===e.split("/")[0]?`${e.split("/")[0]}.${e.split("/")[1]}`:"noname"}(i,t),s=m(r).extension,n=Boolean(t.isRemote),o=w(t),a=t.meta||{};a.name=r,a.type=i;const l=Number.isFinite(t.data.size)?t.data.size:null;return{source:t.source||"",id:o,name:r,extension:s||"",meta:{...this.getState().meta,...a},type:i,data:t.data,progress:{percentage:0,bytesUploaded:0,bytesTotal:l,uploadComplete:!1,uploadStarted:null},size:l,isRemote:n,remote:t.remote||"",preview:t.preview}}function oe(){this.opts.autoProceed&&!this.scheduledAutoProceed&&(this.scheduledAutoProceed=setTimeout((()=>{this.scheduledAutoProceed=null,this.upload().catch((e=>{e.isRestriction||this.log(e.stack||e.message||e)}))}),4))}function ae(e){const{files:t}=this.getState(),i={...t},r=[],s=[];for(const o of e)try{var n;let e=A(this,V)[V](o);if(null!=(n=t[e.id])&&n.isGhost){const{isGhost:i,...r}=t[e.id];e={...r,data:o.data},this.log(`Replaced the blob in the restored ghost file: ${e.name}, ${e.id}`)}if(this.checkIfFileAlreadyExists(e.id))throw new T(this.i18n("noDuplicates",{fileName:e.name}),{file:o});const s=this.opts.onBeforeFileAdded(e,i);if(!1===s)throw new T("Cannot add the file because onBeforeFileAdded returned false.",{isUserFacing:!1,file:o});"object"==typeof s&&null!==s&&(e=s),A(this,$)[$].validateSingleFile(e),i[e.id]=e,r.push(e)}catch(e){s.push(e)}try{A(this,$)[$].validateAggregateRestrictions(Object.values(t),r)}catch(e){return s.push(e),{nextFilesState:t,validFilesToAdd:[],errors:s}}return{nextFilesState:i,validFilesToAdd:r,errors:s}}function le(){const e=(e,t,i)=>{let r=e.message||"Unknown error";e.details&&(r+=` ${e.details}`),this.setState({error:r}),null!=t&&t.id in this.getState().files&&this.setFileState(t.id,{error:r,response:i})};let t;this.on("error",e),this.on("upload-error",((t,i,r)=>{if(e(i,t,r),"object"==typeof i&&i.message){this.log(i.message,"error");const e=new Error(this.i18n("failedToUpload",{file:null==t?void 0:t.name}));e.isUserFacing=!0,e.details=i.message,i.details&&(e.details+=` ${i.details}`),A(this,z)[z]([e])}else A(this,z)[z]([i])})),this.on("upload-stalled",((e,i)=>{const{message:r}=e,s=i.map((e=>e.meta.name)).join(", ");t||(this.info({message:r,details:s},"warning",this.opts.infoTimeout),t=setTimeout((()=>{t=null}),this.opts.infoTimeout)),this.log(`${r} ${s}`.trim(),"warning")})),this.on("upload",(()=>{this.setState({error:null})}));const i=e=>{const t=e.filter((e=>{const t=null!=e&&this.getFile(e.id);return t||this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`),t})),i=Object.fromEntries(t.map((e=>[e.id,{progress:{uploadStarted:Date.now(),uploadComplete:!1,percentage:0,bytesUploaded:0,bytesTotal:e.size}}])));this.patchFilesState(i)};this.on("upload-start",(e=>{e.forEach((e=>{this.emit("upload-started",e)})),i(e)})),this.on("upload-progress",this.calculateProgress),this.on("upload-success",((e,t)=>{if(null==e||!this.getFile(e.id))return void this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`);const i=this.getFile(e.id).progress;this.setFileState(e.id,{progress:{...i,postprocess:A(this,D)[D].size>0?{mode:"indeterminate"}:null,uploadComplete:!0,percentage:100,bytesUploaded:i.bytesTotal},response:t,uploadURL:t.uploadURL,isPaused:!1}),null==e.size&&this.setFileState(e.id,{size:t.bytesUploaded||i.bytesTotal}),this.calculateTotalProgress()})),this.on("preprocess-progress",((e,t)=>{null!=e&&this.getFile(e.id)?this.setFileState(e.id,{progress:{...this.getFile(e.id).progress,preprocess:t}}):this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`)})),this.on("preprocess-complete",(e=>{if(null==e||!this.getFile(e.id))return void this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`);const t={...this.getState().files};t[e.id]={...t[e.id],progress:{...t[e.id].progress}},delete t[e.id].progress.preprocess,this.setState({files:t})})),this.on("postprocess-progress",((e,t)=>{null!=e&&this.getFile(e.id)?this.setFileState(e.id,{progress:{...this.getState().files[e.id].progress,postprocess:t}}):this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`)})),this.on("postprocess-complete",(e=>{if(null==e||!this.getFile(e.id))return void this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`);const t={...this.getState().files};t[e.id]={...t[e.id],progress:{...t[e.id].progress}},delete t[e.id].progress.postprocess,this.setState({files:t})})),this.on("restored",(()=>{this.calculateTotalProgress()})),this.on("dashboard:file-edit-complete",(e=>{e&&A(this,q)[q](e)})),"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("online",A(this,G)[G]),window.addEventListener("offline",A(this,G)[G]),setTimeout(A(this,G)[G],3e3))}function ue(e,t){void 0===t&&(t={});const{forceAllowNewUpload:i=!1}=t,{allowNewUpload:r,currentUploads:s}=this.getState();if(!r&&!i)throw new Error("Cannot create a new upload: already uploading.");const o=(0,n.x)();return this.emit("upload",{id:o,fileIDs:e}),this.setState({allowNewUpload:!1!==this.opts.allowMultipleUploadBatches&&!1!==this.opts.allowMultipleUploads,currentUploads:{...s,[o]:{fileIDs:e,step:0,result:{}}}}),o}function he(e){const{currentUploads:t}=this.getState();return t[e]}function pe(e){const t={...this.getState().currentUploads};delete t[e],this.setState({currentUploads:t})}async function de(e){const t=()=>{const{currentUploads:t}=this.getState();return t[e]};let i=t();const r=[...A(this,M)[M],...A(this,N)[N],...A(this,D)[D]];try{for(let s=i.step||0;s<r.length&&i;s++){const n=r[s];this.setState({currentUploads:{...this.getState().currentUploads,[e]:{...i,step:s}}});const{fileIDs:o}=i;await n(o,e),i=t()}}catch(t){throw A(this,J)[J](e),t}if(i){i.fileIDs.forEach((e=>{const t=this.getFile(e);t&&t.progress.postprocess&&this.emit("postprocess-complete",t)}));const r=i.fileIDs.map((e=>this.getFile(e))),s=r.filter((e=>!e.error)),n=r.filter((e=>e.error));await this.addResultData(e,{successful:s,failed:n,uploadID:e}),i=t()}let s;return i&&(s=i.result,this.emit("complete",s),A(this,J)[J](e)),null==s&&this.log(`Not setting result for an upload that has been removed: ${e}`),s}ee.VERSION="3.3.1";var ce=ee,fe=i(6400);function me(e,t){return void 0===t&&(t=document),"string"==typeof e?t.querySelector(e):(null==(i=e)?void 0:i.nodeType)===Node.ELEMENT_NODE?e:null;var i}var ge=function(e){for(var t;e&&!e.dir;)e=e.parentNode;return null==(t=e)?void 0:t.dir},ye=i(8596);function ve(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var we=0;function be(e){return"__private_"+we+++"_"+e}var Oe=be("updateUI");class Pe extends ye.Z{constructor(){super(...arguments),Object.defineProperty(this,Oe,{writable:!0,value:void 0})}getTargetPlugin(e){let t;if("object"==typeof e&&e instanceof Pe)t=e;else if("function"==typeof e){const i=e;this.uppy.iteratePlugins((e=>{e instanceof i&&(t=e)}))}return t}mount(e,t){const i=t.id,r=me(e);if(r){this.isTargetDOMEl=!0;const t=document.createElement("div");return t.classList.add("uppy-Root"),ve(this,Oe)[Oe]=function(e){let t=null,i=null;return function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];return i=s,t||(t=Promise.resolve().then((()=>(t=null,e(...i))))),t}}((e=>{this.uppy.getPlugin(this.id)&&((0,fe.sY)(this.render(e),t),this.afterUpdate())})),this.uppy.log(`Installing ${i} to a DOM element '${e}'`),this.opts.replaceTargetContent&&(r.innerHTML=""),(0,fe.sY)(this.render(this.uppy.getState()),t),this.el=t,r.appendChild(t),t.dir=this.opts.direction||ge(t)||"ltr",this.onMount(),this.el}const s=this.getTargetPlugin(e);if(s)return this.uppy.log(`Installing ${i} to ${s.id}`),this.parent=s,this.el=s.addTarget(t),this.onMount(),this.el;this.uppy.log(`Not installing ${i}`);let n=`Invalid target option given to ${i}.`;throw n+="function"==typeof e?" The given target is not a Plugin class. Please check that you're not specifying a React Component instead of a plugin. If you are using @uppy/* packages directly, make sure you have only 1 version of @uppy/core installed: run `npm ls @uppy/core` on the command line and verify that all the versions match and are deduped correctly.":"If you meant to target an HTML element, please make sure that the element exists. Check that the <script> tag initializing Uppy is right before the closing </body> tag at the end of the page. (see https://github.com/transloadit/uppy/issues/1042)\n\nIf you meant to target a plugin, please confirm that your `import` statements or `require` calls are correct.",new Error(n)}update(e){var t,i;null!=this.el&&(null==(t=(i=ve(this,Oe))[Oe])||t.call(i,e))}unmount(){var e;this.isTargetDOMEl&&(null==(e=this.el)||e.remove());this.onUnmount()}onMount(){}onUnmount(){}}var Se=Pe},4136:function(e,t,i){"use strict";function r(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}i.d(t,{Z:function(){return u}});var s=0;function n(e){return"__private_"+s+++"_"+e}function o(e,t,i){const r=[];return e.forEach((e=>"string"!=typeof e?r.push(e):t[Symbol.split](e).forEach(((e,t,s)=>{""!==e&&r.push(e),t<s.length-1&&r.push(i)})))),r}function a(e,t){const i=/\$/g;let r=[e];if(null==t)return r;for(const e of Object.keys(t))if("_"!==e){let s=t[e];"string"==typeof s&&(s=i[Symbol.replace](s,"$$$$")),r=o(r,new RegExp(`%\\{${e}\\}`,"g"),s)}return r}var l=n("apply");class u{constructor(e){Object.defineProperty(this,l,{value:h}),this.locale={strings:{},pluralize(e){return 1===e?0:1}},Array.isArray(e)?e.forEach(r(this,l)[l],this):r(this,l)[l](e)}translate(e,t){return this.translateArray(e,t).join("")}translateArray(e,t){if(!function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(this.locale.strings,e))throw new Error(`missing string: ${e}`);const i=this.locale.strings[e];if("object"==typeof i){if(t&&void 0!==t.smart_count){return a(i[this.locale.pluralize(t.smart_count)],t)}throw new Error("Attempted to use a string with plural forms, but no value was given for %{smart_count}")}return a(i,t)}}function h(e){if(null==e||!e.strings)return;const t=this.locale;this.locale={...t,strings:{...t.strings,...e.strings}},this.locale.pluralize=e.pluralize||t.pluralize}},7049:function(e,t,i){"use strict";i.d(t,{Z:function(){return ke}});var r=i(6037);const s=/^data:([^/]+\/[^,;]+(?:[^,]*?))(;base64)?,([\s\S]*)$/;function n(e){return e.startsWith("blob:")}function o(e){return!!e&&/^[^/]+\/(jpe?g|gif|png|svg|svg\+xml|bmp|webp|avif)$/.test(e)}function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var l="undefined"!=typeof self?self:global;const u="undefined"!=typeof navigator,h=u&&"undefined"==typeof HTMLImageElement,p=!("undefined"==typeof global||"undefined"==typeof process||!process.versions||!process.versions.node),d=l.Buffer,c=!!d,f=e=>void 0!==e;function m(e){return void 0===e||(e instanceof Map?0===e.size:0===Object.values(e).filter(f).length)}function g(e){let t=new Error(e);throw delete t.stack,t}function y(e){let t=function(e){let t=0;return e.ifd0.enabled&&(t+=1024),e.exif.enabled&&(t+=2048),e.makerNote&&(t+=2048),e.userComment&&(t+=1024),e.gps.enabled&&(t+=512),e.interop.enabled&&(t+=100),e.ifd1.enabled&&(t+=1024),t+2048}(e);return e.jfif.enabled&&(t+=50),e.xmp.enabled&&(t+=2e4),e.iptc.enabled&&(t+=14e3),e.icc.enabled&&(t+=6e3),t}const v=e=>String.fromCharCode.apply(null,e),w="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):void 0;class b{static from(e,t){return e instanceof this&&e.le===t?e:new b(e,void 0,void 0,t)}constructor(e,t=0,i,r){if("boolean"==typeof r&&(this.le=r),Array.isArray(e)&&(e=new Uint8Array(e)),0===e)this.byteOffset=0,this.byteLength=0;else if(e instanceof ArrayBuffer){void 0===i&&(i=e.byteLength-t);let r=new DataView(e,t,i);this._swapDataView(r)}else if(e instanceof Uint8Array||e instanceof DataView||e instanceof b){void 0===i&&(i=e.byteLength-t),(t+=e.byteOffset)+i>e.byteOffset+e.byteLength&&g("Creating view outside of available memory in ArrayBuffer");let r=new DataView(e.buffer,t,i);this._swapDataView(r)}else if("number"==typeof e){let t=new DataView(new ArrayBuffer(e));this._swapDataView(t)}else g("Invalid input argument for BufferView: "+e)}_swapArrayBuffer(e){this._swapDataView(new DataView(e))}_swapBuffer(e){this._swapDataView(new DataView(e.buffer,e.byteOffset,e.byteLength))}_swapDataView(e){this.dataView=e,this.buffer=e.buffer,this.byteOffset=e.byteOffset,this.byteLength=e.byteLength}_lengthToEnd(e){return this.byteLength-e}set(e,t,i=b){return e instanceof DataView||e instanceof b?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e instanceof Uint8Array||g("BufferView.set(): Invalid data argument."),this.toUint8().set(e,t),new i(this,t,e.byteLength)}subarray(e,t){return t=t||this._lengthToEnd(e),new b(this,e,t)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(e,t){return new Uint8Array(this.buffer,this.byteOffset+e,t)}getString(e=0,t=this.byteLength){return i=this.getUint8Array(e,t),w?w.decode(i):c?Buffer.from(i).toString("utf8"):decodeURIComponent(escape(v(i)));var i}getLatin1String(e=0,t=this.byteLength){let i=this.getUint8Array(e,t);return v(i)}getUnicodeString(e=0,t=this.byteLength){const i=[];for(let r=0;r<t&&e+r<this.byteLength;r+=2)i.push(this.getUint16(e+r));return v(i)}getInt8(e){return this.dataView.getInt8(e)}getUint8(e){return this.dataView.getUint8(e)}getInt16(e,t=this.le){return this.dataView.getInt16(e,t)}getInt32(e,t=this.le){return this.dataView.getInt32(e,t)}getUint16(e,t=this.le){return this.dataView.getUint16(e,t)}getUint32(e,t=this.le){return this.dataView.getUint32(e,t)}getFloat32(e,t=this.le){return this.dataView.getFloat32(e,t)}getFloat64(e,t=this.le){return this.dataView.getFloat64(e,t)}getFloat(e,t=this.le){return this.dataView.getFloat32(e,t)}getDouble(e,t=this.le){return this.dataView.getFloat64(e,t)}getUintBytes(e,t,i){switch(t){case 1:return this.getUint8(e,i);case 2:return this.getUint16(e,i);case 4:return this.getUint32(e,i);case 8:return this.getUint64&&this.getUint64(e,i)}}getUint(e,t,i){switch(t){case 8:return this.getUint8(e,i);case 16:return this.getUint16(e,i);case 32:return this.getUint32(e,i);case 64:return this.getUint64&&this.getUint64(e,i)}}toString(e){return this.dataView.toString(e,this.constructor.name)}ensureChunk(){}}function O(e,t){g(`${e} '${t}' was not loaded, try using full build of exifr.`)}class P extends Map{constructor(e){super(),this.kind=e}get(e,t){return this.has(e)||O(this.kind,e),t&&(e in t||function(e,t){g(`Unknown ${e} '${t}'.`)}(this.kind,e),t[e].enabled||O(this.kind,e)),super.get(e)}keyList(){return Array.from(this.keys())}}var S=new P("file parser"),k=new P("segment parser"),E=new P("file reader");let T=l.fetch;function U(e,t){return(i=e).startsWith("data:")||i.length>1e4?x(e,t,"base64"):p&&e.includes("://")?j(e,t,"url",F):p?x(e,t,"fs"):u?j(e,t,"url",F):void g("Invalid input argument");var i}async function j(e,t,i,r){return E.has(i)?x(e,t,i):r?async function(e,t){let i=await t(e);return new b(i)}(e,r):void g(`Parser ${i} is not loaded`)}async function x(e,t,i){let r=new(E.get(i))(e,t);return await r.read(),r}const F=e=>T(e).then((e=>e.arrayBuffer())),A=e=>new Promise(((t,i)=>{let r=new FileReader;r.onloadend=()=>t(r.result||new ArrayBuffer),r.onerror=i,r.readAsArrayBuffer(e)}));class C extends Map{get tagKeys(){return this.allKeys||(this.allKeys=Array.from(this.keys())),this.allKeys}get tagValues(){return this.allValues||(this.allValues=Array.from(this.values())),this.allValues}}function _(e,t,i){let r=new C;for(let[e,t]of i)r.set(e,t);if(Array.isArray(t))for(let i of t)e.set(i,r);else e.set(t,r);return r}function R(e,t,i){let r,s=e.get(t);for(r of i)s.set(r[0],r[1])}const $=new Map,I=new Map,L=new Map,M=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],N=["jfif","xmp","icc","iptc","ihdr"],D=["tiff",...N],z=["ifd0","ifd1","exif","gps","interop"],q=[...D,...z],B=["makerNote","userComment"],H=["translateKeys","translateValues","reviveValues","multiSegment"],V=[...H,"sanitize","mergeOutput","silentErrors"];class X{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}class K extends X{get needed(){return this.enabled||this.deps.size>0}constructor(e,t,i,r){if(super(),a(this,"enabled",!1),a(this,"skip",new Set),a(this,"pick",new Set),a(this,"deps",new Set),a(this,"translateKeys",!1),a(this,"translateValues",!1),a(this,"reviveValues",!1),this.key=e,this.enabled=t,this.parse=this.enabled,this.applyInheritables(r),this.canBeFiltered=z.includes(e),this.canBeFiltered&&(this.dict=$.get(e)),void 0!==i)if(Array.isArray(i))this.parse=this.enabled=!0,this.canBeFiltered&&i.length>0&&this.translateTagSet(i,this.pick);else if("object"==typeof i){if(this.enabled=!0,this.parse=!1!==i.parse,this.canBeFiltered){let{pick:e,skip:t}=i;e&&e.length>0&&this.translateTagSet(e,this.pick),t&&t.length>0&&this.translateTagSet(t,this.skip)}this.applyInheritables(i)}else!0===i||!1===i?this.parse=this.enabled=i:g(`Invalid options argument: ${i}`)}applyInheritables(e){let t,i;for(t of H)i=e[t],void 0!==i&&(this[t]=i)}translateTagSet(e,t){if(this.dict){let i,r,{tagKeys:s,tagValues:n}=this.dict;for(i of e)"string"==typeof i?(r=n.indexOf(i),-1===r&&(r=s.indexOf(Number(i))),-1!==r&&t.add(Number(s[r]))):t.add(i)}else for(let i of e)t.add(i)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,Q(this.pick,this.deps)):this.enabled&&this.pick.size>0&&Q(this.pick,this.deps)}}var W={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},G=new Map;class Z extends X{static useCached(e){let t=G.get(e);return void 0!==t||(t=new this(e),G.set(e,t)),t}constructor(e){super(),!0===e?this.setupFromTrue():void 0===e?this.setupFromUndefined():Array.isArray(e)?this.setupFromArray(e):"object"==typeof e?this.setupFromObject(e):g(`Invalid options argument ${e}`),void 0===this.firstChunkSize&&(this.firstChunkSize=u?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let e;for(e of M)this[e]=W[e];for(e of V)this[e]=W[e];for(e of B)this[e]=W[e];for(e of q)this[e]=new K(e,W[e],void 0,this)}setupFromTrue(){let e;for(e of M)this[e]=W[e];for(e of V)this[e]=W[e];for(e of B)this[e]=!0;for(e of q)this[e]=new K(e,!0,void 0,this)}setupFromArray(e){let t;for(t of M)this[t]=W[t];for(t of V)this[t]=W[t];for(t of B)this[t]=W[t];for(t of q)this[t]=new K(t,!1,void 0,this);this.setupGlobalFilters(e,void 0,z)}setupFromObject(e){let t;for(t of(z.ifd0=z.ifd0||z.image,z.ifd1=z.ifd1||z.thumbnail,Object.assign(this,e),M))this[t]=J(e[t],W[t]);for(t of V)this[t]=J(e[t],W[t]);for(t of B)this[t]=J(e[t],W[t]);for(t of D)this[t]=new K(t,W[t],e[t],this);for(t of z)this[t]=new K(t,W[t],e[t],this.tiff);this.setupGlobalFilters(e.pick,e.skip,z,q),!0===e.tiff?this.batchEnableWithBool(z,!0):!1===e.tiff?this.batchEnableWithUserValue(z,e):Array.isArray(e.tiff)?this.setupGlobalFilters(e.tiff,void 0,z):"object"==typeof e.tiff&&this.setupGlobalFilters(e.tiff.pick,e.tiff.skip,z)}batchEnableWithBool(e,t){for(let i of e)this[i].enabled=t}batchEnableWithUserValue(e,t){for(let i of e){let e=t[i];this[i].enabled=!1!==e&&void 0!==e}}setupGlobalFilters(e,t,i,r=i){if(e&&e.length){for(let e of r)this[e].enabled=!1;let t=Y(e,i);for(let[e,i]of t)Q(this[e].pick,i),this[e].enabled=!0}else if(t&&t.length){let e=Y(t,i);for(let[t,i]of e)Q(this[t].skip,i)}}filterNestedSegmentTags(){let{ifd0:e,exif:t,xmp:i,iptc:r,icc:s}=this;this.makerNote?t.deps.add(37500):t.skip.add(37500),this.userComment?t.deps.add(37510):t.skip.add(37510),i.enabled||e.skip.add(700),r.enabled||e.skip.add(33723),s.enabled||e.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:e,exif:t,gps:i,interop:r}=this;r.needed&&(t.deps.add(40965),e.deps.add(40965)),t.needed&&e.deps.add(34665),i.needed&&e.deps.add(34853),this.tiff.enabled=z.some((e=>!0===this[e].enabled))||this.makerNote||this.userComment;for(let e of z)this[e].finalizeFilters()}get onlyTiff(){return!N.map((e=>this[e].enabled)).some((e=>!0===e))&&this.tiff.enabled}checkLoadedPlugins(){for(let e of D)this[e].enabled&&!k.has(e)&&O("segment parser",e)}}function Y(e,t){let i,r,s,n,o=[];for(s of t){for(n of(i=$.get(s),r=[],i))(e.includes(n[0])||e.includes(n[1]))&&r.push(n[0]);r.length&&o.push([s,r])}return o}function J(e,t){return void 0!==e?e:void 0!==t?t:void 0}function Q(e,t){for(let i of t)e.add(i)}a(Z,"default",W);class ee{constructor(e){a(this,"parsers",{}),a(this,"output",{}),a(this,"errors",[]),a(this,"pushToErrors",(e=>this.errors.push(e))),this.options=Z.useCached(e)}async read(e){this.file=await function(e,t){return"string"==typeof e?U(e,t):u&&!h&&e instanceof HTMLImageElement?U(e.src,t):e instanceof Uint8Array||e instanceof ArrayBuffer||e instanceof DataView?new b(e):u&&e instanceof Blob?j(e,t,"blob",A):void g("Invalid input argument")}(e,this.options)}setup(){if(this.fileParser)return;let{file:e}=this,t=e.getUint16(0);for(let[i,r]of S)if(r.canHandle(e,t))return this.fileParser=new r(this.options,this.file,this.parsers),e[i]=!0;this.file.close&&this.file.close(),g("Unknown file format")}async parse(){let{output:e,errors:t}=this;return this.setup(),this.options.silentErrors?(await this.executeParsers().catch(this.pushToErrors),t.push(...this.fileParser.errors)):await this.executeParsers(),this.file.close&&this.file.close(),this.options.silentErrors&&t.length>0&&(e.errors=t),m(i=e)?void 0:i;var i}async executeParsers(){let{output:e}=this;await this.fileParser.parse();let t=Object.values(this.parsers).map((async t=>{let i=await t.parse();t.assignToOutput(e,i)}));this.options.silentErrors&&(t=t.map((e=>e.catch(this.pushToErrors)))),await Promise.all(t)}async extractThumbnail(){this.setup();let{options:e,file:t}=this,i=k.get("tiff",e);var r;if(t.tiff?r={start:0,type:"tiff"}:t.jpeg&&(r=await this.fileParser.getOrFindSegment("tiff")),void 0===r)return;let s=await this.fileParser.ensureSegmentChunk(r),n=this.parsers.tiff=new i(s,e,t),o=await n.extractThumbnail();return t.close&&t.close(),o}}async function te(e,t){let i=new ee(t);return await i.read(e),i.parse()}var ie=Object.freeze({__proto__:null,parse:te,Exifr:ee,fileParsers:S,segmentParsers:k,fileReaders:E,tagKeys:$,tagValues:I,tagRevivers:L,createDictionary:_,extendDictionary:R,fetchUrlAsArrayBuffer:F,readBlobAsArrayBuffer:A,chunkedProps:M,otherSegments:N,segments:D,tiffBlocks:z,segmentsAndBlocks:q,tiffExtractables:B,inheritables:H,allFormatters:V,Options:Z});class re{static findPosition(e,t){let i=e.getUint16(t+2)+2,r="function"==typeof this.headerLength?this.headerLength(e,t,i):this.headerLength,s=t+r,n=i-r;return{offset:t,length:i,headerLength:r,start:s,size:n,end:s+n}}static parse(e,t={}){return new this(e,new Z({[this.type]:t}),e).parse()}normalizeInput(e){return e instanceof b?e:new b(e)}constructor(e,t={},i){a(this,"errors",[]),a(this,"raw",new Map),a(this,"handleError",(e=>{if(!this.options.silentErrors)throw e;this.errors.push(e.message)})),this.chunk=this.normalizeInput(e),this.file=i,this.type=this.constructor.type,this.globalOptions=this.options=t,this.localOptions=t[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(e,t){let i=L.get(t),r=I.get(t),s=$.get(t),n=this.options[t],o=n.reviveValues&&!!i,a=n.translateValues&&!!r,l=n.translateKeys&&!!s,u={};for(let[t,n]of e)o&&i.has(t)?n=i.get(t)(n):a&&r.has(t)&&(n=this.translateValue(n,r.get(t))),l&&s.has(t)&&(t=s.get(t)||t),u[t]=n;return u}translateValue(e,t){return t[e]||t.DEFAULT||e}assignToOutput(e,t){this.assignObjectToOutput(e,this.constructor.type,t)}assignObjectToOutput(e,t,i){if(this.globalOptions.mergeOutput)return Object.assign(e,i);e[t]?Object.assign(e[t],i):e[t]=i}}function se(e){return 192===e||194===e||196===e||219===e||221===e||218===e||254===e}function ne(e){return e>=224&&e<=239}function oe(e,t,i){for(let[r,s]of k)if(s.canHandle(e,t,i))return r}a(re,"headerLength",4),a(re,"type",void 0),a(re,"multiSegment",!1),a(re,"canHandle",(()=>!1));class ae extends class{constructor(e,t,i){a(this,"errors",[]),a(this,"ensureSegmentChunk",(async e=>{let t=e.start,i=e.size||65536;if(this.file.chunked)if(this.file.available(t,i))e.chunk=this.file.subarray(t,i);else try{e.chunk=await this.file.readChunk(t,i)}catch(t){g(`Couldn't read segment: ${JSON.stringify(e)}. ${t.message}`)}else this.file.byteLength>t+i?e.chunk=this.file.subarray(t,i):void 0===e.size?e.chunk=this.file.subarray(t):g("Segment unreachable: "+JSON.stringify(e));return e.chunk})),this.extendOptions&&this.extendOptions(e),this.options=e,this.file=t,this.parsers=i}injectSegment(e,t){this.options[e].enabled&&this.createParser(e,t)}createParser(e,t){let i=new(k.get(e))(t,this.options,this.file);return this.parsers[e]=i}createParsers(e){for(let t of e){let{type:e,chunk:i}=t,r=this.options[e];if(r&&r.enabled){let t=this.parsers[e];t&&t.append||t||this.createParser(e,i)}}}async readSegments(e){let t=e.map(this.ensureSegmentChunk);await Promise.all(t)}}{constructor(...e){super(...e),a(this,"appSegments",[]),a(this,"jpegSegments",[]),a(this,"unknownSegments",[])}static canHandle(e,t){return 65496===t}async parse(){await this.findAppSegments(),await this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)}setupSegmentFinderArgs(e){!0===e?(this.findAll=!0,this.wanted=new Set(k.keyList())):(e=void 0===e?k.keyList().filter((e=>this.options[e].enabled)):e.filter((e=>this.options[e].enabled&&k.has(e))),this.findAll=!1,this.remaining=new Set(e),this.wanted=new Set(e)),this.unfinishedMultiSegment=!1}async findAppSegments(e=0,t){this.setupSegmentFinderArgs(t);let{file:i,findAll:r,wanted:s,remaining:n}=this;if(!r&&this.file.chunked&&(r=Array.from(s).some((e=>{let t=k.get(e),i=this.options[e];return t.multiSegment&&i.multiSegment})),r&&await this.file.readWhole()),e=this.findAppSegmentsInRange(e,i.byteLength),!this.options.onlyTiff&&i.chunked){let t=!1;for(;n.size>0&&!t&&(i.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:r}=i,s=this.appSegments.some((e=>!this.file.available(e.offset||e.start,e.length||e.size)));if(t=e>r&&!s?!await i.readNextChunk(e):!await i.readNextChunk(r),void 0===(e=this.findAppSegmentsInRange(e,i.byteLength)))return}}}findAppSegmentsInRange(e,t){t-=2;let i,r,s,n,o,a,{file:l,findAll:u,wanted:h,remaining:p,options:d}=this;for(;e<t;e++)if(255===l.getUint8(e))if(i=l.getUint8(e+1),ne(i)){if(r=l.getUint16(e+2),s=oe(l,e,r),s&&h.has(s)&&(n=k.get(s),o=n.findPosition(l,e),a=d[s],o.type=s,this.appSegments.push(o),!u&&(n.multiSegment&&a.multiSegment?(this.unfinishedMultiSegment=o.chunkNumber<o.chunkCount,this.unfinishedMultiSegment||p.delete(s)):p.delete(s),0===p.size)))break;d.recordUnknownSegments&&(o=re.findPosition(l,e),o.marker=i,this.unknownSegments.push(o)),e+=r+1}else if(se(i)){if(r=l.getUint16(e+2),218===i&&!1!==d.stopAfterSos)return;d.recordJpegSegments&&this.jpegSegments.push({offset:e,length:r,marker:i}),e+=r+1}return e}mergeMultiSegments(){if(!this.appSegments.some((e=>e.multiSegment)))return;let e=function(e,t){let i,r,s,n=new Map;for(let t=0;t<e.length;t++)i=e[t],r=i.type,n.has(r)?s=n.get(r):n.set(r,s=[]),s.push(i);return Array.from(n)}(this.appSegments);this.mergedAppSegments=e.map((([e,t])=>{let i=k.get(e,this.options);return i.handleMultiSegments?{type:e,chunk:i.handleMultiSegments(t)}:t[0]}))}getSegment(e){return this.appSegments.find((t=>t.type===e))}async getOrFindSegment(e){let t=this.getSegment(e);return void 0===t&&(await this.findAppSegments(0,[e]),t=this.getSegment(e)),t}}a(ae,"type","jpeg"),S.set("jpeg",ae);const le=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class ue extends re{parseHeader(){var e=this.chunk.getUint16();18761===e?this.le=!0:19789===e&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(e,t,i=new Map){let{pick:r,skip:s}=this.options[t];r=new Set(r);let n=r.size>0,o=0===s.size,a=this.chunk.getUint16(e);e+=2;for(let l=0;l<a;l++){let a=this.chunk.getUint16(e);if(n){if(r.has(a)&&(i.set(a,this.parseTag(e,a,t)),r.delete(a),0===r.size))break}else!o&&s.has(a)||i.set(a,this.parseTag(e,a,t));e+=12}return i}parseTag(e,t,i){let{chunk:r}=this,s=r.getUint16(e+2),n=r.getUint32(e+4),o=le[s];if(o*n<=4?e+=8:e=r.getUint32(e+8),(s<1||s>13)&&g(`Invalid TIFF value type. block: ${i.toUpperCase()}, tag: ${t.toString(16)}, type: ${s}, offset ${e}`),e>r.byteLength&&g(`Invalid TIFF value offset. block: ${i.toUpperCase()}, tag: ${t.toString(16)}, type: ${s}, offset ${e} is outside of chunk size ${r.byteLength}`),1===s)return r.getUint8Array(e,n);if(2===s)return""===(a=function(e){for(;e.endsWith("\0");)e=e.slice(0,-1);return e}(a=r.getString(e,n)).trim())?void 0:a;var a;if(7===s)return r.getUint8Array(e,n);if(1===n)return this.parseTagValue(s,e);{let t=new(function(e){switch(e){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:case 10:default:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 11:return Float32Array;case 12:return Float64Array}}(s))(n),i=o;for(let r=0;r<n;r++)t[r]=this.parseTagValue(s,e),e+=i;return t}}parseTagValue(e,t){let{chunk:i}=this;switch(e){case 1:return i.getUint8(t);case 3:return i.getUint16(t);case 4:case 13:return i.getUint32(t);case 5:return i.getUint32(t)/i.getUint32(t+4);case 6:return i.getInt8(t);case 8:return i.getInt16(t);case 9:return i.getInt32(t);case 10:return i.getInt32(t)/i.getInt32(t+4);case 11:return i.getFloat(t);case 12:return i.getDouble(t);default:g(`Invalid tiff type ${e}`)}}}class he extends ue{static canHandle(e,t){return 225===e.getUint8(t+1)&&1165519206===e.getUint32(t+4)&&0===e.getUint16(t+8)}async parse(){this.parseHeader();let{options:e}=this;return e.ifd0.enabled&&await this.parseIfd0Block(),e.exif.enabled&&await this.safeParse("parseExifBlock"),e.gps.enabled&&await this.safeParse("parseGpsBlock"),e.interop.enabled&&await this.safeParse("parseInteropBlock"),e.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(e){let t=this[e]();return void 0!==t.catch&&(t=t.catch(this.handleError)),t}findIfd0Offset(){void 0===this.ifd0Offset&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(void 0===this.ifd1Offset){this.findIfd0Offset();let e=this.chunk.getUint16(this.ifd0Offset),t=this.ifd0Offset+2+12*e;this.ifd1Offset=this.chunk.getUint32(t)}}parseBlock(e,t){let i=new Map;return this[t]=i,this.parseTags(e,t,i),i}async parseIfd0Block(){if(this.ifd0)return;let{file:e}=this;this.findIfd0Offset(),this.ifd0Offset<8&&g("Malformed EXIF data"),!e.chunked&&this.ifd0Offset>e.byteLength&&g(`IFD0 offset points to outside of file.\nthis.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${e.byteLength}`),e.tiff&&await e.ensureChunk(this.ifd0Offset,y(this.options));let t=this.parseBlock(this.ifd0Offset,"ifd0");return 0!==t.size?(this.exifOffset=t.get(34665),this.interopOffset=t.get(40965),this.gpsOffset=t.get(34853),this.xmp=t.get(700),this.iptc=t.get(33723),this.icc=t.get(34675),this.options.sanitize&&(t.delete(34665),t.delete(40965),t.delete(34853),t.delete(700),t.delete(33723),t.delete(34675)),t):void 0}async parseExifBlock(){if(this.exif)return;if(this.ifd0||await this.parseIfd0Block(),void 0===this.exifOffset)return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,y(this.options));let e=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=e.get(40965)),this.makerNote=e.get(37500),this.userComment=e.get(37510),this.options.sanitize&&(e.delete(40965),e.delete(37500),e.delete(37510)),this.unpack(e,41728),this.unpack(e,41729),e}unpack(e,t){let i=e.get(t);i&&1===i.length&&e.set(t,i[0])}async parseGpsBlock(){if(this.gps)return;if(this.ifd0||await this.parseIfd0Block(),void 0===this.gpsOffset)return;let e=this.parseBlock(this.gpsOffset,"gps");return e&&e.has(2)&&e.has(4)&&(e.set("latitude",pe(...e.get(2),e.get(1))),e.set("longitude",pe(...e.get(4),e.get(3)))),e}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),void 0!==this.interopOffset||this.exif||await this.parseExifBlock(),void 0!==this.interopOffset))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(e=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||e))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),void 0===this.ifd1)return;let e=this.ifd1.get(513),t=this.ifd1.get(514);return this.chunk.getUint8Array(e,t)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let e,t,i,r={};for(t of z)if(e=this[t],!m(e))if(i=this.canTranslate?this.translateBlock(e,t):Object.fromEntries(e),this.options.mergeOutput){if("ifd1"===t)continue;Object.assign(r,i)}else r[t]=i;return this.makerNote&&(r.makerNote=this.makerNote),this.userComment&&(r.userComment=this.userComment),r}assignToOutput(e,t){if(this.globalOptions.mergeOutput)Object.assign(e,t);else for(let[i,r]of Object.entries(t))this.assignObjectToOutput(e,i,r)}}function pe(e,t,i,r){var s=e+t/60+i/3600;return"S"!==r&&"W"!==r||(s*=-1),s}a(he,"type","tiff"),a(he,"headerLength",10),k.set("tiff",he);Object.freeze({__proto__:null,default:ie,Exifr:ee,fileParsers:S,segmentParsers:k,fileReaders:E,tagKeys:$,tagValues:I,tagRevivers:L,createDictionary:_,extendDictionary:R,fetchUrlAsArrayBuffer:F,readBlobAsArrayBuffer:A,chunkedProps:M,otherSegments:N,segments:D,tiffBlocks:z,segmentsAndBlocks:q,tiffExtractables:B,inheritables:H,allFormatters:V,Options:Z,parse:te});const de={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1};Object.assign({},de,{firstChunkSize:4e4,gps:[1,2,3,4]});Object.assign({},de,{tiff:!1,ifd1:!0,mergeOutput:!1});const ce=Object.assign({},de,{firstChunkSize:4e4,ifd0:[274]});const fe=Object.freeze({1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}});let me=!0,ge=!0;if("object"==typeof navigator){let e=navigator.userAgent;if(e.includes("iPad")||e.includes("iPhone")){let t=e.match(/OS (\d+)_(\d+)/);if(t){let[,e,i]=t,r=Number(e)+.1*Number(i);me=r<13.4,ge=!1}}else if(e.includes("OS X 10")){let[,t]=e.match(/OS X 10[_.](\d+)/);me=ge=Number(t)<15}if(e.includes("Chrome/")){let[,t]=e.match(/Chrome\/(\d+)/);me=ge=Number(t)<81}else if(e.includes("Firefox/")){let[,t]=e.match(/Firefox\/(\d+)/);me=ge=Number(t)<77}}async function ye(e){let t=await async function(e){let t=new ee(ce);await t.read(e);let i=await t.parse();if(i&&i.ifd0)return i.ifd0[274]}(e);return Object.assign({canvas:me,css:ge},fe[t])}class ve extends b{constructor(...e){super(...e),a(this,"ranges",new we),0!==this.byteLength&&this.ranges.add(0,this.byteLength)}_tryExtend(e,t,i){if(0===e&&0===this.byteLength&&i){let e=new DataView(i.buffer||i,i.byteOffset,i.byteLength);this._swapDataView(e)}else{let i=e+t;if(i>this.byteLength){let{dataView:e}=this._extend(i);this._swapDataView(e)}}}_extend(e){let t;t=c?d.allocUnsafe(e):new Uint8Array(e);let i=new DataView(t.buffer,t.byteOffset,t.byteLength);return t.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:t,dataView:i}}subarray(e,t,i=!1){return t=t||this._lengthToEnd(e),i&&this._tryExtend(e,t),this.ranges.add(e,t),super.subarray(e,t)}set(e,t,i=!1){i&&this._tryExtend(t,e.byteLength,e);let r=super.set(e,t);return this.ranges.add(t,r.byteLength),r}async ensureChunk(e,t){this.chunked&&(this.ranges.available(e,t)||await this.readChunk(e,t))}available(e,t){return this.ranges.available(e,t)}}class we{constructor(){a(this,"list",[])}get length(){return this.list.length}add(e,t,i=0){let r=e+t,s=this.list.filter((t=>be(e,t.offset,r)||be(e,t.end,r)));if(s.length>0){e=Math.min(e,...s.map((e=>e.offset))),r=Math.max(r,...s.map((e=>e.end))),t=r-e;let i=s.shift();i.offset=e,i.length=t,i.end=r,this.list=this.list.filter((e=>!s.includes(e)))}else this.list.push({offset:e,length:t,end:r})}available(e,t){let i=e+t;return this.list.some((t=>t.offset<=e&&i<=t.end))}}function be(e,t,i){return e<=t&&t<=i}class Oe extends ve{constructor(e,t){super(0),a(this,"chunksRead",0),this.input=e,this.options=t}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(e=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let t=this.options.chunkSize,i=await this.readChunk(e,t);return!!i&&i.byteLength===t}async readChunk(e,t){if(this.chunksRead++,0!==(t=this.safeWrapAddress(e,t)))return this._readChunk(e,t)}safeWrapAddress(e,t){return void 0!==this.size&&e+t>this.size?Math.max(0,this.size-e):t}get nextChunkOffset(){if(0!==this.ranges.list.length)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return void 0!==this.size&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}E.set("blob",class extends Oe{async readWhole(){this.chunked=!1;let e=await A(this.input);this._swapArrayBuffer(e)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(e,t){let i=t?e+t:void 0,r=this.input.slice(e,i),s=await A(r);return this.set(s,e,!0)}});var Pe={strings:{generatingThumbnails:"Generating thumbnails..."}};function Se(e,t,i){try{e.getContext("2d").getImageData(0,0,1,1)}catch(e){if(18===e.code)return Promise.reject(new Error("cannot read image, probably an svg with external resources"))}return e.toBlob?new Promise((r=>{e.toBlob(r,t,i)})).then((e=>{if(null===e)throw new Error("cannot read image, probably an svg with external resources");return e})):Promise.resolve().then((()=>function(e,t,i){var r,n;const o=s.exec(e),a=null!=(r=null!=(n=t.mimeType)?n:null==o?void 0:o[1])?r:"plain/text";let l;if(null!=o[2]){const e=atob(decodeURIComponent(o[3])),t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);l=[t]}else l=[decodeURIComponent(o[3])];return i?new File(l,t.name||"",{type:a}):new Blob(l,{type:a})}(e.toDataURL(t,i),{}))).then((e=>{if(null===e)throw new Error("could not extract blob, probably an old browser");return e}))}class ke extends r.di{constructor(e,t){super(e,t),this.onFileAdded=e=>{!e.preview&&e.data&&o(e.type)&&!e.isRemote&&this.addToQueue(e.id)},this.onCancelRequest=e=>{const t=this.queue.indexOf(e.id);-1!==t&&this.queue.splice(t,1)},this.onFileRemoved=e=>{const t=this.queue.indexOf(e.id);-1!==t&&this.queue.splice(t,1),e.preview&&n(e.preview)&&URL.revokeObjectURL(e.preview)},this.onRestored=()=>{this.uppy.getFiles().filter((e=>e.isRestored)).forEach((e=>{e.preview&&!n(e.preview)||this.addToQueue(e.id)}))},this.onAllFilesRemoved=()=>{this.queue=[]},this.waitUntilAllProcessed=e=>{e.forEach((e=>{const t=this.uppy.getFile(e);this.uppy.emit("preprocess-progress",t,{mode:"indeterminate",message:this.i18n("generatingThumbnails")})}));const t=()=>{e.forEach((e=>{const t=this.uppy.getFile(e);this.uppy.emit("preprocess-complete",t)}))};return new Promise((e=>{this.queueProcessing?this.uppy.once("thumbnail:all-generated",(()=>{t(),e()})):(t(),e())}))},this.type="modifier",this.id=this.opts.id||"ThumbnailGenerator",this.title="Thumbnail Generator",this.queue=[],this.queueProcessing=!1,this.defaultThumbnailDimension=200,this.thumbnailType=this.opts.thumbnailType||"image/jpeg",this.defaultLocale=Pe;if(this.opts={thumbnailWidth:null,thumbnailHeight:null,waitForThumbnailsBeforeUpload:!1,lazy:!1,...t},this.i18nInit(),this.opts.lazy&&this.opts.waitForThumbnailsBeforeUpload)throw new Error("ThumbnailGenerator: The `lazy` and `waitForThumbnailsBeforeUpload` options are mutually exclusive. Please ensure at most one of them is set to `true`.")}createThumbnail(e,t,i){const r=URL.createObjectURL(e.data),s=new Promise(((e,t)=>{const i=new Image;i.src=r,i.addEventListener("load",(()=>{URL.revokeObjectURL(r),e(i)})),i.addEventListener("error",(e=>{URL.revokeObjectURL(r),t(e.error||new Error("Could not create thumbnail"))}))})),n=ye(e.data).catch((()=>1));return Promise.all([s,n]).then((e=>{let[r,s]=e;const n=this.getProportionalDimensions(r,t,i,s.deg),o=function(e,t){let i=e.width,r=e.height;90!==t.deg&&270!==t.deg||(i=e.height,r=e.width);const s=document.createElement("canvas");s.width=i,s.height=r;const n=s.getContext("2d");return n.translate(i/2,r/2),t.canvas&&(n.rotate(t.rad),n.scale(t.scaleX,t.scaleY)),n.drawImage(e,-e.width/2,-e.height/2,e.width,e.height),s}(r,s);return Se(this.resizeImage(o,n.width,n.height),this.thumbnailType,80)})).then((e=>URL.createObjectURL(e)))}getProportionalDimensions(e,t,i,r){let s=e.width/e.height;return 90!==r&&270!==r||(s=e.height/e.width),null!=t?{width:t,height:Math.round(t/s)}:null!=i?{width:Math.round(i*s),height:i}:{width:this.defaultThumbnailDimension,height:Math.round(this.defaultThumbnailDimension/s)}}resizeImage(e,t,i){let r=function(e){const t=e.width/e.height,i=5e6,r=4096;let s=Math.floor(Math.sqrt(i*t)),n=Math.floor(i/Math.sqrt(i*t));if(s>r&&(s=r,n=Math.round(s/t)),n>r&&(n=r,s=Math.round(t*n)),e.width>s){const t=document.createElement("canvas");return t.width=s,t.height=n,t.getContext("2d").drawImage(e,0,0,s,n),t}return e}(e),s=Math.ceil(Math.log2(r.width/t));s<1&&(s=1);let n=t*2**(s-1),o=i*2**(s-1);for(;s--;){const e=document.createElement("canvas");e.width=n,e.height=o,e.getContext("2d").drawImage(r,0,0,n,o),r=e,n=Math.round(n/2),o=Math.round(o/2)}return r}setPreviewURL(e,t){this.uppy.setFileState(e,{preview:t})}addToQueue(e){this.queue.push(e),!1===this.queueProcessing&&this.processQueue()}processQueue(){if(this.queueProcessing=!0,this.queue.length>0){const e=this.uppy.getFile(this.queue.shift());return e?this.requestThumbnail(e).catch((()=>{})).then((()=>this.processQueue())):(this.uppy.log("[ThumbnailGenerator] file was removed before a thumbnail could be generated, but not removed from the queue. This is probably a bug","error"),Promise.resolve())}return this.queueProcessing=!1,this.uppy.log("[ThumbnailGenerator] Emptied thumbnail queue"),this.uppy.emit("thumbnail:all-generated"),Promise.resolve()}requestThumbnail(e){return o(e.type)&&!e.isRemote?this.createThumbnail(e,this.opts.thumbnailWidth,this.opts.thumbnailHeight).then((t=>{this.setPreviewURL(e.id,t),this.uppy.log(`[ThumbnailGenerator] Generated thumbnail for ${e.id}`),this.uppy.emit("thumbnail:generated",this.uppy.getFile(e.id),t)})).catch((t=>{this.uppy.log(`[ThumbnailGenerator] Failed thumbnail for ${e.id}:`,"warning"),this.uppy.log(t,"warning"),this.uppy.emit("thumbnail:error",this.uppy.getFile(e.id),t)})):Promise.resolve()}install(){this.uppy.on("file-removed",this.onFileRemoved),this.uppy.on("cancel-all",this.onAllFilesRemoved),this.opts.lazy?(this.uppy.on("thumbnail:request",this.onFileAdded),this.uppy.on("thumbnail:cancel",this.onCancelRequest)):(this.uppy.on("file-added",this.onFileAdded),this.uppy.on("restored",this.onRestored)),this.opts.waitForThumbnailsBeforeUpload&&this.uppy.addPreProcessor(this.waitUntilAllProcessed)}uninstall(){this.uppy.off("file-removed",this.onFileRemoved),this.uppy.off("cancel-all",this.onAllFilesRemoved),this.opts.lazy?(this.uppy.off("thumbnail:request",this.onFileAdded),this.uppy.off("thumbnail:cancel",this.onCancelRequest)):(this.uppy.off("file-added",this.onFileAdded),this.uppy.off("restored",this.onRestored)),this.opts.waitForThumbnailsBeforeUpload&&this.uppy.removePreProcessor(this.waitUntilAllProcessed)}}ke.VERSION="3.0.3"},6594:function(e,t,i){"use strict";function r(e,t,i,s){let{onSuccess:n}=s;e.readEntries((s=>{const o=[...t,...s];s.length?queueMicrotask((()=>{r(e,o,i,{onSuccess:n})})):n(o)}),(e=>{i(e),n(t)}))}function s(e,t){return null==e?e:{kind:e.isFile?"file":e.isDirectory?"directory":void 0,name:e.name,getFile(){return new Promise(((t,i)=>e.file(t,i)))},async*values(){const i=e.createReader(),n=await new Promise((e=>{r(i,[],t,{onSuccess:i=>e(i.map((e=>s(e,t))))})}));yield*n}}}async function*n(e,t,i){if(void 0===i&&(i=void 0),"file"===e.kind){const r=await e.getFile();null!=r?(r.relativePath=t?`${t}/${e.name}`:null,yield r):null!=i&&(yield i)}else if("directory"===e.kind)for await(const i of e.values())yield*n(i,`${t}/${e.name}`);else null!=i&&(yield i)}i.d(t,{Z:function(){return a}});var o=i(7581);async function a(e,t){let{logDropError:i=(()=>{})}=void 0===t?{}:t;try{const t=[];for await(const r of async function*(e,t){const i=await Promise.all(Array.from(e.items,(async e=>{let i;return null!=i||(i=s("function"==typeof e.getAsEntry?e.getAsEntry():e.webkitGetAsEntry(),t)),{fileSystemHandle:i,lastResortFile:e.getAsFile()}})));for(const{lastResortFile:e,fileSystemHandle:r}of i)if(null!=r)try{yield*n(r,"",e)}catch(i){null!=e?yield e:t(i)}else null!=e&&(yield e)}(e,i))t.push(r);return t}catch{return function(e){const t=(0,o.Z)(e.files);return Promise.resolve(t)}(e)}}},8215:function(e,t,i){"use strict";function r(){const e=document.body;return"draggable"in e&&"ondragstart"in e&&"ondrop"in e&&("FormData"in window&&"FileReader"in window)}i.d(t,{Z:function(){return r}})},7581:function(e,t){"use strict";t.Z=Array.from},1653:function(e,t,i){"use strict";i.d(t,{Z:function(){return Ne}});var r={};i.r(r),i.d(r,{getItem:function(){return k},removeItem:function(){return E},setItem:function(){return S}});var s=i(8596),n=i(9022);class o extends Error{constructor(e,t){void 0===t&&(t=null),super("This looks like a network error, the endpoint might be blocked by an internet provider or a firewall."),this.cause=e,this.isNetworkError=!0,this.request=t}}var a=o;class l extends Error{constructor(e,t){var i,r;void 0===t&&(t={}),super(e),this.cause=t.cause,this.cause&&(i=this.cause,r="isNetworkError",Object.prototype.hasOwnProperty.call(i,r))&&(this.isNetworkError=this.cause.isNetworkError)}}var u=l;class h extends Error{constructor(){super("Authorization required"),this.name="AuthError",this.isAuthError=!0}}var p=h;let d;function c(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var f=0;function m(e){return"__private_"+f+++"_"+e}const g=new Map;var y=m("companionHeaders"),v=m("getUrl"),w=m("request");d=Symbol.for("uppy test: getCompanionHeaders");class b{constructor(e,t){Object.defineProperty(this,w,{value:P}),Object.defineProperty(this,v,{value:O}),Object.defineProperty(this,y,{writable:!0,value:void 0}),this.uppy=e,this.opts=t,this.onReceiveResponse=this.onReceiveResponse.bind(this),c(this,y)[y]=null==t?void 0:t.companionHeaders}setCompanionHeaders(e){c(this,y)[y]=e}[d](){return c(this,y)[y]}get hostname(){const{companion:e}=this.uppy.getState(),t=this.opts.companionUrl;return(e&&e[t]?e[t]:t).replace(/\/$/,"")}async headers(){return{...{Accept:"application/json","Content-Type":"application/json","Uppy-Versions":`@uppy/companion-client=${b.VERSION}`},...c(this,y)[y]}}onReceiveResponse(e){let{headers:t}=e;const i=this.uppy.getState().companion||{},r=this.opts.companionUrl;t.has("i-am")&&t.get("i-am")!==i[r]&&this.uppy.setState({companion:{...i,[r]:t.get("i-am")}})}async preflight(e){const t=g.get(this.hostname);if(null!=t)return t;const i=["accept","content-type","uppy-auth-token"],r=(async()=>{try{const t=(await fetch(c(this,v)[v](e),{method:"OPTIONS"})).headers.get("access-control-allow-headers");if(null==t||"*"===t)return g.set(this.hostname,i),i;this.uppy.log(`[CompanionClient] adding allowed preflight headers to companion cache: ${this.hostname} ${t}`);const r=t.split(",").map((e=>e.trim().toLowerCase()));return g.set(this.hostname,r),r}catch(e){return this.uppy.log(`[CompanionClient] unable to make preflight request ${e}`,"warning"),g.delete(this.hostname),i}})();return g.set(this.hostname,r),r}async preflightAndHeaders(e){const[t,i]=await Promise.all([this.preflight(e),this.headers()]);return Object.fromEntries(Object.entries(i).filter((e=>{let[i]=e;return!!t.includes(i.toLowerCase())||(this.uppy.log(`[CompanionClient] excluding disallowed header ${i}`),!1)})))}async get(e,t){return void 0===t&&(t=void 0),"boolean"==typeof t&&(t={skipPostResponse:t}),c(this,w)[w]({...t,path:e})}async post(e,t,i){return void 0===i&&(i=void 0),"boolean"==typeof i&&(i={skipPostResponse:i}),c(this,w)[w]({...i,path:e,method:"POST",data:t})}async delete(e,t,i){return void 0===t&&(t=void 0),"boolean"==typeof i&&(i={skipPostResponse:i}),c(this,w)[w]({...i,path:e,method:"DELETE",data:t})}}function O(e){return/^(https?:|)\/\//.test(e)?e:`${this.hostname}/${e}`}async function P(e){let{path:t,method:i="GET",data:r,skipPostResponse:s,signal:n}=e;try{const e=await this.preflightAndHeaders(t),o=await function(){return fetch(...arguments).catch((e=>{throw"AbortError"===e.name?e:new a(e)}))}(c(this,v)[v](t),{method:i,signal:n,headers:e,credentials:this.opts.companionCookiesRule||"same-origin",body:r?JSON.stringify(r):null});return s||this.onReceiveResponse(o),async function(e){if(401===e.status)throw new p;const t=e.json();if(e.ok)return t;let i=`Failed request with status: ${e.status}. ${e.statusText}`;try{const e=await t;i=e.message?`${i} message: ${e.message}`:i,i=e.requestId?`${i} request-Id: ${e.requestId}`:i}catch{}throw new Error(i)}(o)}catch(e){if(null!=e&&e.isAuthError)throw e;throw new u(`Could not ${i} ${c(this,v)[v](t)}`,{cause:e})}}function S(e,t){return new Promise((i=>{localStorage.setItem(e,t),i()}))}function k(e){return Promise.resolve(localStorage.getItem(e))}function E(e){return new Promise((t=>{localStorage.removeItem(e),t()}))}b.VERSION="3.1.3";class T extends b{constructor(e,t){super(e,t),this.provider=t.provider,this.id=this.provider,this.name=this.opts.name||(e=>e.split("-").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" "))(this.id),this.pluginId=this.opts.pluginId,this.tokenKey=`companion-${this.pluginId}-auth-token`,this.companionKeysParams=this.opts.companionKeysParams,this.preAuthToken=null}async headers(){const[e,t]=await Promise.all([super.headers(),this.getAuthToken()]),i={};return t&&(i["uppy-auth-token"]=t),this.companionKeysParams&&(i["uppy-credentials-params"]=btoa(JSON.stringify({params:this.companionKeysParams}))),{...e,...i}}onReceiveResponse(e){super.onReceiveResponse(e);const t=this.uppy.getPlugin(this.pluginId),i=t.getPluginState().authenticated?401!==e.status:e.status<400;return t.setPluginState({authenticated:i}),e}setAuthToken(e){return this.uppy.getPlugin(this.pluginId).storage.setItem(this.tokenKey,e)}getAuthToken(){return this.uppy.getPlugin(this.pluginId).storage.getItem(this.tokenKey)}async ensurePreAuth(){if(this.companionKeysParams&&!this.preAuthToken&&(await this.fetchPreAuthToken(),!this.preAuthToken))throw new Error("Could not load authentication data required for third-party login. Please try again later.")}authUrl(e){void 0===e&&(e={});const t=new URLSearchParams(e);return this.preAuthToken&&t.set("uppyPreAuthToken",this.preAuthToken),`${this.hostname}/${this.id}/connect?${t}`}fileUrl(e){return`${this.hostname}/${this.id}/get/${e}`}async fetchPreAuthToken(){if(this.companionKeysParams)try{const e=await this.post(`${this.id}/preauth/`,{params:this.companionKeysParams});this.preAuthToken=e.token}catch(e){this.uppy.log(`[CompanionClient] unable to fetch preAuthToken ${e}`,"warning")}}list(e){return this.get(`${this.id}/list/${e||""}`)}logout(){return this.get(`${this.id}/logout`).then((e=>Promise.all([e,this.uppy.getPlugin(this.pluginId).storage.removeItem(this.tokenKey)]))).then((e=>{let[t]=e;return t}))}static initPlugin(e,t,i){if(e.type="acquirer",e.files=[],i&&(e.opts={...i,...t}),t.serverUrl||t.serverPattern)throw new Error("`serverUrl` and `serverPattern` have been renamed to `companionUrl` and `companionAllowedHosts` respectively in the 0.30.5 release. Please consult the docs (for example, https://uppy.io/docs/instagram/ for the Instagram plugin) and use the updated options.`");if(t.companionAllowedHosts){const i=t.companionAllowedHosts;if(!("string"==typeof i||Array.isArray(i)||i instanceof RegExp))throw new TypeError(`${e.id}: the option "companionAllowedHosts" must be one of string, Array, RegExp`);e.opts.companionAllowedHosts=i}else/^(?!https?:\/\/).*$/i.test(t.companionUrl)?e.opts.companionAllowedHosts=`https://${t.companionUrl.replace(/^\/\//,"")}`:e.opts.companionAllowedHosts=new URL(t.companionUrl).origin;e.storage=e.opts.storage||r}}var U=i(4800);let j,x;function F(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var A=0;function C(e){return"__private_"+A+++"_"+e}var _=C("queued"),R=C("emitter"),$=C("isOpen"),I=C("socket"),L=C("handleMessage");j=Symbol.for("uppy test: getSocket"),x=Symbol.for("uppy test: getQueued");class M{constructor(e){Object.defineProperty(this,_,{writable:!0,value:[]}),Object.defineProperty(this,R,{writable:!0,value:U()}),Object.defineProperty(this,$,{writable:!0,value:!1}),Object.defineProperty(this,I,{writable:!0,value:void 0}),Object.defineProperty(this,L,{writable:!0,value:e=>{try{const t=JSON.parse(e.data);this.emit(t.action,t.payload)}catch(e){}}}),this.opts=e,e&&!1===e.autoOpen||this.open()}get isOpen(){return F(this,$)[$]}[j](){return F(this,I)[I]}[x](){return F(this,_)[_]}open(){null==F(this,I)[I]&&(F(this,I)[I]=new WebSocket(this.opts.target),F(this,I)[I].onopen=()=>{for(F(this,$)[$]=!0;F(this,_)[_].length>0&&F(this,$)[$];){const e=F(this,_)[_].shift();this.send(e.action,e.payload)}},F(this,I)[I].onclose=()=>{F(this,$)[$]=!1,F(this,I)[I]=null},F(this,I)[I].onmessage=F(this,L)[L])}close(){var e;null==(e=F(this,I)[I])||e.close()}send(e,t){F(this,$)[$]?F(this,I)[I].send(JSON.stringify({action:e,payload:t})):F(this,_)[_].push({action:e,payload:t})}on(e,t){F(this,R)[R].on(e,t)}emit(e,t){F(this,R)[R].emit(e,t)}once(e,t){F(this,R)[R].once(e,t)}}var N=i(3096)((function(e,t,i){const{progress:r,bytesUploaded:s,bytesTotal:n}=t;r&&(e.uppy.log(`Upload progress: ${r}`),e.uppy.emit("upload-progress",i,{uploader:e,bytesUploaded:s,bytesTotal:n}))}),300,{leading:!0,trailing:!0});function D(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var z=0;function q(e){return"__private_"+z+++"_"+e}var B=q("emitter"),H=q("events");class V{constructor(e){Object.defineProperty(this,B,{writable:!0,value:void 0}),Object.defineProperty(this,H,{writable:!0,value:[]}),D(this,B)[B]=e}on(e,t){return D(this,H)[H].push([e,t]),D(this,B)[B].on(e,t)}remove(){for(const[e,t]of D(this,H)[H].splice(0))D(this,B)[B].off(e,t)}}function X(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var K=0;function W(e){return"__private_"+K+++"_"+e}var G=W("aliveTimer"),Z=W("isDone"),Y=W("onTimedOut"),J=W("timeout");var Q=class{constructor(e,t){Object.defineProperty(this,G,{writable:!0,value:void 0}),Object.defineProperty(this,Z,{writable:!0,value:!1}),Object.defineProperty(this,Y,{writable:!0,value:void 0}),Object.defineProperty(this,J,{writable:!0,value:void 0}),X(this,J)[J]=e,X(this,Y)[Y]=t}progress(){X(this,Z)[Z]||X(this,J)[J]>0&&(clearTimeout(X(this,G)[G]),X(this,G)[G]=setTimeout(X(this,Y)[Y],X(this,J)[J]))}done(){X(this,Z)[Z]||(clearTimeout(X(this,G)[G]),X(this,G)[G]=null,X(this,Z)[Z]=!0)}};function ee(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var te=0;function ie(e){return"__private_"+te+++"_"+e}function re(e){if(null!=e){const t=()=>this.abort(e.reason);e.addEventListener("abort",t,{once:!0});const i=()=>{e.removeEventListener("abort",t)};this.then(i,i)}return this}var se=ie("activeRequests"),ne=ie("queuedHandlers"),oe=ie("paused"),ae=ie("pauseTimer"),le=ie("downLimit"),ue=ie("upperLimit"),he=ie("rateLimitingTimer"),pe=ie("call"),de=ie("queueNext"),ce=ie("next"),fe=ie("queue"),me=ie("dequeue"),ge=ie("resume"),ye=ie("increaseLimit");class ve{constructor(e){Object.defineProperty(this,me,{value:Se}),Object.defineProperty(this,fe,{value:Pe}),Object.defineProperty(this,ce,{value:Oe}),Object.defineProperty(this,de,{value:be}),Object.defineProperty(this,pe,{value:we}),Object.defineProperty(this,se,{writable:!0,value:0}),Object.defineProperty(this,ne,{writable:!0,value:[]}),Object.defineProperty(this,oe,{writable:!0,value:!1}),Object.defineProperty(this,ae,{writable:!0,value:void 0}),Object.defineProperty(this,le,{writable:!0,value:1}),Object.defineProperty(this,ue,{writable:!0,value:void 0}),Object.defineProperty(this,he,{writable:!0,value:void 0}),Object.defineProperty(this,ge,{writable:!0,value:()=>this.resume()}),Object.defineProperty(this,ye,{writable:!0,value:()=>{if(ee(this,oe)[oe])ee(this,he)[he]=setTimeout(ee(this,ye)[ye],0);else{ee(this,le)[le]=this.limit,this.limit=Math.ceil((ee(this,ue)[ue]+ee(this,le)[le])/2);for(let e=ee(this,le)[le];e<=this.limit;e++)ee(this,de)[de]();ee(this,ue)[ue]-ee(this,le)[le]>3?ee(this,he)[he]=setTimeout(ee(this,ye)[ye],2e3):ee(this,le)[le]=Math.floor(ee(this,le)[le]/2)}}}),this.limit="number"!=typeof e||0===e?1/0:e}run(e,t){return!ee(this,oe)[oe]&&ee(this,se)[se]<this.limit?ee(this,pe)[pe](e):ee(this,fe)[fe](e,t)}wrapPromiseFunction(e,t){var i=this;return function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];let o;const a=new Promise(((r,n)=>{o=i.run((()=>{let t,i;try{i=Promise.resolve(e(...s))}catch(e){i=Promise.reject(e)}return i.then((e=>{t?n(t):(o.done(),r(e))}),(e=>{t?n(t):(o.done(),n(e))})),e=>{t=function(e){return new Error("Cancelled",{cause:e})}(e)}}),t)}));return a.abort=e=>{o.abort(e)},a.abortOn=re,a}}resume(){ee(this,oe)[oe]=!1,clearTimeout(ee(this,ae)[ae]);for(let e=0;e<this.limit;e++)ee(this,de)[de]()}pause(e){void 0===e&&(e=null),ee(this,oe)[oe]=!0,clearTimeout(ee(this,ae)[ae]),null!=e&&(ee(this,ae)[ae]=setTimeout(ee(this,ge)[ge],e))}rateLimit(e){clearTimeout(ee(this,he)[he]),this.pause(e),this.limit>1&&Number.isFinite(this.limit)&&(ee(this,ue)[ue]=this.limit-1,this.limit=ee(this,le)[le],ee(this,he)[he]=setTimeout(ee(this,ye)[ye],e))}get isPaused(){return ee(this,oe)[oe]}}function we(e){ee(this,se)[se]+=1;let t,i=!1;try{t=e()}catch(e){throw ee(this,se)[se]-=1,e}return{abort:e=>{i||(i=!0,ee(this,se)[se]-=1,t(e),ee(this,de)[de]())},done:()=>{i||(i=!0,ee(this,se)[se]-=1,ee(this,de)[de]())}}}function be(){queueMicrotask((()=>ee(this,ce)[ce]()))}function Oe(){if(ee(this,oe)[oe]||ee(this,se)[se]>=this.limit)return;if(0===ee(this,ne)[ne].length)return;const e=ee(this,ne)[ne].shift(),t=ee(this,pe)[pe](e.fn);e.abort=t.abort,e.done=t.done}function Pe(e,t){void 0===t&&(t={});const i={fn:e,priority:t.priority||0,abort:()=>{ee(this,me)[me](i)},done:()=>{throw new Error("Cannot mark a queued request as done: this indicates a bug")}},r=ee(this,ne)[ne].findIndex((e=>i.priority>e.priority));return-1===r?ee(this,ne)[ne].push(i):ee(this,ne)[ne].splice(r,0,i),i}function Se(e){const t=ee(this,ne)[ne].indexOf(e);-1!==t&&ee(this,ne)[ne].splice(t,1)}const ke=Symbol("__queue");var Ee=function(e){return!!e&&(0!==e.readyState&&4!==e.readyState||0===e.status)};var Te={strings:{uploadStalled:"Upload has not made any progress for %{seconds} seconds. You may want to retry it."}};function Ue(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var je=0;function xe(e){return"__private_"+je+++"_"+e}function Fe(e,t){let i=t;return i||(i=new Error("Upload error")),"string"==typeof i&&(i=new Error(i)),i instanceof Error||(i=Object.assign(new Error("Upload error"),{data:i})),Ee(e)?(i=new a(i,e),i):(i.request=e,i)}function Ae(e){return e.data.slice(0,e.data.size,e.meta.type)}var Ce=xe("queueRequestSocketToken"),_e=xe("upload"),Re=xe("requestSocketToken"),$e=xe("uploadRemote"),Ie=xe("uploadBundle"),Le=xe("uploadFiles"),Me=xe("handleUpload");class Ne extends s.Z{constructor(e,t){super(e,t),Object.defineProperty(this,Le,{value:Be}),Object.defineProperty(this,Ie,{value:qe}),Object.defineProperty(this,$e,{value:ze}),Object.defineProperty(this,_e,{value:De}),Object.defineProperty(this,Ce,{writable:!0,value:void 0}),Object.defineProperty(this,Re,{writable:!0,value:async e=>{const t=this.getOptions(e),i=new(e.remote.providerOptions.provider?T:b)(this.uppy,e.remote.providerOptions),r=Array.isArray(t.allowedMetaFields)?t.allowedMetaFields:Object.keys(e.meta);return(await i.post(e.remote.url,{...e.remote.body,protocol:"multipart",endpoint:t.endpoint,size:e.data.size,fieldname:t.fieldName,metadata:Object.fromEntries(r.map((t=>[t,e.meta[t]]))),httpMethod:t.method,useFormData:t.formData,headers:t.headers})).token}}),Object.defineProperty(this,Me,{writable:!0,value:async e=>{if(0===e.length)return void this.uppy.log("[XHRUpload] No files to upload!");0!==this.opts.limit||this.opts[ke]||this.uppy.log("[XHRUpload] When uploading multiple files at once, consider setting the `limit` option (to `10` for example), to limit the number of concurrent uploads, which helps prevent memory and network issues: https://uppy.io/docs/xhr-upload/#limit-0","warning"),this.uppy.log("[XHRUpload] Uploading...");const t=function(e){return e.filter((e=>!(e=>"error"in e&&e.error)(e)))}(this.uppy.getFilesByIds(e)),i=function(e){return e.filter((e=>!e.progress.uploadStarted||!e.isRestored))}(t);if(this.uppy.emit("upload-start",i),this.opts.bundle){if(t.some((e=>e.isRemote)))throw new Error("Cant upload remote files when the `bundle: true` option is set");if("function"==typeof this.opts.headers)throw new TypeError("`headers` may not be a function when the `bundle: true` option is set");await Ue(this,Ie)[Ie](t)}else await Ue(this,Le)[Le](t)}}),this.type="uploader",this.id=this.opts.id||"XHRUpload",this.title="XHRUpload",this.defaultLocale=Te;const i={formData:!0,fieldName:t.bundle?"files[]":"file",method:"post",allowedMetaFields:null,responseUrlFieldName:"url",bundle:!1,headers:{},timeout:3e4,limit:5,withCredentials:!1,responseType:"",getResponseData(t){let i={};try{i=JSON.parse(t)}catch(t){e.log(t)}return i},getResponseError(e,t){let i=new Error("Upload error");return Ee(t)&&(i=new a(i,t)),i},validateStatus(e){return e>=200&&e<300}};if(this.opts={...i,...t},this.i18nInit(),ke in this.opts?this.requests=this.opts[ke]:this.requests=new ve(this.opts.limit),this.opts.bundle&&!this.opts.formData)throw new Error("`opts.formData` must be true when `opts.bundle` is enabled.");if(void 0===(null==t?void 0:t.allowedMetaFields)&&"metaFields"in this.opts)throw new Error("The `metaFields` option has been renamed to `allowedMetaFields`.");this.uploaderEvents=Object.create(null),Ue(this,Ce)[Ce]=this.requests.wrapPromiseFunction(Ue(this,Re)[Re],{priority:-1})}getOptions(e){const t=this.uppy.getState().xhrUpload,{headers:i}=this.opts,r={...this.opts,...t||{},...e.xhrUpload||{},headers:{}};return"function"==typeof i?r.headers=i(e):Object.assign(r.headers,this.opts.headers),t&&Object.assign(r.headers,t.headers),e.xhrUpload&&Object.assign(r.headers,e.xhrUpload.headers),r}addMetadata(e,t,i){(Array.isArray(i.allowedMetaFields)?i.allowedMetaFields:Object.keys(t)).forEach((i=>{e.append(i,t[i])}))}createFormDataUpload(e,t){const i=new FormData;this.addMetadata(i,e.meta,t);const r=Ae(e);return e.name?i.append(t.fieldName,r,e.meta.name):i.append(t.fieldName,r),i}createBundledUpload(e,t){const i=new FormData,{meta:r}=this.uppy.getState();return this.addMetadata(i,r,t),e.forEach((e=>{const t=this.getOptions(e),r=Ae(e);e.name?i.append(t.fieldName,r,e.name):i.append(t.fieldName,r)})),i}async connectToServerSocket(e){return new Promise(((t,i)=>{const r=this.getOptions(e),s=e.serverToken,n=function(e){const t=/^(?:https?:\/\/|\/\/)?(?:[^@\n]+@)?(?:www\.)?([^\n]+)/i.exec(e)[1];return`${/^http:\/\//i.test(e)?"ws":"wss"}://${t}`}(e.remote.companionUrl);let o;const a=()=>{null==o&&(o=new M({target:`${n}/api/${s}`}),o.on("progress",(t=>N(this,t,e))),o.on("success",(i=>{const s=r.getResponseData(i.response.responseText,i.response),n=s[r.responseUrlFieldName],a={status:i.response.status,body:s,uploadURL:n};return this.uppy.emit("upload-success",e,a),l.done(),o.close(),this.uploaderEvents[e.id]&&(this.uploaderEvents[e.id].remove(),this.uploaderEvents[e.id]=null),t()})),o.on("error",(t=>{const s=t.response,n=s?r.getResponseError(s.responseText,s):Object.assign(new Error(t.error.message),{cause:t.error});this.uppy.emit("upload-error",e,n),l.done(),this.uploaderEvents[e.id]&&(this.uploaderEvents[e.id].remove(),this.uploaderEvents[e.id]=null),i(n)})))};this.uploaderEvents[e.id]=new V(this.uppy);let l=this.requests.run((()=>{var t;e.isPaused?null==(t=o)||t.send("pause",{}):a();return()=>o.close()}));this.onFileRemove(e.id,(()=>{var i;null==(i=o)||i.send("cancel",{}),l.abort(),t(`upload ${e.id} was removed`)})),this.onCancelAll(e.id,(function(i){let{reason:r}=void 0===i?{}:i;var s;"user"===r&&(null==(s=o)||s.send("cancel",{}),l.abort());t(`upload ${e.id} was canceled`)}));const u=()=>{null==o?l.abort():(o.send("pause",{}),l.done()),l=this.requests.run((()=>(e.isPaused||(null==o?a():o.send("resume",{})),()=>o.close())))};this.onRetry(e.id,u),this.onRetryAll(e.id,u)})).catch((t=>(this.uppy.emit("upload-error",e,t),Promise.reject(t))))}onFileRemove(e,t){this.uploaderEvents[e].on("file-removed",(i=>{e===i.id&&t(i.id)}))}onRetry(e,t){this.uploaderEvents[e].on("upload-retry",(i=>{e===i&&t()}))}onRetryAll(e,t){this.uploaderEvents[e].on("retry-all",(()=>{this.uppy.getFile(e)&&t()}))}onCancelAll(e,t){var i=this;this.uploaderEvents[e].on("cancel-all",(function(){i.uppy.getFile(e)&&t(...arguments)}))}install(){if(this.opts.bundle){const{capabilities:e}=this.uppy.getState();this.uppy.setState({capabilities:{...e,individualCancellation:!1}})}this.uppy.addUploader(Ue(this,Me)[Me])}uninstall(){if(this.opts.bundle){const{capabilities:e}=this.uppy.getState();this.uppy.setState({capabilities:{...e,individualCancellation:!0}})}this.uppy.removeUploader(Ue(this,Me)[Me])}}async function De(e,t,i){const r=this.getOptions(e);return this.uppy.log(`uploading ${t} of ${i}`),new Promise(((t,i)=>{const s=r.formData?this.createFormDataUpload(e,r):e.data,o=new XMLHttpRequest;let a;this.uploaderEvents[e.id]=new V(this.uppy);const l=new Q(r.timeout,(()=>{const t=new Error(this.i18n("uploadStalled",{seconds:Math.ceil(r.timeout/1e3)}));this.uppy.emit("upload-stalled",t,[e])})),u=(0,n.x)();o.upload.addEventListener("loadstart",(()=>{this.uppy.log(`[XHRUpload] ${u} started`)})),o.upload.addEventListener("progress",(t=>{this.uppy.log(`[XHRUpload] ${u} progress: ${t.loaded} / ${t.total}`),l.progress(),t.lengthComputable&&this.uppy.emit("upload-progress",e,{uploader:this,bytesUploaded:t.loaded,bytesTotal:t.total})})),o.addEventListener("load",(()=>{if(this.uppy.log(`[XHRUpload] ${u} finished`),l.done(),a.done(),this.uploaderEvents[e.id]&&(this.uploaderEvents[e.id].remove(),this.uploaderEvents[e.id]=null),r.validateStatus(o.status,o.responseText,o)){const i=r.getResponseData(o.responseText,o),s=i[r.responseUrlFieldName],n={status:o.status,body:i,uploadURL:s};return this.uppy.emit("upload-success",e,n),s&&this.uppy.log(`Download ${e.name} from ${s}`),t(e)}const s=r.getResponseData(o.responseText,o),n=Fe(o,r.getResponseError(o.responseText,o)),h={status:o.status,body:s};return this.uppy.emit("upload-error",e,n,h),i(n)})),o.addEventListener("error",(()=>{this.uppy.log(`[XHRUpload] ${u} errored`),l.done(),a.done(),this.uploaderEvents[e.id]&&(this.uploaderEvents[e.id].remove(),this.uploaderEvents[e.id]=null);const t=Fe(o,r.getResponseError(o.responseText,o));return this.uppy.emit("upload-error",e,t),i(t)})),o.open(r.method.toUpperCase(),r.endpoint,!0),o.withCredentials=r.withCredentials,""!==r.responseType&&(o.responseType=r.responseType),a=this.requests.run((()=>{const t=this.getOptions(e);return Object.keys(t.headers).forEach((e=>{o.setRequestHeader(e,t.headers[e])})),o.send(s),()=>{l.done(),o.abort()}})),this.onFileRemove(e.id,(()=>{a.abort(),i(new Error("File removed"))})),this.onCancelAll(e.id,(e=>{let{reason:t}=e;"user"===t&&a.abort(),i(new Error("Upload cancelled"))}))}))}async function ze(e){try{if(e.serverToken)return await this.connectToServerSocket(e);const t=await Ue(this,Ce)[Ce](e);if(!this.uppy.getState().files[e.id])return;return this.uppy.setFileState(e.id,{serverToken:t}),await this.connectToServerSocket(this.uppy.getFile(e.id))}catch(t){throw this.uppy.setFileState(e.id,{serverToken:void 0}),this.uppy.emit("upload-error",e,t),t}}function qe(e){return new Promise(((t,i)=>{const{endpoint:r}=this.opts,{method:s}=this.opts,n=this.uppy.getState().xhrUpload,o=this.createBundledUpload(e,{...this.opts,...n||{}}),a=new XMLHttpRequest,l=t=>{e.forEach((e=>{this.uppy.emit("upload-error",e,t)}))},u=new Q(this.opts.timeout,(()=>{const t=new Error(this.i18n("uploadStalled",{seconds:Math.ceil(this.opts.timeout/1e3)}));this.uppy.emit("upload-stalled",t,e)}));a.upload.addEventListener("loadstart",(()=>{this.uppy.log("[XHRUpload] started uploading bundle"),u.progress()})),a.upload.addEventListener("progress",(t=>{u.progress(),t.lengthComputable&&e.forEach((e=>{this.uppy.emit("upload-progress",e,{uploader:this,bytesUploaded:t.loaded/t.total*e.size,bytesTotal:e.size})}))})),a.addEventListener("load",(r=>{if(u.done(),this.opts.validateStatus(r.target.status,a.responseText,a)){const i=this.opts.getResponseData(a.responseText,a),s={status:r.target.status,body:i};return e.forEach((e=>{this.uppy.emit("upload-success",e,s)})),t()}const s=this.opts.getResponseError(a.responseText,a)||new Error("Upload error");return s.request=a,l(s),i(s)})),a.addEventListener("error",(()=>{u.done();const e=this.opts.getResponseError(a.responseText,a)||new Error("Upload error");return l(e),i(e)})),this.uppy.on("cancel-all",(function(e){let{reason:t}=void 0===e?{}:e;"user"===t&&(u.done(),a.abort())})),a.open(s.toUpperCase(),r,!0),a.withCredentials=this.opts.withCredentials,""!==this.opts.responseType&&(a.responseType=this.opts.responseType),Object.keys(this.opts.headers).forEach((e=>{a.setRequestHeader(e,this.opts.headers[e])})),a.send(o)}))}async function Be(e){await Promise.allSettled(e.map(((t,i)=>{const r=parseInt(i,10)+1,s=e.length;return t.isRemote?Ue(this,$e)[$e](t,r,s):Ue(this,_e)[_e](t,r,s)})))}Ne.VERSION="3.2.0"},9022:function(e,t,i){"use strict";i.d(t,{x:function(){return r}});let r=(e=21)=>{let t="",i=e;for(;i--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return t}}},function(e){var t;t=5923,e(e.s=t)}]);